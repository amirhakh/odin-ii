<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ODIN_II: H:/RESEARCH/PROGRAMS_AND_DEVELOPMENT/ODIN_II/trunk/ODIN_II/SRC/netlist_create_from_ast.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>H:/RESEARCH/PROGRAMS_AND_DEVELOPMENT/ODIN_II/trunk/ODIN_II/SRC/netlist_create_from_ast.c</h1><a href="netlist__create__from__ast_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment"></span>
<a name="l00003"></a>00003 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00004"></a>00004 <span class="comment">obtaining a copy of this software and associated documentation</span>
<a name="l00005"></a>00005 <span class="comment">files (the &quot;Software&quot;), to deal in the Software without</span>
<a name="l00006"></a>00006 <span class="comment">restriction, including without limitation the rights to use,</span>
<a name="l00007"></a>00007 <span class="comment">copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<a name="l00008"></a>00008 <span class="comment">copies of the Software, and to permit persons to whom the</span>
<a name="l00009"></a>00009 <span class="comment">Software is furnished to do so, subject to the following</span>
<a name="l00010"></a>00010 <span class="comment">conditions:</span>
<a name="l00011"></a>00011 <span class="comment"></span>
<a name="l00012"></a>00012 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00013"></a>00013 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00014"></a>00014 <span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00016"></a>00016 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span>
<a name="l00017"></a>00017 <span class="comment">OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00018"></a>00018 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</span>
<a name="l00019"></a>00019 <span class="comment">HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</span>
<a name="l00020"></a>00020 <span class="comment">WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<a name="l00021"></a>00021 <span class="comment">FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span>
<a name="l00022"></a>00022 <span class="comment">OTHER DEALINGS IN THE SOFTWARE.</span>
<a name="l00023"></a>00023 <span class="comment">*/</span> 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00025"></a>00025 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &quot;<a class="code" href="types_8h.html">types.h</a>&quot;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="errors_8h.html">errors.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="netlist__utils_8h.html">netlist_utils.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="odin__util_8h.html">odin_util.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="ast__util_8h.html">ast_util.h</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="netlist__create__from__ast_8h.html">netlist_create_from_ast.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="string__cache_8h.html">string_cache.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="netlist__visualizer_8h.html">netlist_visualizer.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="parse__making__ast_8h.html">parse_making_ast.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="node__creation__library_8h.html">node_creation_library.h</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;util.h&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="multipliers_8h.html">multipliers.h</a>&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="comment">/* NAMING CONVENTIONS</span>
<a name="l00042"></a>00042 <span class="comment"> {previous_string}.module_name+instance_name</span>
<a name="l00043"></a>00043 <span class="comment"> {previous_string}.module_name+instance_name^signal_name</span>
<a name="l00044"></a>00044 <span class="comment"> {previous_string}.module_name+instance_name^signal_name-bit</span>
<a name="l00045"></a>00045 <span class="comment">*/</span>
<a name="l00046"></a>00046 
<a name="l00047"></a><a class="code" href="netlist__create__from__ast_8c.html#a50172ed88a30368c1671f227be195ecf">00047</a> <span class="preprocessor">#define INSTANTIATE_DRIVERS 1</span>
<a name="l00048"></a><a class="code" href="netlist__create__from__ast_8c.html#a05b76f4b136cb24bfc9789e0d7f53814">00048</a> <span class="preprocessor"></span><span class="preprocessor">#define ALIAS_INPUTS 2</span>
<a name="l00049"></a>00049 <span class="preprocessor"></span>
<a name="l00050"></a><a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">00050</a> <span class="preprocessor">#define COMBINATIONAL 1</span>
<a name="l00051"></a><a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">00051</a> <span class="preprocessor"></span><span class="preprocessor">#define SEQUENTIAL 2</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a><a class="code" href="netlist__create__from__ast_8c.html#a3fda0fb636d0e542703dc4525bd5ad58">00053</a> <a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html">STRING_CACHE</a> *<a class="code" href="globals_8h.html#a3fda0fb636d0e542703dc4525bd5ad58">output_nets_sc</a>;
<a name="l00054"></a><a class="code" href="netlist__create__from__ast_8c.html#a08378ec7ee0897a1a92c5184cffb5891">00054</a> <a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html">STRING_CACHE</a> *<a class="code" href="globals_8h.html#a08378ec7ee0897a1a92c5184cffb5891">input_nets_sc</a>;
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="netlist__create__from__ast_8c.html#a8c59f10fde83f3dc3a11b171f9482539">00056</a> <a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html">STRING_CACHE</a> *<a class="code" href="globals_8h.html#a8c59f10fde83f3dc3a11b171f9482539">local_symbol_table_sc</a>;
<a name="l00057"></a><a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">00057</a> <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>** <a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>;
<a name="l00058"></a><a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">00058</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a>;
<a name="l00059"></a><a class="code" href="netlist__create__from__ast_8c.html#a0c6d369458ad4371730eabd1d18977c5">00059</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a0c6d369458ad4371730eabd1d18977c5">local_clock_list</a>;
<a name="l00060"></a><a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">00060</a> <span class="keywordtype">short</span> <a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a>;
<a name="l00061"></a><a class="code" href="netlist__create__from__ast_8c.html#a19076ea2a78a080292001e9b209a4a54">00061</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#a19076ea2a78a080292001e9b209a4a54">local_clock_idx</a>;
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/* CONSTANT NET ELEMENTS */</span>
<a name="l00064"></a><a class="code" href="netlist__create__from__ast_8c.html#ada04108a30a26e6d10bc91b00252cde3">00064</a> <span class="keywordtype">char</span> *<a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a> = <span class="stringliteral">&quot;ONE_VCC_CNS&quot;</span>;
<a name="l00065"></a><a class="code" href="netlist__create__from__ast_8c.html#af838b6bfa3e7c05077fb4dbfc807c3c3">00065</a> <span class="keywordtype">char</span> *<a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a> = <span class="stringliteral">&quot;ZERO_GND_ZERO&quot;</span>;
<a name="l00066"></a>00066 
<a name="l00067"></a><a class="code" href="netlist__create__from__ast_8c.html#a443eddc9cb166f09f45c56930f87054f">00067</a> <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *<a class="code" href="globals_8h.html#a443eddc9cb166f09f45c56930f87054f">top_module</a>;
<a name="l00068"></a>00068 
<a name="l00069"></a><a class="code" href="netlist__create__from__ast_8c.html#a22a79894e04b7c7891d95438d90623ff">00069</a> <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>;
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="netlist__create__from__ast_8c.html#af4336add036185ed6ecefa9e1bcebcf4">00071</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#af4336add036185ed6ecefa9e1bcebcf4">netlist_create_line_number</a> = -2;
<a name="l00072"></a>00072 
<a name="l00073"></a><a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">00073</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a>;
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 <span class="comment">/* PROTOTYPES */</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a2b77dfc58cc4c57c00353680b24961bb">convert_ast_to_netlist_recursing_via_modules</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* current_module, <span class="keywordtype">char</span> *instance_name, <span class="keywordtype">int</span> level);
<a name="l00078"></a>00078 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a0966cddf29c600414371fd5ab1f128d9">create_all_driver_nets_in_this_module</a>(<span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a7842a1599ad5d09f496e5b5246646fb0">find_top_module</a>();
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ae30965ee8031c79596925cace77257f9">create_top_driver_nets</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00085"></a>00085 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ad12b9e8fec66fb5a8366561d73cb509a">create_top_output_nodes</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00086"></a>00086 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* <a class="code" href="netlist__create__from__ast_8c.html#a835a20f5e1e228c0824985ed30a6456a">define_nets_with_driver</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00087"></a>00087 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* <a class="code" href="netlist__create__from__ast_8c.html#a0379491c0f5025dc7823eabaa0766377">define_nodes_and_nets_with_driver</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a9d3d12bbf51d0a805323f5c80ee0eb9c">connect_module_instantiation_and_alias</a>(<span class="keywordtype">short</span> PASS, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module_instance, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00090"></a>00090 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a71a62c66359dca3d73088b74e8dd5679">create_symbol_table_for_module</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module_items);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a04d826039e77930b9e696ca0d43ce75d">create_gate</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* gate, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00093"></a>00093 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">create_pins</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *name, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00094"></a>00094 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ac096b2a9a70f0e15d3da9b9cb7731f73">create_output_pin</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00095"></a>00095 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ac647d0a7bbf8fd799f72b12eb23d925b">assignment_alias</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* assignment, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00096"></a>00096 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">create_operation_node</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *op, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **input_lists, <span class="keywordtype">int</span> list_size, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a2d5730a8723be89167a891cafb65c923">terminate_continuous_assignment</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>* assignment, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00099"></a>00099 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#aeb329238f2566626f6cb8209e62a244c">terminate_registered_assignment</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *always_node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>* assignment, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *potential_clocks, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a1f4b4edf7d9492089ecff8fbacc1770c">create_case</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_ast, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00102"></a>00102 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ab1558ae0691b648274e178f2014f5e50">create_case_control_signals</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_list_of_items, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *compare_against, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00103"></a>00103 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a9a453e1a119809870431595d6a9b9458">create_case_mux_statements</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_list_of_items, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00104"></a>00104 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a352ad2eb277ecb9b8ad8548dc399f2be">create_if</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00105"></a>00105 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a4d8b7abf5261ee5477de2d80690f99b9">create_if_control_signals</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_expression, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00106"></a>00106 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a89bcc2d665ec608cfb0b072cf802dd33">create_if_mux_statements</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00107"></a>00107 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#aa13dff4b6fe9e4b559db66aec474fe21">create_if_for_question</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00108"></a>00108 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a496054778bb5e7b0560141eaf2466ba2">create_if_question_mux_expressions</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00109"></a>00109 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#abb64aec8e8618459b3d1d70622456d6d">create_mux_statements</a>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **statement_lists, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node, <span class="keywordtype">int</span> num_statement_lists, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00110"></a>00110 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ae59a3a263c57c921d3347110d86c471f">create_mux_expressions</a>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **expression_lists, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *mux_node, <span class="keywordtype">int</span> num_expression_lists, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a44e584d4c733c722625b383950e8ef07">evaluate_sensitivity_list</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *delay_control, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00113"></a>00113 
<a name="l00114"></a>00114 <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#aa39b79ba64a52bb51bb65281d10d6e56">alias_output_assign_pins_to_inputs</a>(<a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a> *output_list, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *input_list, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node);
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#a996aae68a2788a53e347e7c9ecd4354b">find_smallest_non_numerical</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **input_list, <span class="keywordtype">int</span> num_input_lists);
<a name="l00117"></a>00117 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ac822ec3df17d36632c012c312939bfb4">pad_with_zeros</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *list, <span class="keywordtype">int</span> pad_size, <span class="keywordtype">char</span> *instance_name_prefix);
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a030982cb72f7eaa6bff5f7db2d718f09">look_for_clocks</a>(<a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00122"></a>00122 <span class="comment"> * (function: create_netlist)</span>
<a name="l00123"></a>00123 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00124"></a><a class="code" href="netlist__create__from__ast_8h.html#a7a9b7fef682e742912bfeac1d0e1cfec">00124</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a7a9b7fef682e742912bfeac1d0e1cfec">create_netlist</a>()
<a name="l00125"></a>00125 {
<a name="l00126"></a>00126         <span class="comment">/* just build all the fundamental elements, and then hookup with port definitions...every net has a named net as a variable instance...even modules...the only trick with modules will be instance names.  There are a few implied nets as in Muxes for cases, signals for flip-flops and memories */</span>
<a name="l00127"></a>00127 
<a name="l00128"></a>00128         <span class="comment">/* we will find the top module */</span>
<a name="l00129"></a>00129         <a class="code" href="globals_8h.html#a443eddc9cb166f09f45c56930f87054f">top_module</a> = <a class="code" href="netlist__create__from__ast_8c.html#a7842a1599ad5d09f496e5b5246646fb0">find_top_module</a>();
<a name="l00130"></a>00130 
<a name="l00131"></a>00131         <span class="comment">/* Since the modules are in a tree, we will bottom up build the netlist.  Essentially, we will go to the leafs of the module tree, build them upwards such that when we search for the nets, we will find them and can hook them up at that point */</span>
<a name="l00132"></a>00132         <span class="comment">/* PASS 1 - we make all the nets based on registers defined in modules */</span>
<a name="l00133"></a>00133         
<a name="l00134"></a>00134         <span class="comment">/* initialize the string caches that hold the aliasing of module nets and input pins */</span>
<a name="l00135"></a>00135         output_nets_sc = <a class="code" href="string__cache_8c.html#ad26ff86636f1a8869f03483ad53c7749">sc_new_string_cache</a>();
<a name="l00136"></a>00136         input_nets_sc = <a class="code" href="string__cache_8c.html#ad26ff86636f1a8869f03483ad53c7749">sc_new_string_cache</a>();
<a name="l00137"></a>00137         <span class="comment">/* initialize the storage of the top level drivers.  Assigned in create_top_driver_nets */</span>
<a name="l00138"></a>00138         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a> = <a class="code" href="netlist__utils_8c.html#a88eb12f8127d1a2ec1c77da5c1b1415d">allocate_netlist</a>();
<a name="l00139"></a>00139 
<a name="l00140"></a>00140         <span class="comment">/* now recursively parse the modules by going through the tree of modules starting at top */</span>
<a name="l00141"></a>00141         <a class="code" href="netlist__create__from__ast_8c.html#ae30965ee8031c79596925cace77257f9">create_top_driver_nets</a>(<a class="code" href="globals_8h.html#a443eddc9cb166f09f45c56930f87054f">top_module</a>, <span class="stringliteral">&quot;top&quot;</span>);
<a name="l00142"></a>00142         <a class="code" href="netlist__create__from__ast_8c.html#a2b77dfc58cc4c57c00353680b24961bb">convert_ast_to_netlist_recursing_via_modules</a>(<a class="code" href="globals_8h.html#a443eddc9cb166f09f45c56930f87054f">top_module</a>, <span class="stringliteral">&quot;top&quot;</span>, 0);
<a name="l00143"></a>00143         <a class="code" href="netlist__create__from__ast_8c.html#ad12b9e8fec66fb5a8366561d73cb509a">create_top_output_nodes</a>(<a class="code" href="globals_8h.html#a443eddc9cb166f09f45c56930f87054f">top_module</a>, <span class="stringliteral">&quot;top&quot;</span>);
<a name="l00144"></a>00144 
<a name="l00145"></a>00145         <span class="comment">/* now look for high-level signals */</span>
<a name="l00146"></a>00146         <a class="code" href="netlist__create__from__ast_8c.html#a030982cb72f7eaa6bff5f7db2d718f09">look_for_clocks</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>); 
<a name="l00147"></a>00147 }
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00150"></a>00150 <span class="comment">   * (function: look_for_clocks)</span>
<a name="l00151"></a>00151 <span class="comment">    *-------------------------------------------------------------------------------------------*/</span>
<a name="l00152"></a><a class="code" href="netlist__create__from__ast_8c.html#a030982cb72f7eaa6bff5f7db2d718f09">00152</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a030982cb72f7eaa6bff5f7db2d718f09">look_for_clocks</a>(<a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist)
<a name="l00153"></a>00153 {
<a name="l00154"></a>00154         <span class="keywordtype">int</span> i; 
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="keywordflow">for</span> (i = 0; i &lt; netlist-&gt;num_ff_nodes; i++)
<a name="l00157"></a>00157         {
<a name="l00158"></a>00158                 <span class="keywordflow">if</span> (netlist-&gt;ff_nodes[i]-&gt;input_pins[1]-&gt;net-&gt;driver_pin-&gt;node-&gt;type != <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a69d9f9301e328471a4251634991ae325">CLOCK_NODE</a>)
<a name="l00159"></a>00159                 {
<a name="l00160"></a>00160                         netlist-&gt;ff_nodes[i]-&gt;input_pins[1]-&gt;net-&gt;driver_pin-&gt;node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a69d9f9301e328471a4251634991ae325">CLOCK_NODE</a>;
<a name="l00161"></a>00161                 }
<a name="l00162"></a>00162         }
<a name="l00163"></a>00163 }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00166"></a>00166 <span class="comment"> * (function: find_top_module)</span>
<a name="l00167"></a>00167 <span class="comment"> *      Finds the top module based on that it is not called by anyone else</span>
<a name="l00168"></a>00168 <span class="comment"> *      Assumes there is only one top</span>
<a name="l00169"></a>00169 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00170"></a><a class="code" href="netlist__create__from__ast_8c.html#a7842a1599ad5d09f496e5b5246646fb0">00170</a> <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a7842a1599ad5d09f496e5b5246646fb0">find_top_module</a>()
<a name="l00171"></a>00171 {
<a name="l00172"></a>00172         <span class="keywordtype">int</span> i, j;
<a name="l00173"></a>00173         <span class="keywordtype">long</span> sc_spot;
<a name="l00174"></a>00174         <span class="keywordtype">int</span> found_top = -1;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176         <span class="comment">/* go through all the instantiations for each module and mark them if they&#39;ve be instantiated */</span>
<a name="l00177"></a>00177         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="globals_8h.html#aa58389a4ca1d97263e51566b568dd2d2">num_modules</a>; i++)
<a name="l00178"></a>00178         {
<a name="l00179"></a>00179                 <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;types.module.size_module_instantiations; j++)
<a name="l00180"></a>00180                 {
<a name="l00181"></a>00181                         <span class="comment">/* get the module index from the string cache */</span>
<a name="l00182"></a>00182                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;types.module.module_instantiations_instance[j]-&gt;children[0]-&gt;types.identifier)) == -1)
<a name="l00183"></a>00183                         {
<a name="l00184"></a>00184                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;line_number, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;file_number, <span class="stringliteral">&quot;Can&#39;t find module name (%s)\n&quot;</span>, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;types.module.module_instantiations_instance[j]-&gt;types.identifier);
<a name="l00185"></a>00185                         }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                         <span class="comment">/* use that number to mark this module as instantiated */</span>
<a name="l00188"></a>00188                         <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.module.index]-&gt;types.module.is_instantiated = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00189"></a>00189                 }
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <span class="comment">/* now check for which module wasn&#39;t marked...this one will be the top */</span>
<a name="l00193"></a>00193         <span class="keywordflow">for</span> (i = 0; i &lt; num_modules; i++)
<a name="l00194"></a>00194         {
<a name="l00195"></a>00195                 <span class="keywordflow">if</span> ((<a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;types.module.is_instantiated == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp; (found_top == -1))
<a name="l00196"></a>00196                 {
<a name="l00197"></a>00197                         found_top = i;
<a name="l00198"></a>00198                 }
<a name="l00199"></a>00199                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;types.module.is_instantiated == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp; (found_top != -1))
<a name="l00200"></a>00200                 {
<a name="l00201"></a>00201                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;line_number, <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[i]-&gt;file_number, <span class="stringliteral">&quot;Two top level modules - Odin II cannot deal with these types of designs\n&quot;</span>);
<a name="l00202"></a>00202                 }
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205         <span class="comment">/* check atleast one module is top ... and only one */</span>
<a name="l00206"></a>00206         <span class="keywordflow">if</span> (found_top == -1)
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, -1, -1, <span class="stringliteral">&quot;Could not find a top level module\n&quot;</span>);
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211         <span class="keywordflow">return</span> <a class="code" href="globals_8h.html#a3e11c0346a684a46d3002c81acdda9f6">ast_modules</a>[found_top];
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00215"></a>00215 <span class="comment"> * (function: convert_ast_to_netlist_recursing_via_modules)</span>
<a name="l00216"></a>00216 <span class="comment"> *      Recurses through modules by depth first traversal of the tree of modules.  Expands</span>
<a name="l00217"></a>00217 <span class="comment"> *      the netlists at each level.</span>
<a name="l00218"></a>00218 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00219"></a><a class="code" href="netlist__create__from__ast_8c.html#a2b77dfc58cc4c57c00353680b24961bb">00219</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a2b77dfc58cc4c57c00353680b24961bb">convert_ast_to_netlist_recursing_via_modules</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* current_module, <span class="keywordtype">char</span> *instance_name, <span class="keywordtype">int</span> level)
<a name="l00220"></a>00220 {
<a name="l00221"></a>00221         <span class="keywordtype">int</span> i;
<a name="l00222"></a>00222         <span class="keywordtype">long</span> sc_spot;
<a name="l00223"></a>00223         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *list = NULL;
<a name="l00224"></a>00224 
<a name="l00225"></a>00225         <span class="comment">/* BASE CASE is when there are no other instantiations of modules in this module */</span>
<a name="l00226"></a>00226         <span class="keywordflow">if</span> (current_module-&gt;types.module.size_module_instantiations == 0)
<a name="l00227"></a>00227         {
<a name="l00228"></a>00228                 list = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(current_module, instance_name);
<a name="l00229"></a>00229         }
<a name="l00230"></a>00230         <span class="keywordflow">else</span>
<a name="l00231"></a>00231         {
<a name="l00232"></a>00232                 <span class="comment">/* ELSE - we need to visit all the children before */</span>   
<a name="l00233"></a>00233                 <span class="keywordflow">for</span> (i = 0; i &lt; current_module-&gt;types.module.size_module_instantiations; i++)
<a name="l00234"></a>00234                 {
<a name="l00235"></a>00235                         <span class="keywordtype">char</span> *temp_instance_name;
<a name="l00236"></a>00236                         <span class="comment">/* make the stringed up module instance name - instance name is MODULE_INSTANCE-&gt;MODULE_NAMED_INSTANCE(child[1])-&gt;IDENTIFIER(child[0]).  module name is MODULE_INSTANCE-&gt;IDENTIFIER(child[0]) */</span>
<a name="l00237"></a>00237                         temp_instance_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name, current_module-&gt;types.module.module_instantiations_instance[i]-&gt;children[0]-&gt;types.identifier, current_module-&gt;types.module.module_instantiations_instance[i]-&gt;children[1]-&gt;children[0]-&gt;types.identifier, NULL, -1);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                         <span class="comment">/* lookup the name of the module associated with this instantiated point */</span>
<a name="l00240"></a>00240                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>, current_module-&gt;types.module.module_instantiations_instance[i]-&gt;children[0]-&gt;types.identifier)) == -1)
<a name="l00241"></a>00241                         {
<a name="l00242"></a>00242                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, current_module-&gt;line_number, current_module-&gt;file_number, <span class="stringliteral">&quot;Can&#39;t find module name %s\n&quot;</span>, current_module-&gt;types.module.module_instantiations_instance[i]-&gt;children[0]-&gt;types.identifier);
<a name="l00243"></a>00243                         }
<a name="l00244"></a>00244 
<a name="l00245"></a>00245                         <span class="comment">/* recursive call point */</span>
<a name="l00246"></a>00246                         <a class="code" href="netlist__create__from__ast_8c.html#a2b77dfc58cc4c57c00353680b24961bb">convert_ast_to_netlist_recursing_via_modules</a>(((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot]), temp_instance_name, level+1);
<a name="l00247"></a>00247 
<a name="l00248"></a>00248                         <span class="comment">/* free the string */</span>
<a name="l00249"></a>00249                         free(temp_instance_name);
<a name="l00250"></a>00250                 }
<a name="l00251"></a>00251                 
<a name="l00252"></a>00252                 <span class="comment">/* once we&#39;ve done everyone lower, we can do this module */</span>
<a name="l00253"></a>00253                 <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(current_module, instance_name);
<a name="l00254"></a>00254         }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (list != NULL)
<a name="l00257"></a>00257                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(list);
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00261"></a>00261 <span class="comment"> * (function: netlist_expand_ast_of_module)</span>
<a name="l00262"></a>00262 <span class="comment"> *      Main recursion point that looks at the abstract syntax tree.</span>
<a name="l00263"></a>00263 <span class="comment"> *      Allows for a pre amble, looks at children (dfs), then does post amble</span>
<a name="l00264"></a>00264 <span class="comment"> *      Can skip children traverse and the ambles...</span>
<a name="l00265"></a>00265 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00266"></a><a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">00266</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268         <span class="comment">/* with the top module we need to visit the entire ast tree */</span>
<a name="l00269"></a>00269         <span class="keywordtype">int</span> i;
<a name="l00270"></a>00270         <span class="keywordtype">short</span> *child_skip_list = NULL; <span class="comment">// list of children not to traverse into</span>
<a name="l00271"></a>00271         <span class="keywordtype">short</span> skip_children = <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>; <span class="comment">// skips the DFS completely if TRUE </span>
<a name="l00272"></a>00272         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_sig_list = NULL;
<a name="l00273"></a>00273         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **children_signal_list = NULL;
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordflow">if</span> (node == NULL)
<a name="l00276"></a>00276         {
<a name="l00277"></a>00277                 <span class="comment">/* print out the node and label details */</span>
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279         <span class="keywordflow">else</span>
<a name="l00280"></a>00280         {
<a name="l00281"></a>00281                 <span class="comment">/* make a skip list of nodes in the tree we don&#39;t need to visit for this node.  For example, a module we know that the 0th entry is the identifier of the module */</span>
<a name="l00282"></a>00282                 <span class="keywordflow">if</span> (node-&gt;num_children &gt; 0)
<a name="l00283"></a>00283                 {
<a name="l00284"></a>00284                         child_skip_list = (<span class="keywordtype">short</span>*)calloc(node-&gt;num_children, <span class="keyword">sizeof</span>(<span class="keywordtype">short</span>));
<a name="l00285"></a>00285                         children_signal_list = (<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>*)*node-&gt;num_children);
<a name="l00286"></a>00286                 }
<a name="l00287"></a>00287 
<a name="l00288"></a>00288                 <span class="comment">/* ------------------------------------------------------------------------------*/</span>
<a name="l00289"></a>00289                 <span class="comment">/* PRE AMBLE */</span>
<a name="l00290"></a>00290                 <span class="keywordflow">switch</span>(node-&gt;type)
<a name="l00291"></a>00291                 {
<a name="l00292"></a>00292                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a60f2cef3545623113344390d224c2de7">FILE_ITEMS</a>:
<a name="l00293"></a>00293                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00294"></a>00294                                 <span class="keywordflow">break</span>;
<a name="l00295"></a>00295                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a89e95e5d1ee3b8077a76005fb143771c">MODULE</a>: 
<a name="l00296"></a>00296                                 <span class="comment">/* set the skip list */</span>
<a name="l00297"></a>00297                                 child_skip_list[0] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* skip the identifier */</span>
<a name="l00298"></a>00298                                 child_skip_list[1] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>; <span class="comment">/* skip portlist ... we&#39;ll use where they&#39;re defined */</span>
<a name="l00299"></a>00299                                 <span class="keywordflow">break</span>;
<a name="l00300"></a>00300                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9af290f4f92414377fd83c15a8ddf5e5d1">MODULE_ITEMS</a>: 
<a name="l00301"></a>00301                                 <span class="comment">/* items include: wire, reg, input, outputs, assign, gate, module_instance, always */</span>
<a name="l00302"></a>00302 
<a name="l00303"></a>00303                                 <span class="comment">/* make the symbol table */</span>
<a name="l00304"></a>00304                                 local_symbol_table_sc = <a class="code" href="string__cache_8c.html#ad26ff86636f1a8869f03483ad53c7749">sc_new_string_cache</a>();
<a name="l00305"></a>00305                                 <a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a> = NULL;
<a name="l00306"></a>00306                                 <a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a> = 0;
<a name="l00307"></a>00307                                 <a class="code" href="netlist__create__from__ast_8c.html#a71a62c66359dca3d73088b74e8dd5679">create_symbol_table_for_module</a>(node);
<a name="l00308"></a>00308                                 <a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a> = <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310                                 <span class="comment">/* create all the driven nets based on the &quot;reg&quot; registers */</span>           
<a name="l00311"></a>00311                                 <a class="code" href="netlist__create__from__ast_8c.html#a0966cddf29c600414371fd5ab1f128d9">create_all_driver_nets_in_this_module</a>(instance_name_prefix);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313                                 <span class="comment">/* process elements in the list */</span>
<a name="l00314"></a>00314                                 <span class="keywordflow">if</span> (node-&gt;num_children &gt; 0)
<a name="l00315"></a>00315                                 {
<a name="l00316"></a>00316                                         <span class="keywordflow">for</span> (i = 0; i &lt; node-&gt;num_children; i++)
<a name="l00317"></a>00317                                         {
<a name="l00318"></a>00318                                                 <span class="keywordflow">if</span> (node-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aec21f0859c48ef028e3926edb3a8e5e4">VAR_DECLARE_LIST</a>)
<a name="l00319"></a>00319                                                 {
<a name="l00320"></a>00320                                                         <span class="comment">/* IF - The port lists of this module are handled else where */</span>
<a name="l00321"></a>00321                                                         child_skip_list[i] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00322"></a>00322                                                 }
<a name="l00323"></a>00323                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (node-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a06a5b8ceb7e4c37c84c75cb6afa3b0b0">MODULE_INSTANCE</a>)
<a name="l00324"></a>00324                                                 {
<a name="l00325"></a>00325                                                         <span class="comment">/* ELSE IF - we deal with instantiations of modules twice to alias input and output nets.  In this</span>
<a name="l00326"></a>00326 <span class="comment"> *                                                      pass we are looking for any drivers emerging from a module */</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328                                                         <span class="comment">/* make the aliases for all the drivers as they&#39;re passed through modules */</span>
<a name="l00329"></a>00329                                                         <a class="code" href="netlist__create__from__ast_8c.html#a9d3d12bbf51d0a805323f5c80ee0eb9c">connect_module_instantiation_and_alias</a>(<a class="code" href="netlist__create__from__ast_8c.html#a50172ed88a30368c1671f227be195ecf">INSTANTIATE_DRIVERS</a>, node-&gt;children[i], instance_name_prefix);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331                                                         <span class="comment">/* is a call site for another module.  Alias names to nets and pins */</span>
<a name="l00332"></a>00332                                                         child_skip_list[i] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00333"></a>00333                                                 }
<a name="l00334"></a>00334                                         }
<a name="l00335"></a>00335                                 }
<a name="l00336"></a>00336                                 <span class="keywordflow">break</span>;
<a name="l00337"></a>00337                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ac00a9212e2a45c125c4e3ca32bbfc0f8">GATE</a>:
<a name="l00338"></a>00338                                 <span class="comment">/* create gate instances */</span>
<a name="l00339"></a>00339                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#a04d826039e77930b9e696ca0d43ce75d">create_gate</a>(node, instance_name_prefix);
<a name="l00340"></a>00340                                 <span class="comment">/* create_gate does it&#39;s own instantiations so skip the children in the traverse */</span>
<a name="l00341"></a>00341                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00342"></a>00342                                 <span class="keywordflow">break</span>;
<a name="l00343"></a>00343                         <span class="comment">/* ---------------------- */</span>
<a name="l00344"></a>00344                         <span class="comment">/* All these are input references that we need to grab their pins from by create_pin */</span>
<a name="l00345"></a>00345                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9afe727b716a2fe1eaf68577b3f7f2baed">ARRAY_REF</a>:
<a name="l00346"></a>00346                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a899f5dc4f6e0a542b92e8c9b11f57772">CONCATENATE</a>:
<a name="l00347"></a>00347                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ad5b393d5fddcaa6f6035af079fc90e16">IDENTIFIERS</a>:
<a name="l00348"></a>00348                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a8219a9ee90e3d028b8fd4acb415bfa63">RANGE_REF</a>:
<a name="l00349"></a>00349                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aae943f711ea7d1a4724ccd3a7f2c21ee">NUMBERS</a>: 
<a name="l00350"></a>00350                         {
<a name="l00351"></a>00351                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">create_pins</a>(node, NULL, instance_name_prefix);
<a name="l00352"></a>00352                                 <span class="comment">/* children are traversed in the create_pin function */</span>
<a name="l00353"></a>00353                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00354"></a>00354                                 <span class="keywordflow">break</span>;
<a name="l00355"></a>00355                         }
<a name="l00356"></a>00356                         <span class="comment">/* ---------------------- */</span>
<a name="l00357"></a>00357                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a52a9b031766fa116251f70e65a84c01a">ASSIGN</a>:
<a name="l00358"></a>00358                                 <span class="comment">/* combinational path */</span>
<a name="l00359"></a>00359                                 <a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> = <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>;
<a name="l00360"></a>00360                                 <span class="keywordflow">break</span>;
<a name="l00361"></a>00361                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a80ff10278d07a37081175778964e04d9">BLOCKING_STATEMENT</a>:
<a name="l00362"></a>00362                                 <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>)
<a name="l00363"></a>00363                                 {
<a name="l00364"></a>00364                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;ODIN doesn&#39;t handle blocking statements in Sequential blocks\n&quot;</span>);
<a name="l00365"></a>00365                                 }
<a name="l00366"></a>00366                                 <span class="keywordflow">else</span>
<a name="l00367"></a>00367                                 {
<a name="l00368"></a>00368                                         return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#ac647d0a7bbf8fd799f72b12eb23d925b">assignment_alias</a>(node, instance_name_prefix);         
<a name="l00369"></a>00369                                         skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00370"></a>00370                                 }
<a name="l00371"></a>00371                                 <span class="keywordflow">break</span>;
<a name="l00372"></a>00372                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9adaabc73a895dfa8964dc7a7fea9db6fe">NON_BLOCKING_STATEMENT</a>:
<a name="l00373"></a>00373                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>);
<a name="l00374"></a>00374                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#ac647d0a7bbf8fd799f72b12eb23d925b">assignment_alias</a>(node, instance_name_prefix);         
<a name="l00375"></a>00375                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00376"></a>00376                                 <span class="keywordflow">break</span>;
<a name="l00377"></a>00377                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a0f06c1c574ca2769a23fe384c2b1a353">ALWAYS</a>:
<a name="l00378"></a>00378                                 <span class="comment">/* evaluate if this is a sensitivity list with posedges/negedges (=SEQUENTIAL) or none (=COMBINATIONAL) */</span>
<a name="l00379"></a>00379                                 <a class="code" href="netlist__create__from__ast_8c.html#a0c6d369458ad4371730eabd1d18977c5">local_clock_list</a> = <a class="code" href="netlist__create__from__ast_8c.html#a44e584d4c733c722625b383950e8ef07">evaluate_sensitivity_list</a>(node-&gt;children[0], instance_name_prefix);
<a name="l00380"></a>00380                                 child_skip_list[0] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00381"></a>00381                                 <span class="keywordflow">break</span>;
<a name="l00382"></a>00382                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a9c9b14644e9370719a51b7342bbc9c4d">CASE</a>:
<a name="l00383"></a>00383                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#a1f4b4edf7d9492089ecff8fbacc1770c">create_case</a>(node, instance_name_prefix);
<a name="l00384"></a>00384                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00385"></a>00385                                 <span class="keywordflow">break</span>;
<a name="l00386"></a>00386                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a252802eda493fb6b4a279c4452acb547">IF</a>:
<a name="l00387"></a>00387                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#a352ad2eb277ecb9b8ad8548dc399f2be">create_if</a>(node, instance_name_prefix);
<a name="l00388"></a>00388                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00389"></a>00389                                 <span class="keywordflow">break</span>;
<a name="l00390"></a>00390                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ad000a9aeb97667c4738ae2052e76fc20">IF_Q</a>:
<a name="l00391"></a>00391                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#aa13dff4b6fe9e4b559db66aec474fe21">create_if_for_question</a>(node, instance_name_prefix);
<a name="l00392"></a>00392                                 skip_children = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00393"></a>00393                                 <span class="keywordflow">break</span>;
<a name="l00394"></a>00394                         <span class="keywordflow">default</span>:
<a name="l00395"></a>00395                                 <span class="keywordflow">break</span>;
<a name="l00396"></a>00396                 }       
<a name="l00397"></a>00397                 <span class="comment">/* ------------------------------------------------------------------------------*/</span>
<a name="l00398"></a>00398                 <span class="comment">/* This is the depth first traverse (DFT aka DFS) of the ast nodes that make up the netlist. */</span>
<a name="l00399"></a>00399                 <span class="keywordflow">if</span> (skip_children == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00400"></a>00400                 {
<a name="l00401"></a>00401                         <span class="comment">/* traverse all the children */</span>
<a name="l00402"></a>00402                         <span class="keywordflow">for</span> (i = 0; i &lt; node-&gt;num_children; i++)
<a name="l00403"></a>00403                         {
<a name="l00404"></a>00404                                 <span class="keywordflow">if</span> (child_skip_list[i] == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l00405"></a>00405                                 {
<a name="l00406"></a>00406                                         <span class="comment">/* recursively call through the tree going to each instance.  This is depth first traverse. */</span>
<a name="l00407"></a>00407                                         children_signal_list[i] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(node-&gt;children[i], instance_name_prefix);
<a name="l00408"></a>00408                                 }
<a name="l00409"></a>00409                         }
<a name="l00410"></a>00410                 }
<a name="l00411"></a>00411 
<a name="l00412"></a>00412                 <span class="comment">/* ------------------------------------------------------------------------------*/</span>
<a name="l00413"></a>00413                 <span class="comment">/* POST AMBLE - process the children */</span>
<a name="l00414"></a>00414                 <span class="keywordflow">switch</span>(node-&gt;type)
<a name="l00415"></a>00415                 {
<a name="l00416"></a>00416                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a60f2cef3545623113344390d224c2de7">FILE_ITEMS</a>:
<a name="l00417"></a>00417                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00418"></a>00418                                 <span class="keywordflow">break</span>;
<a name="l00419"></a>00419                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9af290f4f92414377fd83c15a8ddf5e5d1">MODULE_ITEMS</a>: 
<a name="l00420"></a>00420                         {
<a name="l00421"></a>00421                                 <span class="keywordflow">if</span> (node-&gt;num_children &gt; 0)
<a name="l00422"></a>00422                                 {
<a name="l00423"></a>00423                                         <span class="keywordflow">for</span> (i = 0; i &lt; node-&gt;num_children; i++)
<a name="l00424"></a>00424                                         {
<a name="l00425"></a>00425                                                 <span class="keywordflow">if</span> (node-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a06a5b8ceb7e4c37c84c75cb6afa3b0b0">MODULE_INSTANCE</a>)
<a name="l00426"></a>00426                                                 {
<a name="l00427"></a>00427                                                         <span class="comment">/* make the aliases for all the drivers as they&#39;re passed through modules.  This is the</span>
<a name="l00428"></a>00428 <span class="comment">                                                        second time we call this */</span>
<a name="l00429"></a>00429                                                         <a class="code" href="netlist__create__from__ast_8c.html#a9d3d12bbf51d0a805323f5c80ee0eb9c">connect_module_instantiation_and_alias</a>(<a class="code" href="netlist__create__from__ast_8c.html#a05b76f4b136cb24bfc9789e0d7f53814">ALIAS_INPUTS</a>, node-&gt;children[i], instance_name_prefix);
<a name="l00430"></a>00430                                                 }
<a name="l00431"></a>00431                                         }
<a name="l00432"></a>00432                                 }
<a name="l00433"></a>00433 
<a name="l00434"></a>00434                                 <span class="comment">/* free the symbol table for this module since we&#39;re done processing */</span>
<a name="l00435"></a>00435                                 <a class="code" href="string__cache_8c.html#a3ec9e1031f33954c9b4d6aa553107eb9">sc_free_string_cache</a>(local_symbol_table_sc);
<a name="l00436"></a>00436                                 free(<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>);
<a name="l00437"></a>00437 
<a name="l00438"></a>00438                                 <span class="keywordflow">break</span>;
<a name="l00439"></a>00439                         }
<a name="l00440"></a>00440                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a52a9b031766fa116251f70e65a84c01a">ASSIGN</a>:
<a name="l00441"></a>00441                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(node-&gt;num_children == 1);       
<a name="l00442"></a>00442                                 <span class="comment">/* attach the drivers to the driver nets */</span>
<a name="l00443"></a>00443                                 <a class="code" href="netlist__create__from__ast_8c.html#a2d5730a8723be89167a891cafb65c923">terminate_continuous_assignment</a>(node, children_signal_list[0], instance_name_prefix);   
<a name="l00444"></a>00444                                 <span class="keywordflow">break</span>;
<a name="l00445"></a>00445                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a0f06c1c574ca2769a23fe384c2b1a353">ALWAYS</a>:
<a name="l00446"></a>00446                                 <span class="comment">/* attach the drivers to the driver nets */</span>
<a name="l00447"></a>00447                                 <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>)
<a name="l00448"></a>00448                                 {
<a name="l00449"></a>00449                                         <span class="comment">/* idx 1 element since alwayss has DELAY Control first */</span>
<a name="l00450"></a>00450                                         <a class="code" href="netlist__create__from__ast_8c.html#a2d5730a8723be89167a891cafb65c923">terminate_continuous_assignment</a>(node, children_signal_list[1], instance_name_prefix);   
<a name="l00451"></a>00451                                 }
<a name="l00452"></a>00452                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>)
<a name="l00453"></a>00453                                 {
<a name="l00454"></a>00454                                         <a class="code" href="netlist__create__from__ast_8c.html#aeb329238f2566626f6cb8209e62a244c">terminate_registered_assignment</a>(node, children_signal_list[1], <a class="code" href="netlist__create__from__ast_8c.html#a0c6d369458ad4371730eabd1d18977c5">local_clock_list</a>, instance_name_prefix);         
<a name="l00455"></a>00455                                 }
<a name="l00456"></a>00456                                 <span class="keywordflow">else</span>
<a name="l00457"></a>00457                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00458"></a>00458                                 <span class="keywordflow">break</span>;
<a name="l00459"></a>00459                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a0631032a7f253d2e76abfda7ef5a424c">BINARY_OPERATION</a>: 
<a name="l00460"></a>00460                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(node-&gt;num_children == 2);
<a name="l00461"></a>00461                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">create_operation_node</a>(node, children_signal_list, node-&gt;num_children, instance_name_prefix);
<a name="l00462"></a>00462                                 <span class="keywordflow">break</span>;
<a name="l00463"></a>00463                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a8f90b88f84c6d6fde7fa754fc019165a">UNARY_OPERATION</a>:
<a name="l00464"></a>00464                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(node-&gt;num_children == 1);
<a name="l00465"></a>00465                                 return_sig_list = <a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">create_operation_node</a>(node, children_signal_list, node-&gt;num_children, instance_name_prefix);
<a name="l00466"></a>00466                                 <span class="keywordflow">break</span>;
<a name="l00467"></a>00467                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a02fc27068fe9a3c151ffcc08ec5bb65d">BLOCK</a>: 
<a name="l00468"></a>00468                                 return_sig_list = <a class="code" href="netlist__utils_8c.html#acf3337e560cc49787dcdec721a7b8f77">combine_lists</a>(children_signal_list, node-&gt;num_children);
<a name="l00469"></a>00469                                 <span class="keywordflow">break</span>;
<a name="l00470"></a>00470                         <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a252802eda493fb6b4a279c4452acb547">IF</a>:
<a name="l00471"></a>00471                         <span class="keywordflow">default</span>:
<a name="l00472"></a>00472                                 <span class="keywordflow">break</span>;
<a name="l00473"></a>00473                 }
<a name="l00474"></a>00474                 <span class="comment">/* ------------------------------------------------------------------------------*/</span>
<a name="l00475"></a>00475         }
<a name="l00476"></a>00476 
<a name="l00477"></a>00477         <span class="comment">/* cleaning */</span>
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (child_skip_list != NULL)
<a name="l00479"></a>00479         {
<a name="l00480"></a>00480                 free(child_skip_list);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482         <span class="keywordflow">if</span> (children_signal_list != NULL)
<a name="l00483"></a>00483         {
<a name="l00484"></a>00484                 free(children_signal_list);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <span class="keywordflow">return</span> return_sig_list;
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00491"></a>00491 <span class="comment"> * (function: create_all_driver_nets_in_this_module)</span>
<a name="l00492"></a>00492 <span class="comment"> *      Use to define all the nets that will connect to instantiated nodes.  This means we go</span>
<a name="l00493"></a>00493 <span class="comment"> *      through the var_declare_list of module variables and all registers are made</span>
<a name="l00494"></a>00494 <span class="comment"> *      as drivers.</span>
<a name="l00495"></a>00495 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00496"></a><a class="code" href="netlist__create__from__ast_8c.html#a0966cddf29c600414371fd5ab1f128d9">00496</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a0966cddf29c600414371fd5ab1f128d9">create_all_driver_nets_in_this_module</a>(<span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498         <span class="comment">/* with the top module we need to visit the entire ast tree */</span>
<a name="l00499"></a>00499         <span class="keywordtype">int</span> i;
<a name="l00500"></a>00500 
<a name="l00501"></a>00501         <span class="comment">/* use the symbol table to decide if driver */</span>
<a name="l00502"></a>00502         <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a>; i++)
<a name="l00503"></a>00503         {
<a name="l00504"></a>00504                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ae6f306bdb4bd439fd9e46256abbd9892">VAR_DECLARE</a>);
<a name="l00505"></a>00505                 <span class="keywordflow">if</span> (    (<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_reg) <span class="comment">/* all registers are drivers */</span> 
<a name="l00506"></a>00506                         ||
<a name="l00507"></a>00507                         ((<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_wire) &amp;&amp; (<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_input == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) <span class="comment">/* a wire that is an input can be a driver */</span>
<a name="l00508"></a>00508                         ||
<a name="l00509"></a>00509                         ((<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_output) &amp;&amp; (<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_reg == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>) &amp;&amp; (<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i]-&gt;types.variable.is_wire == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) <span class="comment">/* any output that has nothing else is an implied wire driver */</span>
<a name="l00510"></a>00510                    )
<a name="l00511"></a>00511                 {
<a name="l00512"></a>00512                         <span class="comment">/* create nets based on this driver as the name */</span>
<a name="l00513"></a>00513                         <a class="code" href="netlist__create__from__ast_8c.html#a835a20f5e1e228c0824985ed30a6456a">define_nets_with_driver</a>(<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[i], instance_name_prefix);
<a name="l00514"></a>00514                 }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516         }
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00520"></a>00520 <span class="comment"> * (function: create_top_driver_nets)</span>
<a name="l00521"></a>00521 <span class="comment"> *      This function creates the drivers for the top module.  Top module is slightly </span>
<a name="l00522"></a>00522 <span class="comment"> *      special since all inputs are actually drivers.</span>
<a name="l00523"></a>00523 <span class="comment"> *      Also make the 0 and 1 constant nodes at this point.</span>
<a name="l00524"></a>00524 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00525"></a><a class="code" href="netlist__create__from__ast_8c.html#ae30965ee8031c79596925cace77257f9">00525</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ae30965ee8031c79596925cace77257f9">create_top_driver_nets</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00526"></a>00526 {
<a name="l00527"></a>00527         <span class="comment">/* with the top module we need to visit the entire ast tree */</span>
<a name="l00528"></a>00528         <span class="keywordtype">int</span> i, j;
<a name="l00529"></a>00529         <span class="keywordtype">long</span> sc_spot;
<a name="l00530"></a>00530         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_items = module-&gt;children[2];
<a name="l00531"></a>00531         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l00532"></a>00532 
<a name="l00533"></a>00533         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(module_items-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9af290f4f92414377fd83c15a8ddf5e5d1">MODULE_ITEMS</a>);
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <span class="comment">/* search for VAR_DECLARE_LISTS */</span>
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (module_items-&gt;num_children &gt; 0)
<a name="l00537"></a>00537         {
<a name="l00538"></a>00538                 <span class="keywordflow">for</span> (i = 0; i &lt; module_items-&gt;num_children; i++)
<a name="l00539"></a>00539                 {
<a name="l00540"></a>00540                         <span class="keywordflow">if</span> (module_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aec21f0859c48ef028e3926edb3a8e5e4">VAR_DECLARE_LIST</a>)
<a name="l00541"></a>00541                         {
<a name="l00542"></a>00542                                 <span class="comment">/* go through the vars in this declare list looking for inputs to make drivers */</span>
<a name="l00543"></a>00543                                 <span class="keywordflow">for</span> (j = 0; j &lt; module_items-&gt;children[i]-&gt;num_children; j++)
<a name="l00544"></a>00544                                 {       
<a name="l00545"></a>00545                                         <span class="keywordflow">if</span> (module_items-&gt;children[i]-&gt;children[j]-&gt;types.variable.is_input)
<a name="l00546"></a>00546                                         {
<a name="l00547"></a>00547                                                 <a class="code" href="netlist__create__from__ast_8c.html#a0379491c0f5025dc7823eabaa0766377">define_nodes_and_nets_with_driver</a>(module_items-&gt;children[i]-&gt;children[j], instance_name_prefix);
<a name="l00548"></a>00548                                         }
<a name="l00549"></a>00549                                 }
<a name="l00550"></a>00550                         }
<a name="l00551"></a>00551                 }
<a name="l00552"></a>00552         }
<a name="l00553"></a>00553         <span class="keywordflow">else</span>
<a name="l00554"></a>00554         {
<a name="l00555"></a>00555                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_items-&gt;line_number, module_items-&gt;file_number, <span class="stringliteral">&quot;Module is empty\n&quot;</span>);
<a name="l00556"></a>00556         }
<a name="l00557"></a>00557 
<a name="l00558"></a>00558         <span class="comment">/* create the constant nets */</span>
<a name="l00559"></a>00559         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00560"></a>00560         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00561"></a>00561         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a0abe352aa2acd31975f0f7416b282e9d">GND_NODE</a>;
<a name="l00562"></a>00562         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node, 1);
<a name="l00563"></a>00563         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node, 1);
<a name="l00564"></a>00564         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00565"></a>00565         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node, new_pin, 0);
<a name="l00566"></a>00566         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net, new_pin);
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00569"></a>00569         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00570"></a>00570         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ae11d61bb47dc94e76efe974f9e2dfa26">VCC_NODE</a>;
<a name="l00571"></a>00571         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node, 1);
<a name="l00572"></a>00572         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node, 1);
<a name="l00573"></a>00573         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00574"></a>00574         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node, new_pin, 0);
<a name="l00575"></a>00575         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net, new_pin);
<a name="l00576"></a>00576 
<a name="l00577"></a>00577         <span class="comment">/* CREATE the driver for the ZERO */</span>
<a name="l00578"></a>00578         <a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a> = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, <a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a>, -1);
<a name="l00579"></a>00579         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;gnd_node-&gt;name = <a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a>;
<a name="l00580"></a>00580 
<a name="l00581"></a>00581         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, <a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a>);
<a name="l00582"></a>00582         <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00583"></a>00583         {
<a name="l00584"></a>00584                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_items-&gt;line_number, module_items-&gt;file_number, <span class="stringliteral">&quot;Error in Odin\n&quot;</span>);
<a name="l00585"></a>00585         }
<a name="l00586"></a>00586         <span class="comment">/* store the data which is an idx here */</span>
<a name="l00587"></a>00587         output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net;
<a name="l00588"></a>00588         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net-&gt;name = <a class="code" href="globals_8h.html#af838b6bfa3e7c05077fb4dbfc807c3c3">zero_string</a>;
<a name="l00589"></a>00589 
<a name="l00590"></a>00590         <span class="comment">/* CREATE the driver for the ONE and store twice */</span>
<a name="l00591"></a>00591         <a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a> = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, <a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a>, -1);
<a name="l00592"></a>00592         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;vcc_node-&gt;name = <a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a>;
<a name="l00593"></a>00593 
<a name="l00594"></a>00594         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, <a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a>);
<a name="l00595"></a>00595         <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00596"></a>00596         {
<a name="l00597"></a>00597                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_items-&gt;line_number, module_items-&gt;file_number, <span class="stringliteral">&quot;Error in Odin\n&quot;</span>);
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599         <span class="comment">/* store the data which is an idx here */</span>
<a name="l00600"></a>00600         output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net;
<a name="l00601"></a>00601         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net-&gt;name = <a class="code" href="globals_8h.html#ada04108a30a26e6d10bc91b00252cde3">one_string</a>;
<a name="l00602"></a>00602 }
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00605"></a>00605 <span class="comment"> * (function: create_top_output_nodes)</span>
<a name="l00606"></a>00606 <span class="comment"> *      This function is for the top module and makes references for the output pins</span>
<a name="l00607"></a>00607 <span class="comment"> *      as actual nodes in the netlist and hooks them up to the netlist as it has been </span>
<a name="l00608"></a>00608 <span class="comment"> *      created.  Therefore, this is one of the last steps when creating the netlist.</span>
<a name="l00609"></a>00609 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00610"></a><a class="code" href="netlist__create__from__ast_8c.html#ad12b9e8fec66fb5a8366561d73cb509a">00610</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ad12b9e8fec66fb5a8366561d73cb509a">create_top_output_nodes</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612         <span class="comment">/* with the top module we need to visit the entire ast tree */</span>
<a name="l00613"></a>00613         <span class="keywordtype">int</span> i, j, k;
<a name="l00614"></a>00614         <span class="keywordtype">long</span> sc_spot;
<a name="l00615"></a>00615         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_items = module-&gt;children[2];
<a name="l00616"></a>00616         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_node;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(module_items-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9af290f4f92414377fd83c15a8ddf5e5d1">MODULE_ITEMS</a>);
<a name="l00619"></a>00619 
<a name="l00620"></a>00620         <span class="comment">/* search for VAR_DECLARE_LISTS */</span>
<a name="l00621"></a>00621         <span class="keywordflow">if</span> (module_items-&gt;num_children &gt; 0)
<a name="l00622"></a>00622         {
<a name="l00623"></a>00623                 <span class="keywordflow">for</span> (i = 0; i &lt; module_items-&gt;num_children; i++)
<a name="l00624"></a>00624                 {
<a name="l00625"></a>00625                         <span class="keywordflow">if</span> (module_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aec21f0859c48ef028e3926edb3a8e5e4">VAR_DECLARE_LIST</a>)
<a name="l00626"></a>00626                         {
<a name="l00627"></a>00627                                 <span class="comment">/* go through the vars in this declare list */</span>
<a name="l00628"></a>00628                                 <span class="keywordflow">for</span> (j = 0; j &lt; module_items-&gt;children[i]-&gt;num_children; j++)
<a name="l00629"></a>00629                                 {       
<a name="l00630"></a>00630                                         <span class="keywordflow">if</span> (module_items-&gt;children[i]-&gt;children[j]-&gt;types.variable.is_output)
<a name="l00631"></a>00631                                         {
<a name="l00632"></a>00632                                                 <span class="keywordtype">char</span> *full_name;
<a name="l00633"></a>00633                                                 <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *var_declare = module_items-&gt;children[i]-&gt;children[j];
<a name="l00634"></a>00634                                                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636                                                 <span class="comment">/* decide what type of variable this is */</span>
<a name="l00637"></a>00637                                                 <span class="keywordflow">if</span> (var_declare-&gt;children[1] == NULL)
<a name="l00638"></a>00638                                                 {
<a name="l00639"></a>00639                                                         <span class="comment">/* IF - this is a identifier then find it in the output_nets and hook it up to a newly created node */</span>
<a name="l00640"></a>00640                                                         <span class="comment">/* get the name of the pin */</span>
<a name="l00641"></a>00641                                                         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, -1);
<a name="l00642"></a>00642         
<a name="l00643"></a>00643                                                         <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l00644"></a>00644                                                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, full_name)) == -1)
<a name="l00645"></a>00645                                                         {
<a name="l00646"></a>00646                                                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Output pin (%s) is not hooked up!!!\n&quot;</span>, full_name);
<a name="l00647"></a>00647                                                         }
<a name="l00648"></a>00648         
<a name="l00649"></a>00649                                                         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00650"></a>00650                                                         <span class="comment">/* hookup this pin to this net */</span>
<a name="l00651"></a>00651                                                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], new_pin);
<a name="l00652"></a>00652         
<a name="l00653"></a>00653                                                         <span class="comment">/* create the node */</span>
<a name="l00654"></a>00654                                                         new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00655"></a>00655                                                         new_node-&gt;related_ast_node = module_items-&gt;children[i]-&gt;children[j];
<a name="l00656"></a>00656                                                         new_node-&gt;name = full_name;
<a name="l00657"></a>00657                                                         new_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af8835114e1f40eeb0e75e19b471c1d7f">OUTPUT_NODE</a>;
<a name="l00658"></a>00658                                                         <span class="comment">/* allocate the pins needed */</span>
<a name="l00659"></a>00659                                                         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(new_node, 1);
<a name="l00660"></a>00660                                                         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(new_node, 1);
<a name="l00661"></a>00661         
<a name="l00662"></a>00662                                                         <span class="comment">/* hookup the pin, and node */</span>
<a name="l00663"></a>00663                                                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(new_node, new_pin, 0);
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                                                         <span class="comment">/* record this node */</span>  
<a name="l00666"></a>00666                                                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)realloc(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes+1));
<a name="l00667"></a>00667                                                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes[<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes] = new_node;
<a name="l00668"></a>00668                                                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes++;
<a name="l00669"></a>00669                                                 }       
<a name="l00670"></a>00670                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;children[3] == NULL)
<a name="l00671"></a>00671                                                 {
<a name="l00672"></a>00672                                                         <span class="comment">/* assume digit 1 is largest */</span>
<a name="l00673"></a>00673                                                         <span class="keywordflow">for</span> (k = var_declare-&gt;children[2]-&gt;types.number.value; k &lt;= var_declare-&gt;children[1]-&gt;types.number.value; k++)
<a name="l00674"></a>00674                                                         {
<a name="l00675"></a>00675                                                                 <span class="comment">/* get the name of the pin */</span>
<a name="l00676"></a>00676                                                                 full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, k);
<a name="l00677"></a>00677                 
<a name="l00678"></a>00678                                                                 <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l00679"></a>00679                                                                 <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, full_name)) == -1)
<a name="l00680"></a>00680                                                                 {
<a name="l00681"></a>00681                                                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Output pin (%s) is not hooked up!!!\n&quot;</span>, full_name);
<a name="l00682"></a>00682                                                                 }
<a name="l00683"></a>00683                                                                 new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00684"></a>00684                                                                 <span class="comment">/* hookup this pin to this net */</span>
<a name="l00685"></a>00685                                                                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], new_pin);
<a name="l00686"></a>00686                 
<a name="l00687"></a>00687                                                                 <span class="comment">/* create the node */</span>
<a name="l00688"></a>00688                                                                 new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00689"></a>00689                                                                 new_node-&gt;related_ast_node = module_items-&gt;children[i]-&gt;children[j];
<a name="l00690"></a>00690                                                                 new_node-&gt;name = full_name;
<a name="l00691"></a>00691                                                                 new_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af8835114e1f40eeb0e75e19b471c1d7f">OUTPUT_NODE</a>;
<a name="l00692"></a>00692                                                                 <span class="comment">/* allocate the pins needed */</span>
<a name="l00693"></a>00693                                                                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(new_node, 1);
<a name="l00694"></a>00694                                                                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(new_node, 1);
<a name="l00695"></a>00695                 
<a name="l00696"></a>00696                                                                 <span class="comment">/* hookup the pin, and node */</span>
<a name="l00697"></a>00697                                                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(new_node, new_pin, 0);
<a name="l00698"></a>00698 
<a name="l00699"></a>00699                                                                 <span class="comment">/* record this node */</span>  
<a name="l00700"></a>00700                                                                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)realloc(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes+1));
<a name="l00701"></a>00701                                                                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_output_nodes[<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes] = new_node;
<a name="l00702"></a>00702                                                                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_output_nodes++;
<a name="l00703"></a>00703                                                         }
<a name="l00704"></a>00704                                                 }
<a name="l00705"></a>00705                                                 <span class="keywordflow">else</span>
<a name="l00706"></a>00706                                                 {
<a name="l00707"></a>00707                                                         <span class="comment">/* MEMORY */</span>
<a name="l00708"></a>00708                                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Memory not handled ... yet!\n&quot;</span>);
<a name="l00709"></a>00709                                                 }
<a name="l00710"></a>00710                                         }
<a name="l00711"></a>00711                                 }
<a name="l00712"></a>00712                         }
<a name="l00713"></a>00713                 }
<a name="l00714"></a>00714         }
<a name="l00715"></a>00715         <span class="keywordflow">else</span>
<a name="l00716"></a>00716         {
<a name="l00717"></a>00717                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_items-&gt;line_number, module_items-&gt;file_number, <span class="stringliteral">&quot;Empty module\n&quot;</span>);
<a name="l00718"></a>00718         }
<a name="l00719"></a>00719 }
<a name="l00720"></a>00720 
<a name="l00721"></a>00721 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00722"></a>00722 <span class="comment"> * (function: define_nets_with_driver)</span>
<a name="l00723"></a>00723 <span class="comment"> *      Given a register declaration, this function defines it as a driver.</span>
<a name="l00724"></a>00724 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00725"></a><a class="code" href="netlist__create__from__ast_8c.html#a835a20f5e1e228c0824985ed30a6456a">00725</a> <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* <a class="code" href="netlist__create__from__ast_8c.html#a835a20f5e1e228c0824985ed30a6456a">define_nets_with_driver</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00726"></a>00726 {
<a name="l00727"></a>00727         <span class="keywordtype">int</span> i;
<a name="l00728"></a>00728         <span class="keywordtype">char</span> *temp_string;
<a name="l00729"></a>00729         <span class="keywordtype">long</span> sc_spot;
<a name="l00730"></a>00730         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net = NULL;
<a name="l00731"></a>00731                         
<a name="l00732"></a>00732         <span class="keywordflow">if</span> (var_declare-&gt;children[1] == NULL)
<a name="l00733"></a>00733         {
<a name="l00734"></a>00734                 <span class="comment">/* FOR single driver signal since spots 1, 2, 3, 4 are NULL */</span>
<a name="l00735"></a>00735 
<a name="l00736"></a>00736                 <span class="comment">/* create the net */</span>
<a name="l00737"></a>00737                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00738"></a>00738 
<a name="l00739"></a>00739                 <span class="comment">/* make the string to add to the string cache */</span>
<a name="l00740"></a>00740                 temp_string = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, -1);
<a name="l00741"></a>00741 
<a name="l00742"></a>00742                 <span class="comment">/* look for that element */</span>
<a name="l00743"></a>00743                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, temp_string);
<a name="l00744"></a>00744                 <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00745"></a>00745                 {
<a name="l00746"></a>00746                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Net (%s) with the same name already created\n&quot;</span>, temp_string);
<a name="l00747"></a>00747                 }
<a name="l00748"></a>00748                 <span class="comment">/* store the data which is an idx here */</span>
<a name="l00749"></a>00749                 output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00750"></a>00750                 new_net-&gt;name = temp_string;
<a name="l00751"></a>00751         }       
<a name="l00752"></a>00752         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;children[3] == NULL)
<a name="l00753"></a>00753         {
<a name="l00754"></a>00754                 <span class="comment">/* FOR array driver  since sport 3 and 4 are NULL */</span>
<a name="l00755"></a>00755                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>((var_declare-&gt;children[1]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aae943f711ea7d1a4724ccd3a7f2c21ee">NUMBERS</a>) &amp;&amp; (var_declare-&gt;children[2]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aae943f711ea7d1a4724ccd3a7f2c21ee">NUMBERS</a>)) 
<a name="l00756"></a>00756                 
<a name="l00757"></a>00757                 <span class="comment">/* This register declaration is a range as opposed to a single bit so we need to define each element */</span>
<a name="l00758"></a>00758                 <span class="comment">/* assume digit 1 is largest */</span>
<a name="l00759"></a>00759                 <span class="keywordflow">for</span> (i = var_declare-&gt;children[2]-&gt;types.number.value; i &lt;= var_declare-&gt;children[1]-&gt;types.number.value; i++)
<a name="l00760"></a>00760                 {
<a name="l00761"></a>00761                         <span class="comment">/* create the net */</span>
<a name="l00762"></a>00762                         new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00763"></a>00763 
<a name="l00764"></a>00764                         <span class="comment">/* create the string to add to the cache */</span>
<a name="l00765"></a>00765                         temp_string = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, i);
<a name="l00766"></a>00766 
<a name="l00767"></a>00767                         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, temp_string);
<a name="l00768"></a>00768                         <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00769"></a>00769                         {
<a name="l00770"></a>00770                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Net (%s) with the same name already created\n&quot;</span>, temp_string);
<a name="l00771"></a>00771                         }               
<a name="l00772"></a>00772                         <span class="comment">/* store the data which is an idx here */</span>
<a name="l00773"></a>00773                         output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00774"></a>00774                         new_net-&gt;name = temp_string;
<a name="l00775"></a>00775                 }
<a name="l00776"></a>00776         }
<a name="l00777"></a>00777         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;children[3] != NULL)
<a name="l00778"></a>00778         {
<a name="l00779"></a>00779                 <span class="comment">/* FOR memory */</span>
<a name="l00780"></a>00780                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00781"></a>00781         }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783         <span class="keywordflow">return</span> new_net;
<a name="l00784"></a>00784 }
<a name="l00785"></a>00785 
<a name="l00786"></a>00786 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00787"></a>00787 <span class="comment"> * (function:  define_nodes_and_nets_with_driver)</span>
<a name="l00788"></a>00788 <span class="comment"> *      Similar to define_nets_with_driver except this one is for top level nodes and</span>
<a name="l00789"></a>00789 <span class="comment"> *      is making the input pins into nodes and drivers.</span>
<a name="l00790"></a>00790 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00791"></a><a class="code" href="netlist__create__from__ast_8c.html#a0379491c0f5025dc7823eabaa0766377">00791</a> <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* <a class="code" href="netlist__create__from__ast_8c.html#a0379491c0f5025dc7823eabaa0766377">define_nodes_and_nets_with_driver</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00792"></a>00792 {
<a name="l00793"></a>00793         <span class="keywordtype">int</span> i;
<a name="l00794"></a>00794         <span class="keywordtype">char</span> *temp_string;
<a name="l00795"></a>00795         <span class="keywordtype">long</span> sc_spot;
<a name="l00796"></a>00796         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net = NULL;
<a name="l00797"></a>00797         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l00798"></a>00798         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_node;
<a name="l00799"></a>00799                                 
<a name="l00800"></a>00800         <span class="keywordflow">if</span> (var_declare-&gt;children[1] == NULL)
<a name="l00801"></a>00801         {
<a name="l00802"></a>00802                 <span class="comment">/* FOR single driver signal since spots 1, 2, 3, 4 are NULL */</span>
<a name="l00803"></a>00803 
<a name="l00804"></a>00804                 <span class="comment">/* create the net */</span>
<a name="l00805"></a>00805                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00806"></a>00806 
<a name="l00807"></a>00807                 temp_string = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, -1);
<a name="l00808"></a>00808 
<a name="l00809"></a>00809                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, temp_string);
<a name="l00810"></a>00810                 <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00811"></a>00811                 {
<a name="l00812"></a>00812                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Net (%s) with the same name already created\n&quot;</span>, temp_string);
<a name="l00813"></a>00813                 }
<a name="l00814"></a>00814                 <span class="comment">/* store the data which is an idx here */</span>
<a name="l00815"></a>00815                 output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00816"></a>00816                 new_net-&gt;name = temp_string;
<a name="l00817"></a>00817 
<a name="l00818"></a>00818                 <span class="comment">/* create this node and make the pin connection to the net */</span>
<a name="l00819"></a>00819                 new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00820"></a>00820                 new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00821"></a>00821                 new_node-&gt;name = temp_string;
<a name="l00822"></a>00822 
<a name="l00823"></a>00823                 new_node-&gt;related_ast_node = var_declare;
<a name="l00824"></a>00824                 new_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a005ec11762aff9a9f61a1cf0e0c9bd88">INPUT_NODE</a>;
<a name="l00825"></a>00825                 <span class="comment">/* allocate the pins needed */</span>
<a name="l00826"></a>00826                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(new_node, 1);
<a name="l00827"></a>00827                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(new_node, 1);
<a name="l00828"></a>00828 
<a name="l00829"></a>00829                 <span class="comment">/* hookup the pin, net, and node */</span>
<a name="l00830"></a>00830                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(new_node, new_pin, 0);
<a name="l00831"></a>00831                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, new_pin);
<a name="l00832"></a>00832 
<a name="l00833"></a>00833                 <span class="comment">/* store it in the list of input nodes */</span>
<a name="l00834"></a>00834                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)realloc(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes+1));
<a name="l00835"></a>00835                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes[<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes] = new_node;
<a name="l00836"></a>00836                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes++;
<a name="l00837"></a>00837         }       
<a name="l00838"></a>00838         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;children[3] == NULL)
<a name="l00839"></a>00839         {
<a name="l00840"></a>00840                 <span class="comment">/* FOR array driver  since sport 3 and 4 are NULL */</span>
<a name="l00841"></a>00841                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>((var_declare-&gt;children[1]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aae943f711ea7d1a4724ccd3a7f2c21ee">NUMBERS</a>) &amp;&amp; (var_declare-&gt;children[2]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aae943f711ea7d1a4724ccd3a7f2c21ee">NUMBERS</a>)) 
<a name="l00842"></a>00842                 
<a name="l00843"></a>00843                 <span class="comment">/* assume digit 1 is largest */</span>
<a name="l00844"></a>00844                 <span class="keywordflow">for</span> (i = var_declare-&gt;children[2]-&gt;types.number.value; i &lt;= var_declare-&gt;children[1]-&gt;types.number.value; i++)
<a name="l00845"></a>00845                 {
<a name="l00846"></a>00846                         <span class="comment">/* create the net */</span>
<a name="l00847"></a>00847                         new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00848"></a>00848 
<a name="l00849"></a>00849                         <span class="comment">/* FOR single driver signal */</span>
<a name="l00850"></a>00850                         temp_string = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, i);
<a name="l00851"></a>00851 
<a name="l00852"></a>00852                         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, temp_string);
<a name="l00853"></a>00853                         <span class="keywordflow">if</span> (output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00854"></a>00854                         {
<a name="l00855"></a>00855                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;children[0]-&gt;line_number, var_declare-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;Net (%s) with the same name already created\n&quot;</span>, temp_string);
<a name="l00856"></a>00856                         }               
<a name="l00857"></a>00857                         <span class="comment">/* store the data which is an idx here */</span>
<a name="l00858"></a>00858                         output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00859"></a>00859                         new_net-&gt;name = temp_string;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861                         <span class="comment">/* create this node and make the pin connection to the net */</span>
<a name="l00862"></a>00862                         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00863"></a>00863                         new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00864"></a>00864         
<a name="l00865"></a>00865                         new_node-&gt;related_ast_node = var_declare;
<a name="l00866"></a>00866                         new_node-&gt;name = temp_string;
<a name="l00867"></a>00867                         new_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a005ec11762aff9a9f61a1cf0e0c9bd88">INPUT_NODE</a>;
<a name="l00868"></a>00868                         <span class="comment">/* allocate the pins needed */</span>
<a name="l00869"></a>00869                         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(new_node, 1);
<a name="l00870"></a>00870                         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(new_node, 1);
<a name="l00871"></a>00871         
<a name="l00872"></a>00872                         <span class="comment">/* hookup the pin, net, and node */</span>
<a name="l00873"></a>00873                         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(new_node, new_pin, 0);
<a name="l00874"></a>00874                         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, new_pin);
<a name="l00875"></a>00875         
<a name="l00876"></a>00876                         <span class="comment">/* store it in the list of input nodes */</span>
<a name="l00877"></a>00877                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)realloc(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes+1));
<a name="l00878"></a>00878                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;top_input_nodes[<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes] = new_node;
<a name="l00879"></a>00879                         <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_top_input_nodes++;
<a name="l00880"></a>00880                 }
<a name="l00881"></a>00881         }
<a name="l00882"></a>00882         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;children[3] != NULL)
<a name="l00883"></a>00883         {
<a name="l00884"></a>00884                 <span class="comment">/* FOR memory */</span>
<a name="l00885"></a>00885                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887 
<a name="l00888"></a>00888         <span class="keywordflow">return</span> new_net;
<a name="l00889"></a>00889 }
<a name="l00890"></a>00890 
<a name="l00891"></a>00891 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00892"></a>00892 <span class="comment"> * (function: create_symbol_table_for_module)</span>
<a name="l00893"></a>00893 <span class="comment"> *      Creates a lookup of the variables declared here so that in the analysis we can look</span>
<a name="l00894"></a>00894 <span class="comment"> *      up the definition of it to decide what to do.</span>
<a name="l00895"></a>00895 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00896"></a><a class="code" href="netlist__create__from__ast_8c.html#a71a62c66359dca3d73088b74e8dd5679">00896</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a71a62c66359dca3d73088b74e8dd5679">create_symbol_table_for_module</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module_items)
<a name="l00897"></a>00897 {
<a name="l00898"></a>00898         <span class="comment">/* with the top module we need to visit the entire ast tree */</span>
<a name="l00899"></a>00899         <span class="keywordtype">int</span> i, j;
<a name="l00900"></a>00900         <span class="keywordtype">char</span> *temp_string;
<a name="l00901"></a>00901         <span class="keywordtype">long</span> sc_spot;
<a name="l00902"></a>00902         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(module_items-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9af290f4f92414377fd83c15a8ddf5e5d1">MODULE_ITEMS</a>);
<a name="l00903"></a>00903 
<a name="l00904"></a>00904         <span class="comment">/* search for VAR_DECLARE_LISTS */</span>
<a name="l00905"></a>00905         <span class="keywordflow">if</span> (module_items-&gt;num_children &gt; 0)
<a name="l00906"></a>00906         {
<a name="l00907"></a>00907                 <span class="keywordflow">for</span> (i = 0; i &lt; module_items-&gt;num_children; i++)
<a name="l00908"></a>00908                 {
<a name="l00909"></a>00909                         <span class="keywordflow">if</span> (module_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9aec21f0859c48ef028e3926edb3a8e5e4">VAR_DECLARE_LIST</a>)
<a name="l00910"></a>00910                         {
<a name="l00911"></a>00911                                 <span class="comment">/* go through the vars in this declare list */</span>
<a name="l00912"></a>00912                                 <span class="keywordflow">for</span> (j = 0; j &lt; module_items-&gt;children[i]-&gt;num_children; j++)
<a name="l00913"></a>00913                                 {       
<a name="l00914"></a>00914                                         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *var_declare = module_items-&gt;children[i]-&gt;children[j];
<a name="l00915"></a>00915 
<a name="l00916"></a>00916                                         <span class="comment">/* parameters are already dealt with */</span>
<a name="l00917"></a>00917                                         <span class="keywordflow">if</span> (var_declare-&gt;types.variable.is_parameter)
<a name="l00918"></a>00918                                                 <span class="keywordflow">continue</span>;
<a name="l00919"></a>00919 
<a name="l00920"></a>00920                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(module_items-&gt;children[i]-&gt;children[j]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ae6f306bdb4bd439fd9e46256abbd9892">VAR_DECLARE</a>);
<a name="l00921"></a>00921                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(        (var_declare-&gt;types.variable.is_input) ||
<a name="l00922"></a>00922                                                 (var_declare-&gt;types.variable.is_output) ||
<a name="l00923"></a>00923                                                 (var_declare-&gt;types.variable.is_reg) ||
<a name="l00924"></a>00924                                                 (var_declare-&gt;types.variable.is_wire));
<a name="l00925"></a>00925 
<a name="l00926"></a>00926                                         <span class="comment">/* make the string to add to the string cache */</span>
<a name="l00927"></a>00927                                         temp_string = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(NULL, NULL, NULL, var_declare-&gt;children[0]-&gt;types.identifier, -1);
<a name="l00928"></a>00928                                         <span class="comment">/* look for that element */</span>
<a name="l00929"></a>00929                                         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(local_symbol_table_sc, temp_string);
<a name="l00930"></a>00930                                         <span class="keywordflow">if</span> (local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] != NULL)
<a name="l00931"></a>00931                                         {
<a name="l00932"></a>00932                                                 <span class="comment">/* ERROR checks here </span>
<a name="l00933"></a>00933 <span class="comment">                                                 * output with reg is fine</span>
<a name="l00934"></a>00934 <span class="comment">                                                 * output with wire is fine </span>
<a name="l00935"></a>00935 <span class="comment">                                                 * Then update the stored string chache entry with information */</span>
<a name="l00936"></a>00936                                                 <span class="keywordflow">if</span> ((var_declare-&gt;types.variable.is_input) &amp;&amp; 
<a name="l00937"></a>00937                                                         ((((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.variable.is_reg) || (((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.variable.is_wire)))
<a name="l00938"></a>00938                                                 {
<a name="l00939"></a>00939                                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, var_declare-&gt;line_number, var_declare-&gt;file_number, <span class="stringliteral">&quot;Input defined as wire or reg means it is a driver in this module.  Not possible\n&quot;</span>);
<a name="l00940"></a>00940                                                 }
<a name="l00941"></a>00941                                                 <span class="comment">/* MORE ERRORS ... could check for same declaration name ... */</span>
<a name="l00942"></a>00942                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare-&gt;types.variable.is_output)
<a name="l00943"></a>00943                                                 {
<a name="l00944"></a>00944                                                         <span class="comment">/* copy all the reg and wire info over */</span>
<a name="l00945"></a>00945                                                         ((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.variable.is_output = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l00946"></a>00946                                                 }
<a name="l00947"></a>00947                                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((var_declare-&gt;types.variable.is_reg) || (var_declare-&gt;types.variable.is_wire))
<a name="l00948"></a>00948                                                 {
<a name="l00949"></a>00949                                                         <span class="comment">/* copy the output status over */</span>
<a name="l00950"></a>00950                                                         ((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.variable.is_wire = var_declare-&gt;types.variable.is_wire;
<a name="l00951"></a>00951                                                         ((<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;types.variable.is_reg = var_declare-&gt;types.variable.is_reg;
<a name="l00952"></a>00952                                                 }
<a name="l00953"></a>00953                                         }
<a name="l00954"></a>00954                                         <span class="keywordflow">else</span>
<a name="l00955"></a>00955                                         {
<a name="l00956"></a>00956                                                 <span class="comment">/* store the data which is an idx here */</span>
<a name="l00957"></a>00957                                                 local_symbol_table_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)var_declare;
<a name="l00958"></a>00958 
<a name="l00959"></a>00959                                                 <span class="comment">/* store the symbol */</span>          
<a name="l00960"></a>00960                                                 <a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a> = (<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> **)realloc(<a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)*(<a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a>+1));
<a name="l00961"></a>00961                                                 <a class="code" href="netlist__create__from__ast_8c.html#afee52e503788a22e3b7f69adaff26d68">local_symbol_table</a>[<a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a>] = var_declare;
<a name="l00962"></a>00962                                                 <a class="code" href="netlist__create__from__ast_8c.html#a3f7f623a2b7704d421348ac87f9cb60c">num_local_symbol_table</a> ++;
<a name="l00963"></a>00963                                         }
<a name="l00964"></a>00964                                         free(temp_string);
<a name="l00965"></a>00965                                 }
<a name="l00966"></a>00966                         }
<a name="l00967"></a>00967                 }
<a name="l00968"></a>00968         }
<a name="l00969"></a>00969         <span class="keywordflow">else</span>
<a name="l00970"></a>00970         {
<a name="l00971"></a>00971                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_items-&gt;line_number, module_items-&gt;file_number, <span class="stringliteral">&quot;Empty module\n&quot;</span>);
<a name="l00972"></a>00972         }
<a name="l00973"></a>00973 }
<a name="l00974"></a>00974 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00975"></a>00975 <span class="comment"> * (function: connect_module_instantiation_and_alias)</span>
<a name="l00976"></a>00976 <span class="comment"> *      This function looks at module instantiation points and does one of two things:</span>
<a name="l00977"></a>00977 <span class="comment"> *              On the first pass this function looks at an instantiation (which has already</span>
<a name="l00978"></a>00978 <span class="comment"> *              been processed) and checks if there are drivers in there that need to be seen</span>
<a name="l00979"></a>00979 <span class="comment"> *              as we process the instantiating module.  </span>
<a name="l00980"></a>00980 <span class="comment"> *</span>
<a name="l00981"></a>00981 <span class="comment"> *              On the second pass this function looks at an instantiation and checks if</span>
<a name="l00982"></a>00982 <span class="comment"> *              there are any inputs that don&#39;t have a driver at this level.  If they don&#39;t then</span>
<a name="l00983"></a>00983 <span class="comment"> *              name needs to be aliased for higher levels to understant.  If there exists a </span>
<a name="l00984"></a>00984 <span class="comment"> *              driver, then we connect the two.</span>
<a name="l00985"></a>00985 <span class="comment"> *</span>
<a name="l00986"></a>00986 <span class="comment"> *      Assume that ports are written in the same order as the instantiation.  Also,</span>
<a name="l00987"></a>00987 <span class="comment"> *      we will assume that the portwidths have to match</span>
<a name="l00988"></a>00988 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00989"></a><a class="code" href="netlist__create__from__ast_8c.html#a9d3d12bbf51d0a805323f5c80ee0eb9c">00989</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a9d3d12bbf51d0a805323f5c80ee0eb9c">connect_module_instantiation_and_alias</a>(<span class="keywordtype">short</span> PASS, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* module_instance, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l00990"></a>00990 {
<a name="l00991"></a>00991         <span class="keywordtype">int</span> i, j;
<a name="l00992"></a>00992         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_node;
<a name="l00993"></a>00993         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_list;
<a name="l00994"></a>00994         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_instance_list = module_instance-&gt;children[1]-&gt;children[1]; <span class="comment">// MODULE_INSTANCE-&gt;MODULE_INSTANCE_NAME(child[1])-&gt;MODULE_CONNECT_LIST(child[1])</span>
<a name="l00995"></a>00995         <span class="keywordtype">long</span> sc_spot;
<a name="l00996"></a>00996         <span class="keywordtype">long</span> sc_spot_output;
<a name="l00997"></a>00997         <span class="keywordtype">long</span> sc_spot_input_old;
<a name="l00998"></a>00998         <span class="keywordtype">long</span> sc_spot_input_new;
<a name="l00999"></a>00999 
<a name="l01000"></a>01000         <span class="comment">/* lookup the node of the module associated with this instantiated module */</span>
<a name="l01001"></a>01001         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>, module_instance-&gt;children[0]-&gt;types.identifier)) == -1)
<a name="l01002"></a>01002         {
<a name="l01003"></a>01003                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_instance-&gt;line_number, module_instance-&gt;file_number, <span class="stringliteral">&quot;Can&#39;t find module %s\n&quot;</span>, module_instance-&gt;children[0]-&gt;types.identifier);
<a name="l01004"></a>01004         }
<a name="l01005"></a>01005         module_node = (<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>*)<a class="code" href="globals_8h.html#a986af728281f5fd9c9e26dcdf0118094">module_names_to_idx</a>-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot];
<a name="l01006"></a>01006         module_list = module_node-&gt;children[1]; <span class="comment">// MODULE-&gt;VAR_DECLARE_LIST(child[1])</span>
<a name="l01007"></a>01007 
<a name="l01008"></a>01008         if (module_list-&gt;num_children != module_instance_list-&gt;num_children)
<a name="l01009"></a>01009         {
<a name="l01010"></a>01010                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_instance-&gt;line_number, module_instance-&gt;file_number, <span class="stringliteral">&quot;Module instantiation (%s) and definition don&#39;t match in terms of ports\n&quot;</span>, module_instance-&gt;children[0]-&gt;types.identifier);
<a name="l01011"></a>01011         }
<a name="l01012"></a>01012 
<a name="l01013"></a>01013         <span class="keywordflow">for</span> (i = 0; i &lt; module_list-&gt;num_children; i++)
<a name="l01014"></a>01014         {
<a name="l01015"></a>01015                 <span class="keywordtype">int</span> port_size;
<a name="l01016"></a>01016                 <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_var_node = module_list-&gt;children[i]-&gt;children[0]; <span class="comment">// VAR_DECLARE_LIST(child[i])-&gt;VAR_DECLARE_PORT(child[0])-&gt;VAR_DECLARE_input-or-output(child[0])</span>
<a name="l01017"></a>01017                 <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *module_instance_var_node = module_instance_list-&gt;children[i]-&gt;children[1]; <span class="comment">// MODULE_CONNECT_LIST(child[i])-&gt;MODULE_CONNECT(child[1]) // child[0] is for aliasing</span>
<a name="l01018"></a>01018 
<a name="l01019"></a>01019                 <span class="keywordflow">if</span> ( 
<a name="l01020"></a>01020                         ((PASS == <a class="code" href="netlist__create__from__ast_8c.html#a50172ed88a30368c1671f227be195ecf">INSTANTIATE_DRIVERS</a>) &amp;&amp; (module_list-&gt;children[i]-&gt;children[0]-&gt;types.variable.is_input))  <span class="comment">// skip inputs on pass 1</span>
<a name="l01021"></a>01021                         ||
<a name="l01022"></a>01022                         ((PASS == <a class="code" href="netlist__create__from__ast_8c.html#a05b76f4b136cb24bfc9789e0d7f53814">ALIAS_INPUTS</a>) &amp;&amp; (module_list-&gt;children[i]-&gt;children[0]-&gt;types.variable.is_output)) <span class="comment">// skip outputs on pass 2</span>
<a name="l01023"></a>01023                 )
<a name="l01024"></a>01024                 {
<a name="l01025"></a>01025                         <span class="keywordflow">continue</span>;
<a name="l01026"></a>01026                 }
<a name="l01027"></a>01027 
<a name="l01028"></a>01028                 <span class="comment">/* calculate the port details */</span>
<a name="l01029"></a>01029                 <span class="keywordflow">if</span> (module_var_node-&gt;children[1] == NULL)
<a name="l01030"></a>01030                 {
<a name="l01031"></a>01031                         port_size = 1;
<a name="l01032"></a>01032                 }
<a name="l01033"></a>01033                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (module_var_node-&gt;children[3] == NULL)
<a name="l01034"></a>01034                 {
<a name="l01035"></a>01035                         <span class="comment">/* assume all arrays declared [largest:smallest] */</span>
<a name="l01036"></a>01036                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(module_var_node-&gt;children[2]-&gt;types.number.value &lt;= module_var_node-&gt;children[1]-&gt;types.number.value); 
<a name="l01037"></a>01037                         port_size = module_var_node-&gt;children[1]-&gt;types.number.value - module_var_node-&gt;children[2]-&gt;types.number.value +1;
<a name="l01038"></a>01038                 }
<a name="l01039"></a>01039                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (module_var_node-&gt;children[3] != NULL)
<a name="l01040"></a>01040                 {
<a name="l01041"></a>01041                         <span class="comment">/* MEMORY output */</span>
<a name="l01042"></a>01042                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01043"></a>01043                 }
<a name="l01044"></a>01044                 
<a name="l01045"></a>01045                 <span class="keywordflow">for</span> (j = 0; j &lt; port_size; j++)
<a name="l01046"></a>01046                 {
<a name="l01047"></a>01047                         <span class="keywordflow">if</span> (module_list-&gt;children[i]-&gt;children[0]-&gt;types.variable.is_input)
<a name="l01048"></a>01048                         {
<a name="l01049"></a>01049                                 <span class="comment">/* IF - this spot in the module list is an input, then we need to find it in the string cache (as its old name), check if the new_name (the instantiation name)</span>
<a name="l01050"></a>01050 <span class="comment">                                 * is already a driver at this level.  IF it is a driver then we can hook the two up.  IF it&#39;s not we need to alias the pin name as it is used here since it</span>
<a name="l01051"></a>01051 <span class="comment">                                 * must be driven at a higher level of hierarchy in the tree of modules */</span>
<a name="l01052"></a>01052                                 <span class="keywordtype">char</span> *name_of_module_instance_of_input;
<a name="l01053"></a>01053                                 <span class="keywordtype">char</span> *full_name;
<a name="l01054"></a>01054                                 <span class="keywordtype">char</span> *alias_name;
<a name="l01055"></a>01055                                 
<a name="l01056"></a>01056                                 <span class="keywordflow">if</span> (port_size &gt; 1)
<a name="l01057"></a>01057                                 {               
<a name="l01058"></a>01058                                         <span class="comment">/* Get the name of the module instantiation pin */</span>
<a name="l01059"></a>01059                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#aa64cb12fe51ed12c69859bdf72fec476">get_name_of_pin_at_bit</a>(module_instance_var_node, j);
<a name="l01060"></a>01060                                         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, name_of_module_instance_of_input, -1); 
<a name="l01061"></a>01061                                         free(name_of_module_instance_of_input);
<a name="l01062"></a>01062 
<a name="l01063"></a>01063                                         <span class="comment">/* make the new string for the alias name - has to be a identifier in the instantiated modules old names */</span>
<a name="l01064"></a>01064                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#ae388ddbc62d6d74b303c142e59dca424">get_name_of_var_declare_at_bit</a>(module_list-&gt;children[i]-&gt;children[0], j);
<a name="l01065"></a>01065                                         alias_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, module_instance-&gt;children[0]-&gt;types.identifier, module_instance-&gt;children[1]-&gt;children[0]-&gt;types.identifier, name_of_module_instance_of_input, -1);
<a name="l01066"></a>01066                                         free(name_of_module_instance_of_input);
<a name="l01067"></a>01067                                 }
<a name="l01068"></a>01068                                 <span class="keywordflow">else</span>
<a name="l01069"></a>01069                                 {
<a name="l01070"></a>01070                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(j == 0);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072                                         <span class="comment">/* Get the name of the module instantiation pin */</span>
<a name="l01073"></a>01073                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#aa64cb12fe51ed12c69859bdf72fec476">get_name_of_pin_at_bit</a>(module_instance_var_node, -1);
<a name="l01074"></a>01074                                         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, name_of_module_instance_of_input, -1); 
<a name="l01075"></a>01075                                         free(name_of_module_instance_of_input);
<a name="l01076"></a>01076 
<a name="l01077"></a>01077                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#ae388ddbc62d6d74b303c142e59dca424">get_name_of_var_declare_at_bit</a>(module_list-&gt;children[i]-&gt;children[0], 0);
<a name="l01078"></a>01078                                         alias_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, module_instance-&gt;children[0]-&gt;types.identifier, module_instance-&gt;children[1]-&gt;children[0]-&gt;types.identifier, name_of_module_instance_of_input, -1);
<a name="l01079"></a>01079                                         free(name_of_module_instance_of_input);
<a name="l01080"></a>01080                                 }
<a name="l01081"></a>01081 
<a name="l01082"></a>01082                                 <span class="comment">/* search for the old_input name */</span>
<a name="l01083"></a>01083                                 <span class="keywordflow">if</span> ((sc_spot_input_old = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(input_nets_sc, alias_name)) == -1)
<a name="l01084"></a>01084                                 {       
<a name="l01085"></a>01085                                         <span class="comment">/* doesn it have to exist since might only be used in module */</span>
<a name="l01086"></a>01086                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_instance-&gt;line_number, module_instance-&gt;file_number, <span class="stringliteral">&quot;This module port %s is unused in module %s&quot;</span>, alias_name, module_node-&gt;children[0]-&gt;types.identifier);
<a name="l01087"></a>01087                                 }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089                                 <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l01090"></a>01090                                 <span class="keywordflow">if</span> ((sc_spot_output = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, full_name)) == -1)
<a name="l01091"></a>01091                                 {
<a name="l01092"></a>01092                                         <span class="comment">/* IF - no driver, then assume that it needs to be aliased to move up as an input */</span>
<a name="l01093"></a>01093                                         <span class="keywordflow">if</span> ((sc_spot_input_new = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(input_nets_sc, full_name)) == -1)
<a name="l01094"></a>01094                                         {
<a name="l01095"></a>01095                                                 <span class="comment">/* if this input is not yet used in this module then we&#39;ll add it */</span>
<a name="l01096"></a>01096                                                 sc_spot_input_new = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(input_nets_sc, full_name);
<a name="l01097"></a>01097                                                 
<a name="l01098"></a>01098                                                 <span class="comment">/* copy the pin to the old spot */</span>
<a name="l01099"></a>01099                                                 input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_new] = input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_old];
<a name="l01100"></a>01100                                         }
<a name="l01101"></a>01101                                         <span class="keywordflow">else</span>
<a name="l01102"></a>01102                                         {
<a name="l01103"></a>01103                                                 <span class="comment">/* already exists so we&#39;ll join the nets */</span>
<a name="l01104"></a>01104                                                 <a class="code" href="netlist__utils_8c.html#ac4293def0f5b4a3aee063ad0b4fe03f1">combine_nets</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_old], (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_new], <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01105"></a>01105                                         }
<a name="l01106"></a>01106                                 }
<a name="l01107"></a>01107                                 <span class="keywordflow">else</span>
<a name="l01108"></a>01108                                 {
<a name="l01109"></a>01109                                         <span class="comment">/* ELSE - we&#39;ve found a matching net, so add this pin to the net */</span>
<a name="l01110"></a>01110                                         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_output];
<a name="l01111"></a>01111                                         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* in_net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_old];
<a name="l01112"></a>01112 
<a name="l01113"></a>01113                                         <span class="keywordflow">if</span> ((net != in_net) &amp;&amp; (net-&gt;combined == <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l01114"></a>01114                                         {
<a name="l01115"></a>01115                                                 <span class="comment">/* if they haven&#39;t been combined already, then join the inputs and output */</span>
<a name="l01116"></a>01116                                                 <a class="code" href="netlist__utils_8c.html#a6fadaf59978b9b97fd0505752c50ced0">join_nets</a>(net, in_net);
<a name="l01117"></a>01117                                                 <span class="comment">/* since the driver net is deleted, copy the spot of the in_net over */</span>
<a name="l01118"></a>01118                                                 input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_old] = (<span class="keywordtype">void</span>*)net;
<a name="l01119"></a>01119                                         }
<a name="l01120"></a>01120                                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((net != in_net) &amp;&amp; (net-&gt;combined == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l01121"></a>01121                                         {
<a name="l01122"></a>01122                                                 <span class="comment">/* if they haven&#39;t been combined already, then join the inputs and output */</span>
<a name="l01123"></a>01123                                                 <a class="code" href="netlist__utils_8c.html#ac4293def0f5b4a3aee063ad0b4fe03f1">combine_nets</a>(net, in_net, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01124"></a>01124                                                 <span class="comment">/* since the driver net is deleted, copy the spot of the in_net over */</span>
<a name="l01125"></a>01125                                                 output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_output] = (<span class="keywordtype">void</span>*)in_net;
<a name="l01126"></a>01126                                         }
<a name="l01127"></a>01127                                 }
<a name="l01128"></a>01128 
<a name="l01129"></a>01129                                 <span class="comment">/* IF the designer users port names then make sure they line up */</span>
<a name="l01130"></a>01130                                 <span class="keywordflow">if</span> (module_instance_list-&gt;children[i]-&gt;children[0] != NULL)
<a name="l01131"></a>01131                                 {
<a name="l01132"></a>01132                                         <span class="keywordflow">if</span> (strcmp(module_instance_list-&gt;children[i]-&gt;children[0]-&gt;types.identifier, module_list-&gt;children[i]-&gt;children[0]-&gt;children[0]-&gt;types.identifier) != 0)
<a name="l01133"></a>01133                                         {
<a name="l01134"></a>01134                                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_list-&gt;children[i]-&gt;children[0]-&gt;line_number, module_list-&gt;children[i]-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;This module entry does not match up correctly (%s != %s).  Odin expects the order of ports to be the same\n&quot;</span>, module_instance_list-&gt;children[i]-&gt;children[0]-&gt;types.identifier,  module_list-&gt;children[i]-&gt;children[0]-&gt;children[0]-&gt;types.identifier);
<a name="l01135"></a>01135                                         }
<a name="l01136"></a>01136                                 }
<a name="l01137"></a>01137 
<a name="l01138"></a>01138                                 free(full_name);
<a name="l01139"></a>01139                                 free(alias_name);
<a name="l01140"></a>01140                         }
<a name="l01141"></a>01141                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (module_list-&gt;children[i]-&gt;children[0]-&gt;types.variable.is_output)
<a name="l01142"></a>01142                         {
<a name="l01143"></a>01143                                 <span class="comment">/* ELSE IF - this is an output pin from the module.  We need to alias this output pin with it&#39;s calling name here so that everyone can see it at this level */</span>
<a name="l01144"></a>01144                                 <span class="keywordtype">char</span> *name_of_module_instance_of_input;
<a name="l01145"></a>01145                                 <span class="keywordtype">char</span> *full_name;
<a name="l01146"></a>01146                                 <span class="keywordtype">char</span> *alias_name;
<a name="l01147"></a>01147                                 
<a name="l01148"></a>01148                                 <span class="comment">/* make the new string for the alias name - has to be a identifier in the instantiated modules old names */</span>
<a name="l01149"></a>01149                                 <span class="keywordflow">if</span> (port_size &gt; 1)
<a name="l01150"></a>01150                                 {               
<a name="l01151"></a>01151                                         <span class="comment">/* Get the name of the module instantiation pin */</span>
<a name="l01152"></a>01152                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#aa64cb12fe51ed12c69859bdf72fec476">get_name_of_pin_at_bit</a>(module_instance_var_node, j);
<a name="l01153"></a>01153                                         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, name_of_module_instance_of_input, -1); 
<a name="l01154"></a>01154                                         free(name_of_module_instance_of_input);
<a name="l01155"></a>01155 
<a name="l01156"></a>01156                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#ae388ddbc62d6d74b303c142e59dca424">get_name_of_var_declare_at_bit</a>(module_list-&gt;children[i]-&gt;children[0], j);
<a name="l01157"></a>01157                                         alias_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, module_instance-&gt;children[0]-&gt;types.identifier, module_instance-&gt;children[1]-&gt;children[0]-&gt;types.identifier, name_of_module_instance_of_input, -1);
<a name="l01158"></a>01158                                         free(name_of_module_instance_of_input);
<a name="l01159"></a>01159                                 }
<a name="l01160"></a>01160                                 <span class="keywordflow">else</span>
<a name="l01161"></a>01161                                 {
<a name="l01162"></a>01162                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(j == 0);
<a name="l01163"></a>01163                                         <span class="comment">/* Get the name of the module instantiation pin */</span>
<a name="l01164"></a>01164                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#aa64cb12fe51ed12c69859bdf72fec476">get_name_of_pin_at_bit</a>(module_instance_var_node, -1);
<a name="l01165"></a>01165                                         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, name_of_module_instance_of_input, -1); 
<a name="l01166"></a>01166                                         free(name_of_module_instance_of_input);
<a name="l01167"></a>01167 
<a name="l01168"></a>01168                                         name_of_module_instance_of_input = <a class="code" href="ast__util_8c.html#ae388ddbc62d6d74b303c142e59dca424">get_name_of_var_declare_at_bit</a>(module_list-&gt;children[i]-&gt;children[0], 0);
<a name="l01169"></a>01169                                         alias_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, module_instance-&gt;children[0]-&gt;types.identifier, module_instance-&gt;children[1]-&gt;children[0]-&gt;types.identifier, name_of_module_instance_of_input, -1);
<a name="l01170"></a>01170                                         free(name_of_module_instance_of_input);
<a name="l01171"></a>01171                                 }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173                                 <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l01174"></a>01174                                 <span class="keywordflow">if</span> ((sc_spot_output = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, alias_name)) == -1)
<a name="l01175"></a>01175                                 {
<a name="l01176"></a>01176                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_list-&gt;children[i]-&gt;children[0]-&gt;line_number, module_list-&gt;children[i]-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;This output (%s) must exist...must be an error\n&quot;</span>, alias_name);
<a name="l01177"></a>01177                                 }
<a name="l01178"></a>01178                                 
<a name="l01179"></a>01179                                 <span class="comment">/* can already be there */</span>
<a name="l01180"></a>01180                                 sc_spot_input_new = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(output_nets_sc, full_name);
<a name="l01181"></a>01181 
<a name="l01182"></a>01182                                 <span class="comment">/* add this alias for the net */</span>
<a name="l01183"></a>01183                                 output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_input_new] = output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_output];
<a name="l01184"></a>01184 
<a name="l01185"></a>01185                                 <span class="comment">/* IF the designer users port names then make sure they line up */</span>
<a name="l01186"></a>01186                                 <span class="keywordflow">if</span> (module_instance_list-&gt;children[i]-&gt;children[0] != NULL)
<a name="l01187"></a>01187                                 {
<a name="l01188"></a>01188                                         <span class="keywordflow">if</span> (strcmp(module_instance_list-&gt;children[i]-&gt;children[0]-&gt;types.identifier, module_list-&gt;children[i]-&gt;children[0]-&gt;children[0]-&gt;types.identifier) != 0)
<a name="l01189"></a>01189                                         {
<a name="l01190"></a>01190                                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, module_list-&gt;children[i]-&gt;children[0]-&gt;line_number, module_list-&gt;children[i]-&gt;children[0]-&gt;file_number, <span class="stringliteral">&quot;This module entry does not match up correctly (%s != %s).  Odin expects the order of ports to be the same\n&quot;</span>, module_instance_list-&gt;children[i]-&gt;children[0]-&gt;types.identifier,  module_list-&gt;children[i]-&gt;children[0]-&gt;children[0]-&gt;types.identifier);
<a name="l01191"></a>01191                                         }
<a name="l01192"></a>01192                                 }
<a name="l01193"></a>01193 
<a name="l01194"></a>01194                                 free(full_name);
<a name="l01195"></a>01195                                 free(alias_name);
<a name="l01196"></a>01196                         }
<a name="l01197"></a>01197                 }       
<a name="l01198"></a>01198         }
<a name="l01199"></a>01199 }
<a name="l01200"></a>01200 
<a name="l01201"></a>01201 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01202"></a>01202 <span class="comment"> * (function: create_pins)</span>
<a name="l01203"></a>01203 <span class="comment"> *      Create pin creates the pins representing this naming isntance, adds them to the input</span>
<a name="l01204"></a>01204 <span class="comment"> *      nets list (if not already there), checks if a driver already exists (and hooks input</span>
<a name="l01205"></a>01205 <span class="comment"> *      to output if needed), and adds the pin to the list.</span>
<a name="l01206"></a>01206 <span class="comment"> *      Note: only for input paths...</span>
<a name="l01207"></a>01207 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01208"></a><a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">01208</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">create_pins</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *name, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01209"></a>01209 {
<a name="l01210"></a>01210         <span class="keywordtype">int</span> i;
<a name="l01211"></a>01211         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_sig_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l01212"></a>01212         <span class="keywordtype">long</span> sc_spot;
<a name="l01213"></a>01213         <span class="keywordtype">long</span> sc_spot_output;
<a name="l01214"></a>01214         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l01215"></a>01215         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_in_net;
<a name="l01216"></a>01216         <a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a> *pin_lists;
<a name="l01217"></a>01217 
<a name="l01218"></a>01218         <span class="keywordflow">if</span> (name == NULL)
<a name="l01219"></a>01219         {
<a name="l01220"></a>01220                 <span class="comment">/* get all the pins */</span>
<a name="l01221"></a>01221                 pin_lists = <a class="code" href="ast__util_8c.html#a82a27c5919282bf0369e96b973bc20e7">get_name_of_pins_with_prefix</a>(var_declare, instance_name_prefix);
<a name="l01222"></a>01222         }
<a name="l01223"></a>01223         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (var_declare == NULL)
<a name="l01224"></a>01224         {
<a name="l01225"></a>01225                 <span class="comment">/* if you have the name and just want a pin then use this method */</span>
<a name="l01226"></a>01226                 pin_lists = (<a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a>*)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a>)*1);
<a name="l01227"></a>01227                 pin_lists-&gt;strings = (<span class="keywordtype">char</span>**)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>*));
<a name="l01228"></a>01228                 pin_lists-&gt;strings[0] = name;
<a name="l01229"></a>01229                 pin_lists-&gt;num_strings = 1;
<a name="l01230"></a>01230         }
<a name="l01231"></a>01231         <span class="keywordflow">else</span>
<a name="l01232"></a>01232                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l01233"></a>01233 
<a name="l01234"></a>01234         <span class="keywordflow">for</span> (i = 0; i &lt; pin_lists-&gt;num_strings; i++)
<a name="l01235"></a>01235         {
<a name="l01236"></a>01236                 new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01237"></a>01237                 new_pin-&gt;name = pin_lists-&gt;strings[i];
<a name="l01238"></a>01238 
<a name="l01239"></a>01239                 <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l01240"></a>01240                 <span class="keywordflow">if</span> (strstr(pin_lists-&gt;strings[i], <span class="stringliteral">&quot;ONE_VCC_CNS&quot;</span>) != NULL)
<a name="l01241"></a>01241                 {
<a name="l01242"></a>01242                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net, new_pin);
<a name="l01243"></a>01243                         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(input_nets_sc, pin_lists-&gt;strings[i]);
<a name="l01244"></a>01244                         input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;one_net;
<a name="l01245"></a>01245                 }
<a name="l01246"></a>01246                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strstr(pin_lists-&gt;strings[i], <span class="stringliteral">&quot;ZERO_GND_ZERO&quot;</span>) != NULL)
<a name="l01247"></a>01247                 {
<a name="l01248"></a>01248                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net, new_pin);
<a name="l01249"></a>01249                         sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(input_nets_sc, pin_lists-&gt;strings[i]);
<a name="l01250"></a>01250                         input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;zero_net;
<a name="l01251"></a>01251                 }
<a name="l01252"></a>01252                 <span class="keywordflow">else</span>
<a name="l01253"></a>01253                 {
<a name="l01254"></a>01254                         <span class="comment">/* search for the input name  if already exists...needs to be added to string cache in case it&#39;s an input pin */</span>
<a name="l01255"></a>01255                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(input_nets_sc, pin_lists-&gt;strings[i])) == -1)
<a name="l01256"></a>01256                         {       
<a name="l01257"></a>01257                                 new_in_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l01258"></a>01258         
<a name="l01259"></a>01259                                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(input_nets_sc, pin_lists-&gt;strings[i]);
<a name="l01260"></a>01260                                 input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)new_in_net;
<a name="l01261"></a>01261                         }
<a name="l01262"></a>01262         
<a name="l01263"></a>01263                         <span class="comment">/* store the pin in this net */</span>
<a name="l01264"></a>01264                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], new_pin);
<a name="l01265"></a>01265         
<a name="l01266"></a>01266                         <span class="keywordflow">if</span> ((sc_spot_output = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, pin_lists-&gt;strings[i])) != -1)
<a name="l01267"></a>01267                         {
<a name="l01268"></a>01268                                 <span class="comment">/* ELSE - we&#39;ve found a matching net, so add this pin to the net */</span>
<a name="l01269"></a>01269                                 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>* net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_output];
<a name="l01270"></a>01270                                 if ((net != (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot]) &amp;&amp; (net-&gt;combined == <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l01271"></a>01271                                 {
<a name="l01272"></a>01272                                         <span class="comment">/* IF - the input and output nets don&#39;t match, then they need to be joined */</span>
<a name="l01273"></a>01273                                         <a class="code" href="netlist__utils_8c.html#a6fadaf59978b9b97fd0505752c50ced0">join_nets</a>(net, (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot]);
<a name="l01274"></a>01274                                         <span class="comment">/* since the driver net is deleted, copy the spot of the in_net over */</span>
<a name="l01275"></a>01275                                         input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot] = (<span class="keywordtype">void</span>*)net;
<a name="l01276"></a>01276                                 }
<a name="l01277"></a>01277                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((net != (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot]) &amp;&amp; (net-&gt;combined == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>))
<a name="l01278"></a>01278                                 {
<a name="l01279"></a>01279                                         <span class="comment">/* IF - the input and output nets don&#39;t match, then they need to be joined */</span>
<a name="l01280"></a>01280                                         <a class="code" href="netlist__utils_8c.html#ac4293def0f5b4a3aee063ad0b4fe03f1">combine_nets</a>(net, (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01281"></a>01281                                         <span class="comment">/* since the driver net is deleted, copy the spot of the in_net over */</span>
<a name="l01282"></a>01282                                         output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot_output] = (<span class="keywordtype">void</span>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot];
<a name="l01283"></a>01283                                 }
<a name="l01284"></a>01284                         }
<a name="l01285"></a>01285                 }
<a name="l01286"></a>01286 
<a name="l01287"></a>01287                 <span class="comment">/* add the pin now stored in the string chache to the returned signal list */</span>           
<a name="l01288"></a>01288                 <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_sig_list, new_pin);
<a name="l01289"></a>01289         }
<a name="l01290"></a>01290         
<a name="l01291"></a>01291         <span class="keywordflow">return</span> return_sig_list; 
<a name="l01292"></a>01292 }
<a name="l01293"></a>01293 
<a name="l01294"></a>01294 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01295"></a>01295 <span class="comment"> * (function: create_output_pin)</span>
<a name="l01296"></a>01296 <span class="comment"> *      Create OUTPUT pin creates a pin representing this naming isntance, adds it to the input</span>
<a name="l01297"></a>01297 <span class="comment"> *      nets list (if not already there) and adds the pin to the list.</span>
<a name="l01298"></a>01298 <span class="comment"> *      Note: only for output drivers...</span>
<a name="l01299"></a>01299 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01300"></a><a class="code" href="netlist__create__from__ast_8c.html#ac096b2a9a70f0e15d3da9b9cb7731f73">01300</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ac096b2a9a70f0e15d3da9b9cb7731f73">create_output_pin</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* var_declare, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01301"></a>01301 {
<a name="l01302"></a>01302         <span class="keywordtype">char</span> *name_of_pin;
<a name="l01303"></a>01303         <span class="keywordtype">char</span> *full_name;
<a name="l01304"></a>01304         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_sig_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l01305"></a>01305         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l01306"></a>01306         
<a name="l01307"></a>01307         <span class="comment">/* get the name of the pin */</span>
<a name="l01308"></a>01308         name_of_pin = <a class="code" href="ast__util_8c.html#aa64cb12fe51ed12c69859bdf72fec476">get_name_of_pin_at_bit</a>(var_declare, -1);
<a name="l01309"></a>01309         full_name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(instance_name_prefix, NULL, NULL, name_of_pin, -1); 
<a name="l01310"></a>01310         free(name_of_pin);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01313"></a>01313         new_pin-&gt;name = full_name;
<a name="l01314"></a>01314 
<a name="l01315"></a>01315         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_sig_list, new_pin);
<a name="l01316"></a>01316 
<a name="l01317"></a>01317         <span class="keywordflow">return</span> return_sig_list; 
<a name="l01318"></a>01318 }
<a name="l01319"></a>01319 
<a name="l01320"></a>01320 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01321"></a>01321 <span class="comment"> * (function: assignment_alias)</span>
<a name="l01322"></a>01322 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01323"></a><a class="code" href="netlist__create__from__ast_8c.html#ac647d0a7bbf8fd799f72b12eb23d925b">01323</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ac647d0a7bbf8fd799f72b12eb23d925b">assignment_alias</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* assignment, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01324"></a>01324 {
<a name="l01325"></a>01325         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *in_1;
<a name="l01326"></a>01326         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l01327"></a>01327         <a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a> *out_list;
<a name="l01328"></a>01328         <span class="keywordtype">int</span> i;
<a name="l01329"></a>01329         <span class="keywordtype">int</span> output_size;
<a name="l01330"></a>01330 
<a name="l01331"></a>01331         <span class="comment">/* process the signal for the input gate */</span>
<a name="l01332"></a>01332         in_1 = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(assignment-&gt;children[1], instance_name_prefix);
<a name="l01333"></a>01333         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(in_1 != NULL);
<a name="l01334"></a>01334         out_list = <a class="code" href="ast__util_8c.html#a82a27c5919282bf0369e96b973bc20e7">get_name_of_pins_with_prefix</a>(assignment-&gt;children[0], instance_name_prefix); 
<a name="l01335"></a>01335         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(out_list != NULL);
<a name="l01336"></a>01336         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(out_list-&gt;strings != NULL);
<a name="l01337"></a>01337 
<a name="l01338"></a>01338         <span class="comment">/* aliases the input pin names to the output names */</span>
<a name="l01339"></a>01339         output_size = <a class="code" href="netlist__create__from__ast_8c.html#aa39b79ba64a52bb51bb65281d10d6e56">alias_output_assign_pins_to_inputs</a>(out_list, in_1, assignment);
<a name="l01340"></a>01340 
<a name="l01341"></a>01341         <span class="keywordflow">if</span> (output_size &lt; in_1-&gt;signal_list_size)
<a name="l01342"></a>01342         {
<a name="l01343"></a>01343                 return_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l01344"></a>01344                 <span class="comment">/* need to shrink the output list */</span>
<a name="l01345"></a>01345                 <span class="keywordflow">for</span> (i = 0; i &lt; output_size; i++)
<a name="l01346"></a>01346                 {
<a name="l01347"></a>01347                         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_list, in_1-&gt;signal_list[i]);
<a name="l01348"></a>01348                 }
<a name="l01349"></a>01349                 
<a name="l01350"></a>01350                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(in_1);
<a name="l01351"></a>01351         }
<a name="l01352"></a>01352         <span class="keywordflow">else</span>
<a name="l01353"></a>01353         {
<a name="l01354"></a>01354                 return_list = in_1;
<a name="l01355"></a>01355         }
<a name="l01356"></a>01356 
<a name="l01357"></a>01357         <span class="comment">/* clean the name string list since we don&#39;t need it anymore */</span>
<a name="l01358"></a>01358         free(out_list-&gt;strings);
<a name="l01359"></a>01359         free(out_list);
<a name="l01360"></a>01360         
<a name="l01361"></a>01361         <span class="keywordflow">return</span> return_list;
<a name="l01362"></a>01362 }
<a name="l01363"></a>01363 
<a name="l01364"></a>01364 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01365"></a>01365 <span class="comment"> * (function: terminate_registered_assignment)</span>
<a name="l01366"></a>01366 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01367"></a><a class="code" href="netlist__create__from__ast_8c.html#aeb329238f2566626f6cb8209e62a244c">01367</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#aeb329238f2566626f6cb8209e62a244c">terminate_registered_assignment</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *always_node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>* assignment, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *potential_clocks, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01368"></a>01368 {
<a name="l01369"></a>01369         <span class="keywordtype">int</span> i;
<a name="l01370"></a>01370         <span class="keywordtype">long</span> sc_spot;
<a name="l01371"></a>01371         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *ff_input_pin;
<a name="l01372"></a>01372         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *ff_output_pin;
<a name="l01373"></a>01373 
<a name="l01374"></a>01374         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(potential_clocks != NULL);
<a name="l01375"></a>01375 
<a name="l01376"></a>01376         <span class="comment">/* figure out which one is the clock */</span>
<a name="l01377"></a>01377         <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a> == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l01378"></a>01378         {
<a name="l01379"></a>01379                 <span class="keywordflow">for</span> (i = 0; i &lt; potential_clocks-&gt;signal_list_size; i++)
<a name="l01380"></a>01380                 {
<a name="l01381"></a>01381                         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *temp_net;
<a name="l01382"></a>01382                         <span class="comment">/* searching for the clock with no net */</span>
<a name="l01383"></a>01383                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, potential_clocks-&gt;signal_list[i]-&gt;name)) == -1)
<a name="l01384"></a>01384                         {
<a name="l01385"></a>01385                                 <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(input_nets_sc, potential_clocks-&gt;signal_list[i]-&gt;name)) == -1)
<a name="l01386"></a>01386                                 {
<a name="l01387"></a>01387                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, always_node-&gt;line_number, always_node-&gt;file_number, <span class="stringliteral">&quot;Sensitivity list element (%s) is not a driver or net ... must be\n&quot;</span>, potential_clocks-&gt;signal_list[i]-&gt;name);
<a name="l01388"></a>01388                                 }
<a name="l01389"></a>01389                                 temp_net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)input_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot];
<a name="l01390"></a>01390                         }
<a name="l01391"></a>01391                         <span class="keywordflow">else</span>
<a name="l01392"></a>01392                         {
<a name="l01393"></a>01393                                 temp_net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot];
<a name="l01394"></a>01394                         }
<a name="l01395"></a>01395         
<a name="l01396"></a>01396                         
<a name="l01397"></a>01397                         <span class="keywordflow">if</span> (
<a name="l01398"></a>01398                                 (((temp_net-&gt;num_fanout_pins == 1) &amp;&amp; (temp_net-&gt;fanout_pins[0]-&gt;node == NULL)) || (temp_net-&gt;num_fanout_pins == 0))
<a name="l01399"></a>01399                                 &amp;&amp; (<a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a> == <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>))
<a name="l01400"></a>01400                         {
<a name="l01401"></a>01401                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, always_node-&gt;line_number, always_node-&gt;file_number, <span class="stringliteral">&quot;Suspected second clock (%s).  In a sequential sensitivity list, Odin expects the clock not to drive anything and any other signals in this list to drive stuff.  For example, a reset in the sensitivy list has to be hooked up to something in the always block.\n&quot;</span>, potential_clocks-&gt;signal_list[i]-&gt;name);
<a name="l01402"></a>01402                         }
<a name="l01403"></a>01403                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (temp_net-&gt;num_fanout_pins == 0)
<a name="l01404"></a>01404                         {
<a name="l01405"></a>01405                                 <span class="comment">/* If this element is in the sensitivity list and doesn&#39;t drive anything it&#39;s the clock */</span>
<a name="l01406"></a>01406                                 <a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a> = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01407"></a>01407                                 <a class="code" href="netlist__create__from__ast_8c.html#a19076ea2a78a080292001e9b209a4a54">local_clock_idx</a> = i;
<a name="l01408"></a>01408                         }
<a name="l01409"></a>01409                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((temp_net-&gt;num_fanout_pins == 1) &amp;&amp; (temp_net-&gt;fanout_pins[0]-&gt;node == NULL))
<a name="l01410"></a>01410                         {
<a name="l01411"></a>01411                                 <span class="comment">/* If this element is in the sensitivity list and doesn&#39;t drive anything it&#39;s the clock */</span>
<a name="l01412"></a>01412                                 <a class="code" href="netlist__create__from__ast_8c.html#aac545a433b5f59ab184c67b0f9803712">local_clock_found</a> = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l01413"></a>01413                                 <a class="code" href="netlist__create__from__ast_8c.html#a19076ea2a78a080292001e9b209a4a54">local_clock_idx</a> = i;
<a name="l01414"></a>01414                         }
<a name="l01415"></a>01415                 }
<a name="l01416"></a>01416         }
<a name="l01417"></a>01417 
<a name="l01418"></a>01418         <span class="comment">/* in continuous assign we can hook up the inputs to the driving side of the nets */</span>    
<a name="l01419"></a>01419         <span class="keywordflow">for</span> (i = 0; i &lt; assignment-&gt;signal_list_size; i++)
<a name="l01420"></a>01420         {
<a name="l01421"></a>01421                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *ff_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01422"></a>01422                 <span class="comment">/* look up the net */</span>
<a name="l01423"></a>01423                 <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, assignment-&gt;signal_list[i]-&gt;name)) == -1)
<a name="l01424"></a>01424                 {
<a name="l01425"></a>01425                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, always_node-&gt;line_number, always_node-&gt;file_number, <span class="stringliteral">&quot;Assignment is missing driver (%s)\n&quot;</span>, assignment-&gt;signal_list[i]-&gt;name);
<a name="l01426"></a>01426                 }
<a name="l01427"></a>01427 
<a name="l01428"></a>01428                 <span class="comment">/* HERE create the ff node and hookup everything */</span>
<a name="l01429"></a>01429                 ff_node-&gt;related_ast_node = always_node;
<a name="l01430"></a>01430 
<a name="l01431"></a>01431                 ff_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ac96889cdb5583eda6f62c5ecec88c5d2">FF_NODE</a>;
<a name="l01432"></a>01432                 <span class="comment">/* create the unique name for this gate */</span>
<a name="l01433"></a>01433                 ff_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(ff_node, instance_name_prefix);
<a name="l01434"></a>01434                 <span class="comment">/* allocate the pins needed */</span>
<a name="l01435"></a>01435                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(ff_node, 2);
<a name="l01436"></a>01436                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(ff_node, 1);
<a name="l01437"></a>01437                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(ff_node, 1);
<a name="l01438"></a>01438                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(ff_node, 1);
<a name="l01439"></a>01439                 
<a name="l01440"></a>01440                 <span class="comment">/* add the clock to the flip_flop */</span>
<a name="l01441"></a>01441                 <span class="comment">/* add a fanout pin */</span>
<a name="l01442"></a>01442                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *fanout_pin_of_clock = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01443"></a>01443                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(potential_clocks-&gt;signal_list[<a class="code" href="netlist__create__from__ast_8c.html#a19076ea2a78a080292001e9b209a4a54">local_clock_idx</a>]-&gt;net, fanout_pin_of_clock);
<a name="l01444"></a>01444                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(ff_node, fanout_pin_of_clock, 1);
<a name="l01445"></a>01445 
<a name="l01446"></a>01446                 <span class="comment">/* hookup the driver pin (the in_1) to to this net (the lookup) */</span>
<a name="l01447"></a>01447                 ff_input_pin = assignment-&gt;signal_list[i];
<a name="l01448"></a>01448                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(ff_node, assignment-&gt;signal_list[i], 0);
<a name="l01449"></a>01449 
<a name="l01450"></a>01450                 <span class="comment">/* finally hookup the output pin of the flip flop to the orginal driver net */</span>
<a name="l01451"></a>01451                 ff_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01452"></a>01452                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(ff_node, ff_output_pin, 0);
<a name="l01453"></a>01453                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], ff_output_pin);
<a name="l01454"></a>01454 
<a name="l01455"></a>01455                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;ff_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)realloc(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;ff_nodes, <span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_ff_nodes+1));
<a name="l01456"></a>01456                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;ff_nodes[<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_ff_nodes] = ff_node;
<a name="l01457"></a>01457                 <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>-&gt;num_ff_nodes++;
<a name="l01458"></a>01458         }
<a name="l01459"></a>01459 
<a name="l01460"></a>01460         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(assignment);
<a name="l01461"></a>01461 }
<a name="l01462"></a>01462 
<a name="l01463"></a>01463 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01464"></a>01464 <span class="comment"> * (function: terminate_continuous_assignment)</span>
<a name="l01465"></a>01465 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01466"></a><a class="code" href="netlist__create__from__ast_8c.html#a2d5730a8723be89167a891cafb65c923">01466</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a2d5730a8723be89167a891cafb65c923">terminate_continuous_assignment</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>* assignment, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01467"></a>01467 {
<a name="l01468"></a>01468         <span class="keywordtype">int</span> i;
<a name="l01469"></a>01469         <span class="keywordtype">long</span> sc_spot;
<a name="l01470"></a>01470         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *buf_input_pin;
<a name="l01471"></a>01471         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *buf_output_pin;
<a name="l01472"></a>01472 
<a name="l01473"></a>01473         <span class="keywordflow">for</span> (i = 0; i &lt; assignment-&gt;signal_list_size; i++)
<a name="l01474"></a>01474         {
<a name="l01475"></a>01475                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *buf_node;
<a name="l01476"></a>01476 
<a name="l01477"></a>01477                 <span class="comment">/* look up the net */</span>
<a name="l01478"></a>01478                 <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(output_nets_sc, assignment-&gt;signal_list[i]-&gt;name)) == -1)
<a name="l01479"></a>01479                 {
<a name="l01480"></a>01480                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;Assignment (%s) is missing driver\n&quot;</span>, assignment-&gt;signal_list[i]-&gt;name);
<a name="l01481"></a>01481                 }
<a name="l01482"></a>01482 
<a name="l01483"></a>01483                 <span class="comment">/* check if the instantiation pin exists. */</span>
<a name="l01484"></a>01484                 <span class="keywordflow">if</span> (((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;name == NULL)
<a name="l01485"></a>01485                 {
<a name="l01486"></a>01486                         ((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;name = assignment-&gt;signal_list[i]-&gt;name;
<a name="l01487"></a>01487                 }
<a name="l01488"></a>01488 
<a name="l01489"></a>01489                 buf_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01490"></a>01490                 buf_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a57ef638621aab82c62d648665d310f3b">BUF_NODE</a>;
<a name="l01491"></a>01491                 <span class="comment">/* create the unique name for this gate */</span>
<a name="l01492"></a>01492                 buf_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(buf_node, instance_name_prefix);
<a name="l01493"></a>01493 
<a name="l01494"></a>01494                 buf_node-&gt;related_ast_node = node;
<a name="l01495"></a>01495                 <span class="comment">/* allocate the pins needed */</span>
<a name="l01496"></a>01496                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(buf_node, 1);
<a name="l01497"></a>01497                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(buf_node, 1);
<a name="l01498"></a>01498                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(buf_node, 1);
<a name="l01499"></a>01499                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(buf_node, 1);
<a name="l01500"></a>01500                 
<a name="l01501"></a>01501                 <span class="comment">/* hookup the driver pin (the in_1) to to this net (the lookup) */</span>
<a name="l01502"></a>01502                 buf_input_pin = assignment-&gt;signal_list[i];
<a name="l01503"></a>01503                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(buf_node, buf_input_pin, 0);
<a name="l01504"></a>01504 
<a name="l01505"></a>01505                 <span class="comment">/* finally hookup the output pin of the flip flop to the orginal driver net */</span>
<a name="l01506"></a>01506                 buf_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01507"></a>01507                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(buf_node, buf_output_pin, 0);
<a name="l01508"></a>01508                 <span class="keywordflow">if</span>(((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot])-&gt;driver_pin != NULL)
<a name="l01509"></a>01509                 {
<a name="l01510"></a>01510                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;You&#39;ve defined this driver %s twice (i.e. in the statement block you&#39;ve probably put the statement as a = b; a = c; in some form that&#39;s incorrect)\n&quot;</span>, assignment-&gt;signal_list[i]-&gt;name);
<a name="l01511"></a>01511                 }
<a name="l01512"></a>01512                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>((<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)output_nets_sc-&gt;<a class="code" href="struct_s_t_r_i_n_g___c_a_c_h_e.html#a86a0748b82e1c4b73d13b1c69f77ad77">data</a>[sc_spot], buf_output_pin);
<a name="l01513"></a>01513         }
<a name="l01514"></a>01514 
<a name="l01515"></a>01515         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(assignment);
<a name="l01516"></a>01516 }
<a name="l01517"></a>01517 
<a name="l01518"></a>01518 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01519"></a>01519 <span class="comment"> * (function: alias_output_assign_pins_to_inputs)</span>
<a name="l01520"></a>01520 <span class="comment"> *      Makes the names of the pins in the input list have the name of the output assignment</span>
<a name="l01521"></a>01521 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01522"></a><a class="code" href="netlist__create__from__ast_8c.html#aa39b79ba64a52bb51bb65281d10d6e56">01522</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#aa39b79ba64a52bb51bb65281d10d6e56">alias_output_assign_pins_to_inputs</a>(<a class="code" href="types_8h.html#a19ebfffd97b17110aeb4e1920c35aa78">char_list_t</a> *output_list, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *input_list, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node)
<a name="l01523"></a>01523 {
<a name="l01524"></a>01524         <span class="keywordtype">int</span> i;
<a name="l01525"></a>01525 
<a name="l01526"></a>01526         <span class="keywordflow">if</span> (output_list-&gt;num_strings &gt;= input_list-&gt;signal_list_size)
<a name="l01527"></a>01527         {
<a name="l01528"></a>01528                 <span class="keywordflow">for</span> (i = 0; i &lt; input_list-&gt;signal_list_size; i++)
<a name="l01529"></a>01529                 {
<a name="l01530"></a>01530                         input_list-&gt;signal_list[i]-&gt;name = output_list-&gt;strings[i];
<a name="l01531"></a>01531                 }
<a name="l01532"></a>01532                 <span class="keywordflow">for</span> (i = input_list-&gt;signal_list_size; i &lt; output_list-&gt;num_strings; i++)
<a name="l01533"></a>01533                 {
<a name="l01534"></a>01534                         <a class="code" href="errors_8c.html#aa8fef4442b310424b732a93a68191e0e">warning_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;More nets to drive then drivers, padding with ZEROs for driver %s\n&quot;</span>, output_list-&gt;strings[i]);
<a name="l01535"></a>01535                         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(input_list, <a class="code" href="netlist__utils_8h.html#a9e98d5a83bf869a56b12248621d7b6dc">get_a_zero_pin</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>));
<a name="l01536"></a>01536                         input_list-&gt;signal_list[i]-&gt;name = output_list-&gt;strings[i];
<a name="l01537"></a>01537                 }
<a name="l01538"></a>01538 
<a name="l01539"></a>01539                 <span class="keywordflow">return</span> output_list-&gt;num_strings;
<a name="l01540"></a>01540         }
<a name="l01541"></a>01541         <span class="keywordflow">else</span>
<a name="l01542"></a>01542         {
<a name="l01543"></a>01543                 <span class="keywordflow">for</span> (i = 0; i &lt; output_list-&gt;num_strings; i++)
<a name="l01544"></a>01544                 {
<a name="l01545"></a>01545                         input_list-&gt;signal_list[i]-&gt;name = output_list-&gt;strings[i];
<a name="l01546"></a>01546                 }
<a name="l01547"></a>01547                 <a class="code" href="errors_8c.html#aa8fef4442b310424b732a93a68191e0e">warning_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;May be a warning: appears that there are more driver pins then nets to drive, sometimes using decimal numbers causes this problem\n&quot;</span>);
<a name="l01548"></a>01548                 <span class="keywordflow">return</span> output_list-&gt;num_strings;
<a name="l01549"></a>01549         }
<a name="l01550"></a>01550 }
<a name="l01551"></a>01551 
<a name="l01552"></a>01552 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01553"></a>01553 <span class="comment"> * (function: create_gate)</span>
<a name="l01554"></a>01554 <span class="comment"> *      This function creates a gate node in the netlist and hooks up the inputs and </span>
<a name="l01555"></a>01555 <span class="comment"> *      outputs.</span>
<a name="l01556"></a>01556 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01557"></a><a class="code" href="netlist__create__from__ast_8c.html#a04d826039e77930b9e696ca0d43ce75d">01557</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a04d826039e77930b9e696ca0d43ce75d">create_gate</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* gate, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01558"></a>01558 {
<a name="l01559"></a>01559         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *in_1, *in_2, *out_1;
<a name="l01560"></a>01560         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *gate_node;
<a name="l01561"></a>01561         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *gate_instance = gate-&gt;children[0];
<a name="l01562"></a>01562 
<a name="l01563"></a>01563         <span class="keywordflow">if</span> (gate_instance-&gt;children[3] == NULL)
<a name="l01564"></a>01564         {
<a name="l01565"></a>01565                 <span class="comment">/* IF one input gate */</span>
<a name="l01566"></a>01566                 
<a name="l01567"></a>01567                 <span class="comment">/* process the signal for the input gate */</span>
<a name="l01568"></a>01568                 in_1 = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(gate_instance-&gt;children[2], instance_name_prefix);
<a name="l01569"></a>01569                 <span class="comment">/* process the signal for the input ga$te */</span>
<a name="l01570"></a>01570                 out_1 = <a class="code" href="netlist__create__from__ast_8c.html#ac096b2a9a70f0e15d3da9b9cb7731f73">create_output_pin</a>(gate_instance-&gt;children[1], instance_name_prefix);
<a name="l01571"></a>01571                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>((in_1 != NULL) &amp;&amp; (out_1 != NULL));
<a name="l01572"></a>01572 
<a name="l01573"></a>01573                 <span class="comment">/* create the node */</span>
<a name="l01574"></a>01574                 gate_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01575"></a>01575                 <span class="comment">/* store all the relevant info */</span>
<a name="l01576"></a>01576                 gate_node-&gt;related_ast_node = gate;
<a name="l01577"></a>01577                 gate_node-&gt;type = gate-&gt;types.operation.op;
<a name="l01578"></a>01578                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(gate_node-&gt;type &gt; 0);
<a name="l01579"></a>01579                 gate_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(gate_node, instance_name_prefix);
<a name="l01580"></a>01580                 <span class="comment">/* allocate the pins needed */</span>
<a name="l01581"></a>01581                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(gate_node, 1);
<a name="l01582"></a>01582                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(gate_node, 1);
<a name="l01583"></a>01583                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(gate_node, 1);
<a name="l01584"></a>01584                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(gate_node, 1);
<a name="l01585"></a>01585                 
<a name="l01586"></a>01586                 <span class="comment">/* hookup the input pins */</span>
<a name="l01587"></a>01587                 <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(gate_node, 0, in_1, 0, 1, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01588"></a>01588                 <span class="comment">/* hookup the output pins */</span>
<a name="l01589"></a>01589                 <a class="code" href="netlist__utils_8c.html#abf8b6755e1f51b049df1ac01effb6358">hookup_output_pins_from_signal_list</a>(gate_node, 0, out_1, 0, 1);
<a name="l01590"></a>01590 
<a name="l01591"></a>01591                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(in_1);
<a name="l01592"></a>01592         }
<a name="l01593"></a>01593         <span class="keywordflow">else</span>
<a name="l01594"></a>01594         {
<a name="l01595"></a>01595                 <span class="comment">/* ELSE 2 input gate */</span>
<a name="l01596"></a>01596                 
<a name="l01597"></a>01597                 <span class="comment">/* process the signal for the input gate */</span>
<a name="l01598"></a>01598                 in_1 = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(gate_instance-&gt;children[2], instance_name_prefix);
<a name="l01599"></a>01599                 in_2 = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(gate_instance-&gt;children[3], instance_name_prefix);
<a name="l01600"></a>01600                 <span class="comment">/* process the signal for the input gate */</span>
<a name="l01601"></a>01601                 out_1 = <a class="code" href="netlist__create__from__ast_8c.html#ac096b2a9a70f0e15d3da9b9cb7731f73">create_output_pin</a>(gate_instance-&gt;children[1], instance_name_prefix);
<a name="l01602"></a>01602                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>((in_1 != NULL) &amp;&amp; (in_2 != NULL) &amp;&amp; (out_1 != NULL));
<a name="l01603"></a>01603 
<a name="l01604"></a>01604                 <span class="comment">/* create the node */</span>
<a name="l01605"></a>01605                 gate_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01606"></a>01606                 <span class="comment">/* store all the relevant info */</span>
<a name="l01607"></a>01607                 gate_node-&gt;related_ast_node = gate;
<a name="l01608"></a>01608                 gate_node-&gt;type = gate-&gt;types.operation.op;
<a name="l01609"></a>01609                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(gate_node-&gt;type &gt; 0);
<a name="l01610"></a>01610 
<a name="l01611"></a>01611                 gate_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(gate_node, instance_name_prefix);
<a name="l01612"></a>01612                 <span class="comment">/* allocate the needed pins */</span>
<a name="l01613"></a>01613                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(gate_node, 2);
<a name="l01614"></a>01614                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(gate_node, 1);
<a name="l01615"></a>01615                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(gate_node, 1);
<a name="l01616"></a>01616                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(gate_node, 1);
<a name="l01617"></a>01617                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(gate_node, 1);
<a name="l01618"></a>01618                 
<a name="l01619"></a>01619                 <span class="comment">/* hookup the input pins */</span>
<a name="l01620"></a>01620                 <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(gate_node, 0, in_1, 0, 1, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01621"></a>01621                 <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(gate_node, 1, in_2, 0, 1, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01622"></a>01622                 <span class="comment">/* hookup the output pins */</span>
<a name="l01623"></a>01623                 <a class="code" href="netlist__utils_8c.html#abf8b6755e1f51b049df1ac01effb6358">hookup_output_pins_from_signal_list</a>(gate_node, 0, out_1, 0, 1);
<a name="l01624"></a>01624 
<a name="l01625"></a>01625                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(in_1);
<a name="l01626"></a>01626                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(in_2);
<a name="l01627"></a>01627         }
<a name="l01628"></a>01628         
<a name="l01629"></a>01629         <span class="keywordflow">return</span> out_1;
<a name="l01630"></a>01630 }
<a name="l01631"></a>01631 
<a name="l01632"></a>01632 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01633"></a>01633 <span class="comment"> * (function: create_operation_node)</span>
<a name="l01634"></a>01634 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01635"></a><a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">01635</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">create_operation_node</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *op, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **input_lists, <span class="keywordtype">int</span> list_size, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01636"></a>01636 {
<a name="l01637"></a>01637         <span class="keywordtype">int</span> i;
<a name="l01638"></a>01638         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l01639"></a>01639         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *operation_node;
<a name="l01640"></a>01640         <span class="keywordtype">int</span> max_input_port_width = -1;
<a name="l01641"></a>01641         <span class="keywordtype">int</span> output_port_width = -1;
<a name="l01642"></a>01642         <span class="keywordtype">int</span> input_port_width = -1;
<a name="l01643"></a>01643         <span class="keywordtype">int</span> current_idx;
<a name="l01644"></a>01644 
<a name="l01645"></a>01645         <span class="comment">/* create the node */</span>
<a name="l01646"></a>01646         operation_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01647"></a>01647         <span class="comment">/* store all the relevant info */</span>
<a name="l01648"></a>01648         operation_node-&gt;related_ast_node = op;
<a name="l01649"></a>01649         operation_node-&gt;type = op-&gt;types.operation.op;
<a name="l01650"></a>01650         operation_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(operation_node, instance_name_prefix);
<a name="l01651"></a>01651 
<a name="l01652"></a>01652         current_idx = 0;
<a name="l01653"></a>01653 
<a name="l01654"></a>01654         <span class="comment">/* analyse the inputs */</span>
<a name="l01655"></a>01655         <span class="keywordflow">for</span> (i = 0; i &lt; list_size; i++)
<a name="l01656"></a>01656         {
<a name="l01657"></a>01657                 <span class="keywordflow">if</span> (max_input_port_width &lt; input_lists[i]-&gt;signal_list_size)
<a name="l01658"></a>01658                 {
<a name="l01659"></a>01659                         max_input_port_width = input_lists[i]-&gt;signal_list_size;
<a name="l01660"></a>01660                 }
<a name="l01661"></a>01661         }
<a name="l01662"></a>01662                 
<a name="l01663"></a>01663         <span class="keywordflow">switch</span>(operation_node-&gt;type)
<a name="l01664"></a>01664         {
<a name="l01665"></a>01665                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a6f44e733bf8da36252af57ca3575a49f">BITWISE_NOT</a>: <span class="comment">// ~  </span>
<a name="l01666"></a>01666                         <span class="comment">/* only one input port */</span>
<a name="l01667"></a>01667                         output_port_width = max_input_port_width;
<a name="l01668"></a>01668                         input_port_width = output_port_width;
<a name="l01669"></a>01669                         <span class="keywordflow">break</span>;
<a name="l01670"></a>01670                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42acfcf145f2788bf340ff3f3098bc54909">ADD</a>: <span class="comment">// +</span>
<a name="l01671"></a>01671                         <span class="comment">/* add the largest bit width + the other input padded with 0&#39;s */</span>
<a name="l01672"></a>01672                         output_port_width = max_input_port_width;
<a name="l01673"></a>01673                         input_port_width = output_port_width;
<a name="l01674"></a>01674                         <span class="keywordflow">break</span>;
<a name="l01675"></a>01675                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af613d73b4e7b570ffd967df4a13c4225">MINUS</a>: <span class="comment">// -</span>
<a name="l01676"></a>01676                         <span class="comment">/* subtract the largest bit width + the other input padded with 0&#39;s ... concern for 2&#39;s comp */</span>
<a name="l01677"></a>01677                         output_port_width = max_input_port_width;
<a name="l01678"></a>01678                         input_port_width = output_port_width;
<a name="l01679"></a>01679                         <span class="keywordflow">break</span>;
<a name="l01680"></a>01680                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ae59a728a365f9d6b2643057973cdf4c3">MULTIPLY</a>: <span class="comment">// *</span>
<a name="l01681"></a>01681                         <span class="comment">/* pad the smaller one with 0&#39;s */</span>
<a name="l01682"></a>01682                         output_port_width = input_lists[0]-&gt;signal_list_size + input_lists[1]-&gt;signal_list_size;
<a name="l01683"></a>01683                         input_port_width = -2;
<a name="l01684"></a>01684 
<a name="l01685"></a>01685                         <span class="comment">/* Record multiply nodes for netlist optimization */</span>
<a name="l01686"></a>01686                         <a class="code" href="multipliers_8c.html#ab0d0bb83d1917735655bcb7783c48e67">mult_list</a> = insert_in_vptr_list(<a class="code" href="multipliers_8c.html#ab0d0bb83d1917735655bcb7783c48e67">mult_list</a>, operation_node);
<a name="l01687"></a>01687                         <span class="keywordflow">break</span>;
<a name="l01688"></a>01688                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ad524559107671b8dcb8112f897e4114f">BITWISE_AND</a>: <span class="comment">// &amp;</span>
<a name="l01689"></a>01689                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a8f7dc39713464431bfc92198b732c639">BITWISE_OR</a>: <span class="comment">// |</span>
<a name="l01690"></a>01690                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a5bd3f5ea1930ced4bdb122d99db7b44b">BITWISE_NAND</a>: <span class="comment">// ~&amp;</span>
<a name="l01691"></a>01691                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42adeebbd7d47e1c84c529a49b135836b58">BITWISE_NOR</a>: <span class="comment">// ~| </span>
<a name="l01692"></a>01692                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a79d959b549b810ae68ac18c90369c134">BITWISE_XNOR</a>: <span class="comment">// ~^ </span>
<a name="l01693"></a>01693                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42afc037ceb203dc69f59cadad9909a3edc">BITWISE_XOR</a>: <span class="comment">// ^</span>
<a name="l01694"></a>01694                         <span class="comment">/* we&#39;ll padd the other inputs with 0, do it for the largest and throw a warning */</span>
<a name="l01695"></a>01695                         <span class="keywordflow">if</span> (list_size == 2)
<a name="l01696"></a>01696                         {
<a name="l01697"></a>01697                                 output_port_width = max_input_port_width;
<a name="l01698"></a>01698                                 input_port_width = output_port_width;
<a name="l01699"></a>01699                         }
<a name="l01700"></a>01700                         <span class="keywordflow">else</span> 
<a name="l01701"></a>01701                         {
<a name="l01702"></a>01702                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(list_size == 1);
<a name="l01703"></a>01703                                 <span class="comment">/* Logical reduction - same as a logic function */</span>
<a name="l01704"></a>01704                                 output_port_width = 1;
<a name="l01705"></a>01705                                 input_port_width = max_input_port_width;
<a name="l01706"></a>01706                         }
<a name="l01707"></a>01707                         <span class="keywordflow">break</span>;
<a name="l01708"></a>01708                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af55bee7a30a0b05bb46ebb54e680a144">SR</a>: <span class="comment">// &gt;&gt;</span>
<a name="l01709"></a>01709                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ac4c83bba97ff1d2e6eeed95b312e04a3">SL</a>: <span class="comment">// &lt;&lt;</span>
<a name="l01710"></a>01710                         <span class="comment">/* Shifts doesn&#39;t matter about port size, but second input needs to be a number */</span>
<a name="l01711"></a>01711                         output_port_width = max_input_port_width;
<a name="l01712"></a>01712                         input_port_width = -2;
<a name="l01713"></a>01713                         <span class="keywordflow">break</span>;
<a name="l01714"></a>01714                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a338770ae0137fdc621244e0e34b9002d">LOGICAL_NOT</a>: <span class="comment">// ! </span>
<a name="l01715"></a>01715                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a1c0c9f14ba0a9a25e18da9675cb94059">LOGICAL_OR</a>: <span class="comment">// ||</span>
<a name="l01716"></a>01716                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a366842f5b5cbe0000d57b83f2764f30e">LOGICAL_AND</a>: <span class="comment">// &amp;&amp;</span>
<a name="l01717"></a>01717                         <span class="comment">/* only one input port */</span>
<a name="l01718"></a>01718                         output_port_width = 1;
<a name="l01719"></a>01719                         input_port_width = max_input_port_width;
<a name="l01720"></a>01720                         <span class="keywordflow">break</span>;
<a name="l01721"></a>01721                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a486aa221ceeeac475326e85d3d37f571">LT</a>: <span class="comment">// &lt;</span>
<a name="l01722"></a>01722                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a12f5476fa04803e6cc72f2198730d892">GT</a>: <span class="comment">// &gt;</span>
<a name="l01723"></a>01723                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42abcec1f158bbc5af07e897785dcd8ce26">LOGICAL_EQUAL</a>: <span class="comment">// == </span>
<a name="l01724"></a>01724                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42aee522b0a37857a8fdd19f82ad1b9b1d6">NOT_EQUAL</a>: <span class="comment">// !=</span>
<a name="l01725"></a>01725                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42add4edd9fb0d6fad316ff9db560c4096d">LTE</a>: <span class="comment">// &lt;=</span>
<a name="l01726"></a>01726                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a7303510947cbe9a41f9fed933a881e3c">GTE</a>: <span class="comment">// &gt;=</span>
<a name="l01727"></a>01727                 {
<a name="l01728"></a>01728                         <span class="keywordflow">if</span> (input_lists[0]-&gt;signal_list_size != input_lists[1]-&gt;signal_list_size)
<a name="l01729"></a>01729                         {
<a name="l01730"></a>01730                                 <span class="keywordtype">int</span> index_of_smallest = <a class="code" href="netlist__create__from__ast_8c.html#a996aae68a2788a53e347e7c9ecd4354b">find_smallest_non_numerical</a>(op, input_lists, 2);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732                                 input_port_width = input_lists[index_of_smallest]-&gt;signal_list_size;
<a name="l01733"></a>01733 
<a name="l01734"></a>01734                                 <span class="comment">/* pad the input lists */</span>
<a name="l01735"></a>01735                                 <a class="code" href="netlist__create__from__ast_8c.html#ac822ec3df17d36632c012c312939bfb4">pad_with_zeros</a>(op, input_lists[0], input_port_width, instance_name_prefix);
<a name="l01736"></a>01736                                 <a class="code" href="netlist__create__from__ast_8c.html#ac822ec3df17d36632c012c312939bfb4">pad_with_zeros</a>(op, input_lists[1], input_port_width, instance_name_prefix);
<a name="l01737"></a>01737                         }
<a name="l01738"></a>01738                         <span class="keywordflow">else</span>
<a name="l01739"></a>01739                         {
<a name="l01740"></a>01740                                 input_port_width = input_lists[0]-&gt;signal_list_size;
<a name="l01741"></a>01741                         }
<a name="l01742"></a>01742                         output_port_width = 1;
<a name="l01743"></a>01743                         <span class="keywordflow">break</span>;
<a name="l01744"></a>01744                 }
<a name="l01745"></a>01745                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a0cb86713ee09fe297dde9ab03d50d5da">DIVIDE</a>: <span class="comment">// /</span>
<a name="l01746"></a>01746                 <span class="keywordflow">case</span> <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42aa3e7f342d1ed096b43c7367237a6459e">MODULO</a>: <span class="comment">// %</span>
<a name="l01747"></a>01747                 <span class="keywordflow">default</span>:
<a name="l01748"></a>01748                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>,  op-&gt;line_number, op-&gt;file_number, <span class="stringliteral">&quot;Operation not supported by Odin\n&quot;</span>);
<a name="l01749"></a>01749                         <span class="keywordflow">break</span>;
<a name="l01750"></a>01750         }
<a name="l01751"></a>01751 
<a name="l01752"></a>01752         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(input_port_width != -1);
<a name="l01753"></a>01753         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(output_port_width != -1);
<a name="l01754"></a>01754 
<a name="l01755"></a>01755         <span class="keywordflow">for</span> (i = 0; i &lt; list_size; i++)
<a name="l01756"></a>01756         {
<a name="l01757"></a>01757                 <span class="keywordflow">if</span> ((operation_node-&gt;type == <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af55bee7a30a0b05bb46ebb54e680a144">SR</a>) || (operation_node-&gt;type == <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ac4c83bba97ff1d2e6eeed95b312e04a3">SL</a>))
<a name="l01758"></a>01758                 {
<a name="l01759"></a>01759                         <span class="comment">/* for shift left or right, it&#39;s actually a one port operation.  Assume the 2nd port is constant */</span>
<a name="l01760"></a>01760                         <span class="keywordflow">if</span> (i == 0)
<a name="l01761"></a>01761                         {
<a name="l01762"></a>01762                                 <span class="comment">/* allocate the pins needed */</span>
<a name="l01763"></a>01763                                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(operation_node, input_lists[i]-&gt;signal_list_size);
<a name="l01764"></a>01764                                 <span class="comment">/* record this port size */</span>
<a name="l01765"></a>01765                                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(operation_node, input_lists[i]-&gt;signal_list_size);
<a name="l01766"></a>01766                                 <span class="comment">/* hookup the input pins */</span>
<a name="l01767"></a>01767                                 <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(operation_node, current_idx, input_lists[i], 0, input_lists[i]-&gt;signal_list_size, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01768"></a>01768                         }
<a name="l01769"></a>01769                 }
<a name="l01770"></a>01770                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (input_port_width != -2)
<a name="l01771"></a>01771                 {
<a name="l01772"></a>01772                         <span class="comment">/* IF taking port widths based on preset */</span>
<a name="l01773"></a>01773                         <span class="comment">/* allocate the pins needed */</span>
<a name="l01774"></a>01774                         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(operation_node, input_port_width);
<a name="l01775"></a>01775                         <span class="comment">/* record this port size */</span>
<a name="l01776"></a>01776                         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(operation_node, input_port_width);
<a name="l01777"></a>01777 
<a name="l01778"></a>01778                         <span class="comment">/* hookup the input pins = will do padding of zeros for smaller port */</span>
<a name="l01779"></a>01779                         <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(operation_node, current_idx, input_lists[i], 0, input_port_width, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01780"></a>01780                         current_idx += input_port_width;
<a name="l01781"></a>01781                 }
<a name="l01782"></a>01782                 <span class="keywordflow">else</span>
<a name="l01783"></a>01783                 {
<a name="l01784"></a>01784                         <span class="comment">/* ELSE if taking the port widths as they are */</span>
<a name="l01785"></a>01785                         <span class="comment">/* allocate the pins needed */</span>
<a name="l01786"></a>01786                         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(operation_node, input_lists[i]-&gt;signal_list_size);
<a name="l01787"></a>01787                         <span class="comment">/* record this port size */</span>
<a name="l01788"></a>01788                         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(operation_node, input_lists[i]-&gt;signal_list_size);
<a name="l01789"></a>01789 
<a name="l01790"></a>01790                         <span class="comment">/* hookup the input pins */</span>
<a name="l01791"></a>01791                         <a class="code" href="netlist__utils_8c.html#a30461f339c314b654336a9dc8829946d">hookup_input_pins_from_signal_list</a>(operation_node, current_idx, input_lists[i], 0, input_lists[i]-&gt;signal_list_size, <a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>);
<a name="l01792"></a>01792                         
<a name="l01793"></a>01793                         current_idx += input_lists[i]-&gt;signal_list_size;
<a name="l01794"></a>01794                 }
<a name="l01795"></a>01795 
<a name="l01796"></a>01796 
<a name="l01797"></a>01797         }
<a name="l01798"></a>01798         <span class="comment">/* allocate the pins for the ouput port */</span>
<a name="l01799"></a>01799         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(operation_node, output_port_width);
<a name="l01800"></a>01800         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(operation_node, output_port_width);
<a name="l01801"></a>01801                 
<a name="l01802"></a>01802         <span class="comment">/* make the inplicit output list and hook up the outputs */</span>
<a name="l01803"></a>01803         <span class="keywordflow">for</span> (i = 0; i &lt; output_port_width; i++)
<a name="l01804"></a>01804         {
<a name="l01805"></a>01805                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin1;
<a name="l01806"></a>01806                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin2;
<a name="l01807"></a>01807                 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l01808"></a>01808                 new_pin1 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01809"></a>01809                 new_pin2 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l01810"></a>01810                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l01811"></a>01811                 new_net-&gt;name = operation_node-&gt;name;
<a name="l01812"></a>01812                 <span class="comment">/* hook the output pin into the node */</span>
<a name="l01813"></a>01813                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(operation_node, new_pin1, i);
<a name="l01814"></a>01814                 <span class="comment">/* hook up new pin 1 into the new net */</span>
<a name="l01815"></a>01815                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, new_pin1);
<a name="l01816"></a>01816                 <span class="comment">/* hook up the new pin 2 to this new net */</span>
<a name="l01817"></a>01817                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(new_net, new_pin2);
<a name="l01818"></a>01818                 
<a name="l01819"></a>01819                 <span class="comment">/* add the new_pin 2 to the list of outputs */</span>
<a name="l01820"></a>01820                 <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_list, new_pin2);
<a name="l01821"></a>01821         }
<a name="l01822"></a>01822 
<a name="l01823"></a>01823         <span class="keywordflow">for</span> (i = 0; i &lt; list_size; i++)
<a name="l01824"></a>01824         {
<a name="l01825"></a>01825                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(input_lists[i]);
<a name="l01826"></a>01826         }
<a name="l01827"></a>01827         
<a name="l01828"></a>01828         <span class="keywordflow">return</span> return_list;
<a name="l01829"></a>01829 }
<a name="l01830"></a>01830 
<a name="l01831"></a>01831 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01832"></a>01832 <span class="comment"> * (function: evaluate_sensitivity_list)</span>
<a name="l01833"></a>01833 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01834"></a><a class="code" href="netlist__create__from__ast_8c.html#a44e584d4c733c722625b383950e8ef07">01834</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a44e584d4c733c722625b383950e8ef07">evaluate_sensitivity_list</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *delay_control, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01835"></a>01835 {
<a name="l01836"></a>01836         <span class="keywordtype">int</span> i;
<a name="l01837"></a>01837         <span class="keywordtype">short</span> edge_type = -1;
<a name="l01838"></a>01838         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_sig_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l01839"></a>01839         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *temp_list;
<a name="l01840"></a>01840 
<a name="l01841"></a>01841         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(delay_control-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a4740db87ea931068433cc96330209cfe">DELAY_CONTROL</a>);
<a name="l01842"></a>01842 
<a name="l01843"></a>01843         <span class="keywordflow">for</span> (i = 0; i &lt; delay_control-&gt;num_children; i++)
<a name="l01844"></a>01844         {
<a name="l01845"></a>01845                 <span class="keywordflow">if</span> (    ((delay_control-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9ab5082d97d82be2b7da954da00900a1ee">NEGEDGE</a>) || (delay_control-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a733fd2b6fedd11ff5ca179bff8338f27">POSEDGE</a>)) 
<a name="l01846"></a>01846                         &amp;&amp; 
<a name="l01847"></a>01847                         ((edge_type == -1) || (edge_type == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>)))
<a name="l01848"></a>01848                 {
<a name="l01849"></a>01849                         edge_type = <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>;         
<a name="l01850"></a>01850 
<a name="l01851"></a>01851                         temp_list = <a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">create_pins</a>(delay_control-&gt;children[i]-&gt;children[0], NULL, instance_name_prefix);
<a name="l01852"></a>01852                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(temp_list-&gt;signal_list_size == 1);
<a name="l01853"></a>01853 
<a name="l01854"></a>01854                         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_sig_list, temp_list-&gt;signal_list[0]);
<a name="l01855"></a>01855                         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(temp_list);
<a name="l01856"></a>01856                 }
<a name="l01857"></a>01857                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((edge_type == -1) || (edge_type == <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>))
<a name="l01858"></a>01858                 {
<a name="l01859"></a>01859                         <span class="comment">/* ELSE - a combinational edge and we don&#39;t need to do anything */</span>
<a name="l01860"></a>01860                         edge_type = <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>;
<a name="l01861"></a>01861                 }
<a name="l01862"></a>01862                 <span class="keywordflow">else</span>
<a name="l01863"></a>01863                 {
<a name="l01864"></a>01864                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, delay_control-&gt;line_number, delay_control-&gt;file_number, <span class="stringliteral">&quot;Sensitivity list switches from sequential and combinational.  You can&#39;t define somthing like always @(posedgel clock or a).\n&quot;</span>);
<a name="l01865"></a>01865                 }
<a name="l01866"></a>01866         }
<a name="l01867"></a>01867 
<a name="l01868"></a>01868         <span class="comment">/* update the analysis type of this block of statements */</span>
<a name="l01869"></a>01869         <span class="keywordflow">if</span> (edge_type == -1)
<a name="l01870"></a>01870         {
<a name="l01871"></a>01871                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, delay_control-&gt;line_number, delay_control-&gt;file_number, <span class="stringliteral">&quot;Sensitivity list error...looks empty?\n&quot;</span>);
<a name="l01872"></a>01872         }
<a name="l01873"></a>01873         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (edge_type == <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>)
<a name="l01874"></a>01874         {
<a name="l01875"></a>01875                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(return_sig_list);
<a name="l01876"></a>01876                 return_sig_list = NULL;
<a name="l01877"></a>01877                 <a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> = edge_type;
<a name="l01878"></a>01878         }
<a name="l01879"></a>01879         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (edge_type == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>)
<a name="l01880"></a>01880         {
<a name="l01881"></a>01881                 <a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> = edge_type;
<a name="l01882"></a>01882         }
<a name="l01883"></a>01883 
<a name="l01884"></a>01884         <span class="keywordflow">return</span> return_sig_list;
<a name="l01885"></a>01885 }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01888"></a>01888 <span class="comment"> * (function: create_if_for_question)</span>
<a name="l01889"></a>01889 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01890"></a><a class="code" href="netlist__create__from__ast_8c.html#aa13dff4b6fe9e4b559db66aec474fe21">01890</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#aa13dff4b6fe9e4b559db66aec474fe21">create_if_for_question</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01891"></a>01891 {
<a name="l01892"></a>01892         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l01893"></a>01893         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node;
<a name="l01894"></a>01894 
<a name="l01895"></a>01895         <span class="comment">/* create the node */</span>
<a name="l01896"></a>01896         if_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01897"></a>01897         <span class="comment">/* store all the relevant info */</span>
<a name="l01898"></a>01898         if_node-&gt;related_ast_node = if_ast;
<a name="l01899"></a>01899         if_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a990bb2f8f772c8f32e33e41709beea3e">MULTI_PORT_MUX</a>; <span class="comment">// port 1 = control, port 2+ = mux options</span>
<a name="l01900"></a>01900         if_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(if_node, instance_name_prefix);
<a name="l01901"></a>01901 
<a name="l01902"></a>01902         <span class="comment">/* create the control structure for the if node */</span>
<a name="l01903"></a>01903         <a class="code" href="netlist__create__from__ast_8c.html#a4d8b7abf5261ee5477de2d80690f99b9">create_if_control_signals</a>(if_ast-&gt;children[0], if_node, instance_name_prefix);
<a name="l01904"></a>01904 
<a name="l01905"></a>01905         <span class="comment">/* create the statements and integrate them into the mux */</span>
<a name="l01906"></a>01906         return_list = <a class="code" href="netlist__create__from__ast_8c.html#a496054778bb5e7b0560141eaf2466ba2">create_if_question_mux_expressions</a>(if_ast, if_node, instance_name_prefix);
<a name="l01907"></a>01907 
<a name="l01908"></a>01908         <span class="keywordflow">return</span> return_list;
<a name="l01909"></a>01909 }
<a name="l01910"></a>01910 
<a name="l01911"></a>01911 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01912"></a>01912 <span class="comment"> * (function:  create_if_question_mux_expressions)</span>
<a name="l01913"></a>01913 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01914"></a><a class="code" href="netlist__create__from__ast_8c.html#a496054778bb5e7b0560141eaf2466ba2">01914</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a496054778bb5e7b0560141eaf2466ba2">create_if_question_mux_expressions</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01915"></a>01915 {
<a name="l01916"></a>01916         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **if_expressions;
<a name="l01917"></a>01917         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l01918"></a>01918         <span class="keywordtype">int</span> i;
<a name="l01919"></a>01919 
<a name="l01920"></a>01920         <span class="comment">/* make storage for statements and expressions */</span>
<a name="l01921"></a>01921         if_expressions = (<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>*)*2);
<a name="l01922"></a>01922 
<a name="l01923"></a>01923         <span class="comment">/* now we will process the statements and add to the other ports */</span>
<a name="l01924"></a>01924         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l01925"></a>01925         {
<a name="l01926"></a>01926                 <span class="keywordflow">if</span> (if_ast-&gt;children[i+1] != NULL) <span class="comment">// checking to see if expression exists.  +1 since first child is control expression</span>
<a name="l01927"></a>01927                 {
<a name="l01928"></a>01928                         <span class="comment">/* IF - this is a normal case item, then process the case match and the details of the statement */</span>
<a name="l01929"></a>01929                         if_expressions[i] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(if_ast-&gt;children[i+1], instance_name_prefix);
<a name="l01930"></a>01930                 }
<a name="l01931"></a>01931                 <span class="keywordflow">else</span> 
<a name="l01932"></a>01932                 {
<a name="l01933"></a>01933                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, if_ast-&gt;line_number, if_ast-&gt;file_number, <span class="stringliteral">&quot;No such thing as a a = b ? z;\n&quot;</span>);
<a name="l01934"></a>01934                 }
<a name="l01935"></a>01935         }
<a name="l01936"></a>01936         
<a name="l01937"></a>01937         <span class="comment">/* now with all the lists sorted, we do the matching and proper propogation */</span>  
<a name="l01938"></a>01938         return_list = <a class="code" href="netlist__create__from__ast_8c.html#ae59a3a263c57c921d3347110d86c471f">create_mux_expressions</a>(if_expressions, if_node, 2, instance_name_prefix);
<a name="l01939"></a>01939 
<a name="l01940"></a>01940         <span class="keywordflow">return</span> return_list;
<a name="l01941"></a>01941 }
<a name="l01942"></a>01942 
<a name="l01943"></a>01943 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01944"></a>01944 <span class="comment"> * (function: create_if)</span>
<a name="l01945"></a>01945 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01946"></a><a class="code" href="netlist__create__from__ast_8c.html#a352ad2eb277ecb9b8ad8548dc399f2be">01946</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a352ad2eb277ecb9b8ad8548dc399f2be">create_if</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01947"></a>01947 {
<a name="l01948"></a>01948         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l01949"></a>01949         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node;
<a name="l01950"></a>01950 
<a name="l01951"></a>01951         <span class="comment">/* create the node */</span>
<a name="l01952"></a>01952         if_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l01953"></a>01953         <span class="comment">/* store all the relevant info */</span>
<a name="l01954"></a>01954         if_node-&gt;related_ast_node = if_ast;
<a name="l01955"></a>01955         if_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a990bb2f8f772c8f32e33e41709beea3e">MULTI_PORT_MUX</a>; <span class="comment">// port 1 = control, port 2+ = mux options</span>
<a name="l01956"></a>01956         if_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(if_node, instance_name_prefix);
<a name="l01957"></a>01957 
<a name="l01958"></a>01958         <span class="comment">/* create the control structure for the if node */</span>
<a name="l01959"></a>01959         <a class="code" href="netlist__create__from__ast_8c.html#a4d8b7abf5261ee5477de2d80690f99b9">create_if_control_signals</a>(if_ast-&gt;children[0], if_node, instance_name_prefix);
<a name="l01960"></a>01960 
<a name="l01961"></a>01961         <span class="comment">/* create the statements and integrate them into the mux */</span>
<a name="l01962"></a>01962         return_list = <a class="code" href="netlist__create__from__ast_8c.html#a89bcc2d665ec608cfb0b072cf802dd33">create_if_mux_statements</a>(if_ast, if_node, instance_name_prefix);
<a name="l01963"></a>01963 
<a name="l01964"></a>01964         <span class="keywordflow">return</span> return_list;
<a name="l01965"></a>01965 }
<a name="l01966"></a>01966 
<a name="l01967"></a>01967 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l01968"></a>01968 <span class="comment"> * (function:  create_if_control_signals)</span>
<a name="l01969"></a>01969 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l01970"></a><a class="code" href="netlist__create__from__ast_8c.html#a4d8b7abf5261ee5477de2d80690f99b9">01970</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#a4d8b7abf5261ee5477de2d80690f99b9">create_if_control_signals</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_expression, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l01971"></a>01971 {
<a name="l01972"></a>01972         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *if_logic_expression;
<a name="l01973"></a>01973         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *if_logic_expression_final;
<a name="l01974"></a>01974         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *not_node;
<a name="l01975"></a>01975         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *not_pin;
<a name="l01976"></a>01976         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *out_pin_list;
<a name="l01977"></a>01977 
<a name="l01978"></a>01978         <span class="comment">/* reserve the first 2 pins of the mux for the control signals */</span>
<a name="l01979"></a>01979         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(if_node, 2);
<a name="l01980"></a>01980         <span class="comment">/* record this port size */</span>
<a name="l01981"></a>01981         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(if_node, 2);
<a name="l01982"></a>01982         
<a name="l01983"></a>01983         <span class="comment">/* get the logic */</span>
<a name="l01984"></a>01984         if_logic_expression = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(if_expression, instance_name_prefix);
<a name="l01985"></a>01985         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(if_logic_expression != NULL);
<a name="l01986"></a>01986 
<a name="l01987"></a>01987         <span class="keywordflow">if</span>(if_logic_expression-&gt;signal_list_size != 1)
<a name="l01988"></a>01988         {
<a name="l01989"></a>01989                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *or_gate;
<a name="l01990"></a>01990                 <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *default_expression;
<a name="l01991"></a>01991                 
<a name="l01992"></a>01992                 or_gate = <a class="code" href="node__creation__library_8c.html#aa2d78b9fff05e96d3af41c481e86ddf6">make_1port_logic_gate_with_inputs</a>(<a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a1c0c9f14ba0a9a25e18da9675cb94059">LOGICAL_OR</a>, if_logic_expression-&gt;signal_list_size, if_logic_expression, if_node, -1);
<a name="l01993"></a>01993                 default_expression = <a class="code" href="netlist__utils_8c.html#a27635e3f152a9a1269740bbdd54c76b1">make_output_pins_for_existing_node</a>(or_gate, 1);
<a name="l01994"></a>01994                 
<a name="l01995"></a>01995                 <span class="comment">/* copy that output pin to be put into the default */</span>
<a name="l01996"></a>01996                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(if_node, default_expression-&gt;signal_list[0], 0);
<a name="l01997"></a>01997 
<a name="l01998"></a>01998                 if_logic_expression_final = default_expression;
<a name="l01999"></a>01999         }
<a name="l02000"></a>02000         <span class="keywordflow">else</span>
<a name="l02001"></a>02001         {
<a name="l02002"></a>02002                 <span class="comment">/* hookup this pin to the spot in the if_node */</span>
<a name="l02003"></a>02003                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(if_node, if_logic_expression-&gt;signal_list[0], 0);
<a name="l02004"></a>02004                 if_logic_expression_final = if_logic_expression;
<a name="l02005"></a>02005         }
<a name="l02006"></a>02006 
<a name="l02007"></a>02007         <span class="comment">/* hookup pin again to not gate and then to other spot */</span>
<a name="l02008"></a>02008         not_pin = <a class="code" href="netlist__utils_8c.html#a1929749a89bf66c63231506654cc0ef7">copy_input_npin</a>(if_logic_expression_final-&gt;signal_list[0]);
<a name="l02009"></a>02009 
<a name="l02010"></a>02010         <span class="comment">/* make a NOT gate that collects all the other signals and if they&#39;re all off */</span>
<a name="l02011"></a>02011         not_node = <a class="code" href="node__creation__library_8c.html#ad092975fe54b0845f2b03f8461c4cd20">make_not_gate_with_input</a>(not_pin, if_node, -1);
<a name="l02012"></a>02012 
<a name="l02013"></a>02013         <span class="comment">/* get the output pin of the not gate .... also adds a net inbetween and the linking output pin to node and net */</span>
<a name="l02014"></a>02014         out_pin_list = <a class="code" href="netlist__utils_8c.html#a27635e3f152a9a1269740bbdd54c76b1">make_output_pins_for_existing_node</a>(not_node, 1);
<a name="l02015"></a>02015         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(out_pin_list-&gt;signal_list_size == 1);
<a name="l02016"></a>02016                         
<a name="l02017"></a>02017         <span class="comment">/* copy that output pin to be put into the default */</span>
<a name="l02018"></a>02018         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(if_node, out_pin_list-&gt;signal_list[0], 1);
<a name="l02019"></a>02019 
<a name="l02020"></a>02020         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(out_pin_list);
<a name="l02021"></a>02021 }
<a name="l02022"></a>02022 
<a name="l02023"></a>02023 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02024"></a>02024 <span class="comment"> * (function:  create_if_mux_statements)</span>
<a name="l02025"></a>02025 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02026"></a><a class="code" href="netlist__create__from__ast_8c.html#a89bcc2d665ec608cfb0b072cf802dd33">02026</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a89bcc2d665ec608cfb0b072cf802dd33">create_if_mux_statements</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *if_ast, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *if_node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02027"></a>02027 {
<a name="l02028"></a>02028         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **if_statements;
<a name="l02029"></a>02029         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l02030"></a>02030         <span class="keywordtype">int</span> i;
<a name="l02031"></a>02031 
<a name="l02032"></a>02032         <span class="comment">/* make storage for statements and expressions */</span>
<a name="l02033"></a>02033         if_statements = (<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>*)*2);
<a name="l02034"></a>02034 
<a name="l02035"></a>02035         <span class="comment">/* now we will process the statements and add to the other ports */</span>
<a name="l02036"></a>02036         <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++)
<a name="l02037"></a>02037         {
<a name="l02038"></a>02038                 <span class="keywordflow">if</span> (if_ast-&gt;children[i+1] != NULL) <span class="comment">// checking to see if statement exists.  +1 since first child is control expression</span>
<a name="l02039"></a>02039                 {
<a name="l02040"></a>02040                         <span class="comment">/* IF - this is a normal case item, then process the case match and the details of the statement */</span>
<a name="l02041"></a>02041                         if_statements[i] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(if_ast-&gt;children[i+1], instance_name_prefix);
<a name="l02042"></a>02042                         <a class="code" href="netlist__utils_8c.html#a6879eb04ce54ca34d57920c36d0b0f89">sort_signal_list_alphabetically</a>(if_statements[i]);
<a name="l02043"></a>02043                 }
<a name="l02044"></a>02044                 <span class="keywordflow">else</span> 
<a name="l02045"></a>02045                 {
<a name="l02046"></a>02046                         <span class="comment">/* ELSE - there is no if/else and we need to make a placeholder since it means there will be implied signals */</span>
<a name="l02047"></a>02047                         if_statements[i] = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l02048"></a>02048                 }
<a name="l02049"></a>02049         }
<a name="l02050"></a>02050         
<a name="l02051"></a>02051         <span class="comment">/* now with all the lists sorted, we do the matching and proper propogation */</span>  
<a name="l02052"></a>02052         return_list = <a class="code" href="netlist__create__from__ast_8c.html#abb64aec8e8618459b3d1d70622456d6d">create_mux_statements</a>(if_statements, if_node, 2, instance_name_prefix);
<a name="l02053"></a>02053 
<a name="l02054"></a>02054         <span class="keywordflow">return</span> return_list;
<a name="l02055"></a>02055 }
<a name="l02056"></a>02056 
<a name="l02057"></a>02057 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02058"></a>02058 <span class="comment"> * (function: create_case)</span>
<a name="l02059"></a>02059 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02060"></a><a class="code" href="netlist__create__from__ast_8c.html#a1f4b4edf7d9492089ecff8fbacc1770c">02060</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a1f4b4edf7d9492089ecff8fbacc1770c">create_case</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_ast, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02061"></a>02061 {
<a name="l02062"></a>02062         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l02063"></a>02063         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node;
<a name="l02064"></a>02064         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_list_of_items;
<a name="l02065"></a>02065         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_match_input;
<a name="l02066"></a>02066 
<a name="l02067"></a>02067         <span class="comment">/* create the node */</span>
<a name="l02068"></a>02068         case_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l02069"></a>02069         <span class="comment">/* store all the relevant info */</span>
<a name="l02070"></a>02070         case_node-&gt;related_ast_node = case_ast;
<a name="l02071"></a>02071         case_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a990bb2f8f772c8f32e33e41709beea3e">MULTI_PORT_MUX</a>; <span class="comment">// port 1 = control, port 2+ = mux options</span>
<a name="l02072"></a>02072         case_node-&gt;name = <a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>(case_node, instance_name_prefix);
<a name="l02073"></a>02073 
<a name="l02074"></a>02074         <span class="comment">/* pull out the identifier to match to &quot;i.e. case(a_in)&quot; - this is the pins we match against */</span>
<a name="l02075"></a>02075         case_match_input = case_ast-&gt;children[0];
<a name="l02076"></a>02076 
<a name="l02077"></a>02077         <span class="comment">/* point to the case list */</span>
<a name="l02078"></a>02078         case_list_of_items = case_ast-&gt;children[1];
<a name="l02079"></a>02079         
<a name="l02080"></a>02080         <span class="comment">/* create all the control structures for the case mux ... each bit will turn on one of the paths ... one hot mux */</span>
<a name="l02081"></a>02081         <a class="code" href="netlist__create__from__ast_8c.html#ab1558ae0691b648274e178f2014f5e50">create_case_control_signals</a>(case_list_of_items, case_match_input, case_node, instance_name_prefix);
<a name="l02082"></a>02082 
<a name="l02083"></a>02083         <span class="comment">/* create the statements and integrate them into the mux */</span>
<a name="l02084"></a>02084         return_list = <a class="code" href="netlist__create__from__ast_8c.html#a9a453e1a119809870431595d6a9b9458">create_case_mux_statements</a>(case_list_of_items, case_node, instance_name_prefix);
<a name="l02085"></a>02085 
<a name="l02086"></a>02086         <span class="keywordflow">return</span> return_list;
<a name="l02087"></a>02087 }
<a name="l02088"></a>02088 
<a name="l02089"></a>02089 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02090"></a>02090 <span class="comment"> * (function:  create_case_control_signals)</span>
<a name="l02091"></a>02091 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02092"></a><a class="code" href="netlist__create__from__ast_8c.html#ab1558ae0691b648274e178f2014f5e50">02092</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ab1558ae0691b648274e178f2014f5e50">create_case_control_signals</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_list_of_items, <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *compare_against, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02093"></a>02093 {
<a name="l02094"></a>02094         <span class="keywordtype">int</span> i;
<a name="l02095"></a>02095         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *other_expressions_pin_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l02096"></a>02096 
<a name="l02097"></a>02097         <span class="comment">/* reserve the first X pins of the mux for the control signals where X is the number of items */</span>
<a name="l02098"></a>02098         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(case_node, case_list_of_items-&gt;num_children);
<a name="l02099"></a>02099         <span class="comment">/* record this port size */</span>
<a name="l02100"></a>02100         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(case_node, case_list_of_items-&gt;num_children);
<a name="l02101"></a>02101         
<a name="l02102"></a>02102         <span class="comment">/* now go through each of the case items and build the comparison expressions */</span>
<a name="l02103"></a>02103         <span class="keywordflow">for</span> (i = 0; i &lt; case_list_of_items-&gt;num_children; i++)
<a name="l02104"></a>02104         {
<a name="l02105"></a>02105                 <span class="keywordflow">if</span> (case_list_of_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a19bc48795a3546b6e2f1864ab1acdbec">CASE_ITEM</a>)
<a name="l02106"></a>02106                 {
<a name="l02107"></a>02107                         <span class="comment">/* IF - this is a normal case item, then process the case match and the details of the statement */</span>
<a name="l02108"></a>02108                         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *case_compare_expression;
<a name="l02109"></a>02109                         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **case_compares = (<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>*)*2);
<a name="l02110"></a>02110                         <a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *logical_equal = <a class="code" href="ast__util_8c.html#a6cf1575a4bef1f0b247b224b74561fa1">create_node_w_type</a>(<a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a0631032a7f253d2e76abfda7ef5a424c">BINARY_OPERATION</a>, -1, -1);
<a name="l02111"></a>02111                         logical_equal-&gt;types.operation.op = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42abcec1f158bbc5af07e897785dcd8ce26">LOGICAL_EQUAL</a>;
<a name="l02112"></a>02112 
<a name="l02113"></a>02113                         <span class="comment">/* get the signals to compare against */</span>
<a name="l02114"></a>02114                         case_compares[0] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(compare_against, instance_name_prefix);
<a name="l02115"></a>02115                         case_compares[1] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(case_list_of_items-&gt;children[i]-&gt;children[0], instance_name_prefix);
<a name="l02116"></a>02116 
<a name="l02117"></a>02117                         <span class="comment">/* make a LOGIC_EQUAL gate that collects all the other signals and if they&#39;re all off */</span>
<a name="l02118"></a>02118                         case_compare_expression = <a class="code" href="netlist__create__from__ast_8c.html#af4f54479ebda51cc195343d8388d1fd2">create_operation_node</a>(logical_equal, case_compares, 2, instance_name_prefix);
<a name="l02119"></a>02119                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(case_compare_expression-&gt;signal_list_size == 1);
<a name="l02120"></a>02120 
<a name="l02121"></a>02121                         <span class="comment">/* hookup this pin to the spot in the case_node */</span>
<a name="l02122"></a>02122                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(case_node, case_compare_expression-&gt;signal_list[0], i);
<a name="l02123"></a>02123 
<a name="l02124"></a>02124                         <span class="comment">/* copy that output pin to be put into the default */</span>
<a name="l02125"></a>02125                         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(other_expressions_pin_list, <a class="code" href="netlist__utils_8c.html#a1929749a89bf66c63231506654cc0ef7">copy_input_npin</a>(case_compare_expression-&gt;signal_list[0]));
<a name="l02126"></a>02126                         
<a name="l02127"></a>02127                         <span class="comment">/* clean up */</span>
<a name="l02128"></a>02128                         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(case_compare_expression);
<a name="l02129"></a>02129 
<a name="l02130"></a>02130                         free(case_compares);
<a name="l02131"></a>02131                 }
<a name="l02132"></a>02132                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (case_list_of_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9acd9116ab6ac7bbbc59755801d6261e43">CASE_DEFAULT</a>)
<a name="l02133"></a>02133                 {
<a name="l02134"></a>02134                         <span class="comment">/* take all the other pins from the case expressions and intstall in the condition */</span>
<a name="l02135"></a>02135                         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *default_node;
<a name="l02136"></a>02136                         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *default_expression;
<a name="l02137"></a>02137 
<a name="l02138"></a>02138                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(i == case_list_of_items-&gt;num_children - 1); <span class="comment">// has to be at the end</span>
<a name="l02139"></a>02139 
<a name="l02140"></a>02140                         <span class="comment">/* make a NOR gate that collects all the other signals and if they&#39;re all off */</span>
<a name="l02141"></a>02141                         default_node = <a class="code" href="node__creation__library_8c.html#aa2d78b9fff05e96d3af41c481e86ddf6">make_1port_logic_gate_with_inputs</a>(<a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a230828427895e0069436c3cfb10dd54f">LOGICAL_NOR</a>, case_list_of_items-&gt;num_children-1, other_expressions_pin_list, case_node, -1);
<a name="l02142"></a>02142                         default_expression = <a class="code" href="netlist__utils_8c.html#a27635e3f152a9a1269740bbdd54c76b1">make_output_pins_for_existing_node</a>(default_node, 1);
<a name="l02143"></a>02143                         
<a name="l02144"></a>02144                         <span class="comment">/* copy that output pin to be put into the default */</span>
<a name="l02145"></a>02145                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(case_node, default_expression-&gt;signal_list[0], i);
<a name="l02146"></a>02146                 }
<a name="l02147"></a>02147                 <span class="keywordflow">else</span>
<a name="l02148"></a>02148                 {
<a name="l02149"></a>02149                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02150"></a>02150                 }
<a name="l02151"></a>02151         }
<a name="l02152"></a>02152 }
<a name="l02153"></a>02153 
<a name="l02154"></a>02154 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02155"></a>02155 <span class="comment"> * (function:  create_case_mux_statements)</span>
<a name="l02156"></a>02156 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02157"></a><a class="code" href="netlist__create__from__ast_8c.html#a9a453e1a119809870431595d6a9b9458">02157</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#a9a453e1a119809870431595d6a9b9458">create_case_mux_statements</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *case_list_of_items, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *case_node, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02158"></a>02158 {
<a name="l02159"></a>02159         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **case_statement;
<a name="l02160"></a>02160         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list;
<a name="l02161"></a>02161         <span class="keywordtype">int</span> i;
<a name="l02162"></a>02162 
<a name="l02163"></a>02163         <span class="comment">/* make storage for statements and expressions */</span>
<a name="l02164"></a>02164         case_statement = (<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a>*)*(case_list_of_items-&gt;num_children));
<a name="l02165"></a>02165 
<a name="l02166"></a>02166         <span class="comment">/* now we will process the statements and add to the other ports */</span>
<a name="l02167"></a>02167         <span class="keywordflow">for</span> (i = 0; i &lt; case_list_of_items-&gt;num_children; i++)
<a name="l02168"></a>02168         {
<a name="l02169"></a>02169                 <span class="keywordflow">if</span> (case_list_of_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9a19bc48795a3546b6e2f1864ab1acdbec">CASE_ITEM</a>)
<a name="l02170"></a>02170                 {
<a name="l02171"></a>02171                         <span class="comment">/* IF - this is a normal case item, then process the case match and the details of the statement */</span>
<a name="l02172"></a>02172                         case_statement[i] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(case_list_of_items-&gt;children[i]-&gt;children[1], instance_name_prefix);
<a name="l02173"></a>02173                         <a class="code" href="netlist__utils_8c.html#a6879eb04ce54ca34d57920c36d0b0f89">sort_signal_list_alphabetically</a>(case_statement[i]);
<a name="l02174"></a>02174                 }
<a name="l02175"></a>02175                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (case_list_of_items-&gt;children[i]-&gt;type == <a class="code" href="types_8h.html#a0a9b879f29cc1e1e03ffc7851f7c19b9acd9116ab6ac7bbbc59755801d6261e43">CASE_DEFAULT</a>)
<a name="l02176"></a>02176                 {
<a name="l02177"></a>02177                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(i == case_list_of_items-&gt;num_children - 1); <span class="comment">// has to be at the end</span>
<a name="l02178"></a>02178                         case_statement[i] = <a class="code" href="netlist__create__from__ast_8c.html#a56659a04b36ba8a173545b9df86a21f2">netlist_expand_ast_of_module</a>(case_list_of_items-&gt;children[i]-&gt;children[0], instance_name_prefix);
<a name="l02179"></a>02179                         <a class="code" href="netlist__utils_8c.html#a6879eb04ce54ca34d57920c36d0b0f89">sort_signal_list_alphabetically</a>(case_statement[i]);
<a name="l02180"></a>02180                 }
<a name="l02181"></a>02181                 <span class="keywordflow">else</span>
<a name="l02182"></a>02182                 {
<a name="l02183"></a>02183                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02184"></a>02184                 }
<a name="l02185"></a>02185         }
<a name="l02186"></a>02186         
<a name="l02187"></a>02187         <span class="comment">/* now with all the lists sorted, we do the matching and proper propogation */</span>  
<a name="l02188"></a>02188         return_list = <a class="code" href="netlist__create__from__ast_8c.html#abb64aec8e8618459b3d1d70622456d6d">create_mux_statements</a>(case_statement, case_node, case_list_of_items-&gt;num_children, instance_name_prefix);
<a name="l02189"></a>02189 
<a name="l02190"></a>02190         <span class="keywordflow">return</span> return_list;
<a name="l02191"></a>02191 }
<a name="l02192"></a>02192 
<a name="l02193"></a>02193 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02194"></a>02194 <span class="comment"> * (function:  create_mux_statements)</span>
<a name="l02195"></a>02195 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02196"></a><a class="code" href="netlist__create__from__ast_8c.html#abb64aec8e8618459b3d1d70622456d6d">02196</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#abb64aec8e8618459b3d1d70622456d6d">create_mux_statements</a>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **statement_lists, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *mux_node, <span class="keywordtype">int</span> num_statement_lists, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02197"></a>02197 {
<a name="l02198"></a>02198         <span class="keywordtype">int</span> i, j;
<a name="l02199"></a>02199         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *combined_lists;
<a name="l02200"></a>02200         <span class="keywordtype">int</span> *per_case_statement_idx;
<a name="l02201"></a>02201         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l02202"></a>02202         <span class="keywordtype">int</span> in_index = 1;
<a name="l02203"></a>02203         <span class="keywordtype">int</span> out_index = 0;
<a name="l02204"></a>02204 
<a name="l02205"></a>02205         <span class="comment">/* allocate and initialize indexes */</span>
<a name="l02206"></a>02206         per_case_statement_idx = (<span class="keywordtype">int</span>*)calloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>), num_statement_lists);
<a name="l02207"></a>02207 
<a name="l02208"></a>02208         <span class="comment">/* make the uber list and sort it */</span>
<a name="l02209"></a>02209         combined_lists = <a class="code" href="netlist__utils_8c.html#ab882f2d7323e9c427edf28f9bb6930fb">combine_lists_without_freeing_originals</a>(statement_lists, num_statement_lists);
<a name="l02210"></a>02210         <a class="code" href="netlist__utils_8c.html#a6879eb04ce54ca34d57920c36d0b0f89">sort_signal_list_alphabetically</a>(combined_lists);
<a name="l02211"></a>02211 
<a name="l02212"></a>02212         <span class="keywordflow">for</span> (i = 0; i &lt; combined_lists-&gt;signal_list_size; i++)
<a name="l02213"></a>02213         {
<a name="l02214"></a>02214                 <span class="keywordtype">int</span> i_skip = 0; <span class="comment">// iskip is the number of statemnts that do have this signal so we can skip in the combine list</span>
<a name="l02215"></a>02215                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin1;
<a name="l02216"></a>02216                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin2;
<a name="l02217"></a>02217                 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l02218"></a>02218                 new_pin1 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l02219"></a>02219                 new_pin2 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l02220"></a>02220                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l02221"></a>02221 
<a name="l02222"></a>02222                 <span class="comment">/* allocate a port the width of all the signals ... one MUX */</span>
<a name="l02223"></a>02223                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(mux_node, num_statement_lists);
<a name="l02224"></a>02224                 <span class="comment">/* record the port size */</span>
<a name="l02225"></a>02225                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(mux_node, num_statement_lists);
<a name="l02226"></a>02226 
<a name="l02227"></a>02227                 <span class="comment">/* allocate the pins for the ouput port and pass out that pin for higher statements */</span>
<a name="l02228"></a>02228                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(mux_node, 1);
<a name="l02229"></a>02229                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(mux_node, new_pin1, out_index);
<a name="l02230"></a>02230                 <span class="comment">/* hook up new pin 1 into the new net */</span>
<a name="l02231"></a>02231                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, new_pin1);
<a name="l02232"></a>02232                 <span class="comment">/* hook up the new pin 2 to this new net */</span>
<a name="l02233"></a>02233                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(new_net, new_pin2);
<a name="l02234"></a>02234                 <span class="comment">/* name it with this name */</span>
<a name="l02235"></a>02235                 new_pin2-&gt;name = combined_lists-&gt;signal_list[i]-&gt;name;
<a name="l02236"></a>02236                 <span class="comment">/* add this pin to the return list */</span>
<a name="l02237"></a>02237                 <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_list, new_pin2);
<a name="l02238"></a>02238 
<a name="l02239"></a>02239                 <span class="comment">/* going through each of the statement lists looking for common ones and building implied ones if they&#39;re not there */</span>
<a name="l02240"></a>02240                 <span class="keywordflow">for</span> (j = 0; j &lt; num_statement_lists; j++)
<a name="l02241"></a>02241                 {
<a name="l02242"></a>02242                         <span class="comment">/* check if the current element for this case statement is defined */</span>   
<a name="l02243"></a>02243                         <span class="keywordflow">if</span> ((per_case_statement_idx[j] &lt; statement_lists[j]-&gt;signal_list_size) &amp;&amp; (strcmp(combined_lists-&gt;signal_list[i]-&gt;name, statement_lists[j]-&gt;signal_list[per_case_statement_idx[j]]-&gt;name) == 0))
<a name="l02244"></a>02244                         {
<a name="l02245"></a>02245                                 <span class="comment">/* If they match then we have a signal with this name and we can attach the pin */</span> 
<a name="l02246"></a>02246                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(mux_node, statement_lists[j]-&gt;signal_list[per_case_statement_idx[j]], in_index*num_statement_lists+j);
<a name="l02247"></a>02247 
<a name="l02248"></a>02248                                 per_case_statement_idx[j]++; <span class="comment">// increment the local index</span>
<a name="l02249"></a>02249                                 i_skip ++; <span class="comment">// it&#39;s a match so the combo list will have atleast +1 entries the same</span>
<a name="l02250"></a>02250                         }
<a name="l02251"></a>02251                         <span class="keywordflow">else</span>
<a name="l02252"></a>02252                         {
<a name="l02253"></a>02253                                 <span class="comment">/* Don&#39;t match, so this signal is an IMPLIED SIGNAL !!! */</span>
<a name="l02254"></a>02254                                 
<a name="l02255"></a>02255                                 <span class="comment">/* implied signal for mux */</span>
<a name="l02256"></a>02256                                 <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a871003692e07d5ee51a52434fa2d495a">SEQUENTIAL</a>)
<a name="l02257"></a>02257                                 {
<a name="l02258"></a>02258                                         <span class="comment">/* lookup this driver name */</span>
<a name="l02259"></a>02259                                         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *this_pin_list = <a class="code" href="netlist__create__from__ast_8c.html#a81665c279a2a1e733a48a29b6d16ecf9">create_pins</a>(NULL, combined_lists-&gt;signal_list[i]-&gt;name, instance_name_prefix);
<a name="l02260"></a>02260                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(this_pin_list-&gt;signal_list_size == 1);
<a name="l02261"></a>02261                                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(mux_node, this_pin_list-&gt;signal_list[0], in_index*num_statement_lists+j);
<a name="l02262"></a>02262 
<a name="l02263"></a>02263                                         <span class="comment">/* clean up */</span>
<a name="l02264"></a>02264                                         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(this_pin_list);
<a name="l02265"></a>02265                                 }
<a name="l02266"></a>02266                                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="netlist__create__from__ast_8c.html#a5e74a15516ea2d787629a1b7b78daf1a">type_of_circuit</a> == <a class="code" href="netlist__create__from__ast_8c.html#a48d78b9ade9bfe7475e6560c6e5c1d90">COMBINATIONAL</a>)
<a name="l02267"></a>02267                                 {
<a name="l02268"></a>02268                                         <span class="comment">/* DON&#39;T CARE - so hookup zero */</span>
<a name="l02269"></a>02269                                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(mux_node, <a class="code" href="netlist__utils_8h.html#a9e98d5a83bf869a56b12248621d7b6dc">get_a_zero_pin</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>), in_index*num_statement_lists+j);
<a name="l02270"></a>02270                                 }
<a name="l02271"></a>02271                                 <span class="keywordflow">else</span>
<a name="l02272"></a>02272                                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(<a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>);
<a name="l02273"></a>02273                         }
<a name="l02274"></a>02274                 }
<a name="l02275"></a>02275 
<a name="l02276"></a>02276                 i += i_skip - 1; <span class="comment">// for every match move index i forward except this one wihich is handled by for i++ </span>
<a name="l02277"></a>02277                 in_index++;
<a name="l02278"></a>02278                 out_index++;
<a name="l02279"></a>02279         }
<a name="l02280"></a>02280 
<a name="l02281"></a>02281         <span class="comment">/* clean up */</span>
<a name="l02282"></a>02282         <span class="keywordflow">for</span> (i = 0; i &lt; num_statement_lists; i++)
<a name="l02283"></a>02283         {
<a name="l02284"></a>02284                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(statement_lists[i]);
<a name="l02285"></a>02285         }
<a name="l02286"></a>02286         <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(combined_lists);
<a name="l02287"></a>02287 
<a name="l02288"></a>02288         <span class="keywordflow">return</span> return_list;
<a name="l02289"></a>02289 }
<a name="l02290"></a>02290 
<a name="l02291"></a>02291 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02292"></a>02292 <span class="comment"> * (function:  create_mux_expressions)</span>
<a name="l02293"></a>02293 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02294"></a><a class="code" href="netlist__create__from__ast_8c.html#ae59a3a263c57c921d3347110d86c471f">02294</a> <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *<a class="code" href="netlist__create__from__ast_8c.html#ae59a3a263c57c921d3347110d86c471f">create_mux_expressions</a>(<a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **expression_lists, <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *mux_node, <span class="keywordtype">int</span> num_expression_lists, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02295"></a>02295 {
<a name="l02296"></a>02296         <span class="keywordtype">int</span> i, j;
<a name="l02297"></a>02297         <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *return_list = <a class="code" href="netlist__utils_8c.html#a3075c100eb391391615c04dac90233f9">init_signal_list_structure</a>();
<a name="l02298"></a>02298         <span class="keywordtype">int</span> max_index = -1;
<a name="l02299"></a>02299 
<a name="l02300"></a>02300         <span class="comment">/* find the biggest element */</span>
<a name="l02301"></a>02301         <span class="keywordflow">for</span> (i = 0; i &lt; num_expression_lists; i++)
<a name="l02302"></a>02302         {
<a name="l02303"></a>02303                 <span class="keywordflow">if</span> (max_index &lt; expression_lists[i]-&gt;signal_list_size)
<a name="l02304"></a>02304                 {
<a name="l02305"></a>02305                         max_index = expression_lists[i]-&gt;signal_list_size;
<a name="l02306"></a>02306                 }
<a name="l02307"></a>02307         }
<a name="l02308"></a>02308 
<a name="l02309"></a>02309         <span class="keywordflow">for</span> (i = 0; i &lt; max_index; i++)
<a name="l02310"></a>02310         {
<a name="l02311"></a>02311                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin1;
<a name="l02312"></a>02312                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin2;
<a name="l02313"></a>02313                 <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l02314"></a>02314                 new_pin1 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l02315"></a>02315                 new_pin2 = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l02316"></a>02316                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l02317"></a>02317 
<a name="l02318"></a>02318                 <span class="comment">/* allocate a port the width of all the signals ... one MUX */</span>
<a name="l02319"></a>02319                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(mux_node, num_expression_lists);
<a name="l02320"></a>02320                 <span class="comment">/* record the port information */</span>
<a name="l02321"></a>02321                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(mux_node, num_expression_lists);
<a name="l02322"></a>02322 
<a name="l02323"></a>02323                 <span class="comment">/* allocate the pins for the ouput port and pass out that pin for higher statements */</span>
<a name="l02324"></a>02324                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(mux_node, 1);
<a name="l02325"></a>02325                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(mux_node, new_pin1, i);
<a name="l02326"></a>02326                 <span class="comment">/* hook up new pin 1 into the new net */</span>
<a name="l02327"></a>02327                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, new_pin1);
<a name="l02328"></a>02328                 <span class="comment">/* hook up the new pin 2 to this new net */</span>
<a name="l02329"></a>02329                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(new_net, new_pin2);
<a name="l02330"></a>02330                 <span class="comment">/* name it with this name */</span>
<a name="l02331"></a>02331                 new_pin2-&gt;name = NULL; 
<a name="l02332"></a>02332                 <span class="comment">/* add this pin to the return list */</span>
<a name="l02333"></a>02333                 <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(return_list, new_pin2);
<a name="l02334"></a>02334 
<a name="l02335"></a>02335                 <span class="comment">/* going through each of the statement lists looking for common ones and building implied ones if they&#39;re not there */</span>
<a name="l02336"></a>02336                 <span class="keywordflow">for</span> (j = 0; j &lt; num_expression_lists; j++)
<a name="l02337"></a>02337                 {
<a name="l02338"></a>02338                         <span class="comment">/* check if the current element for this case statement is defined */</span>   
<a name="l02339"></a>02339                         <span class="keywordflow">if</span> (i &lt; expression_lists[j]-&gt;signal_list_size)
<a name="l02340"></a>02340                         {
<a name="l02341"></a>02341                                 <span class="comment">/* If there is a signal */</span>
<a name="l02342"></a>02342                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(mux_node, expression_lists[j]-&gt;signal_list[i], (i+1)*num_expression_lists+j);
<a name="l02343"></a>02343 
<a name="l02344"></a>02344                         }
<a name="l02345"></a>02345                         <span class="keywordflow">else</span>
<a name="l02346"></a>02346                         {
<a name="l02347"></a>02347                                 <span class="comment">/* Don&#39;t match, so this signal is an IMPLIED SIGNAL !!! */</span>
<a name="l02348"></a>02348                                 
<a name="l02349"></a>02349                                 <span class="comment">/* implied signal for mux */</span>
<a name="l02350"></a>02350                                 <span class="comment">/* DON&#39;T CARE - so hookup zero */</span>
<a name="l02351"></a>02351                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(mux_node, <a class="code" href="netlist__utils_8h.html#a9e98d5a83bf869a56b12248621d7b6dc">get_a_zero_pin</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>), (i+1)*num_expression_lists+j);
<a name="l02352"></a>02352                         }
<a name="l02353"></a>02353                 }
<a name="l02354"></a>02354         }
<a name="l02355"></a>02355 
<a name="l02356"></a>02356         <span class="comment">/* clean up */</span>
<a name="l02357"></a>02357         <span class="keywordflow">for</span> (i = 0; i &lt; num_expression_lists; i++)
<a name="l02358"></a>02358         {
<a name="l02359"></a>02359                 <a class="code" href="netlist__utils_8c.html#a2b49811e2f7051c6bdde0ac7e7bfd54f">clean_signal_list_structure</a>(expression_lists[i]);
<a name="l02360"></a>02360         }
<a name="l02361"></a>02361 
<a name="l02362"></a>02362         <span class="keywordflow">return</span> return_list;
<a name="l02363"></a>02363 }
<a name="l02364"></a>02364 
<a name="l02365"></a>02365 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02366"></a>02366 <span class="comment"> * (function:  pad_compares_to_smallest_non_numerical_implementation)</span>
<a name="l02367"></a>02367 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02368"></a><a class="code" href="netlist__create__from__ast_8c.html#a996aae68a2788a53e347e7c9ecd4354b">02368</a> <span class="keywordtype">int</span> <a class="code" href="netlist__create__from__ast_8c.html#a996aae68a2788a53e347e7c9ecd4354b">find_smallest_non_numerical</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a> *node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> **input_list, <span class="keywordtype">int</span> num_input_lists)
<a name="l02369"></a>02369 {
<a name="l02370"></a>02370         <span class="keywordtype">int</span> i;
<a name="l02371"></a>02371         <span class="keywordtype">int</span> smallest = input_list[0]-&gt;signal_list_size;
<a name="l02372"></a>02372         <span class="keywordtype">int</span> smallest_idx;
<a name="l02373"></a>02373         <span class="keywordtype">short</span> *tested = (<span class="keywordtype">short</span>*)calloc(<span class="keyword">sizeof</span>(<span class="keywordtype">short</span>), num_input_lists);
<a name="l02374"></a>02374         <span class="keywordtype">short</span> found_non_numerical = <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02375"></a>02375         
<a name="l02376"></a>02376         <span class="keywordflow">while</span>(found_non_numerical == <a class="code" href="types_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)
<a name="l02377"></a>02377         {
<a name="l02378"></a>02378                 smallest_idx = -1;
<a name="l02379"></a>02379 
<a name="l02380"></a>02380                 <span class="comment">/* find the smallest width, now verify that it&#39;s not a number */</span>
<a name="l02381"></a>02381                 <span class="keywordflow">for</span> (i = 0; i &lt; num_input_lists; i++)
<a name="l02382"></a>02382                 {
<a name="l02383"></a>02383                         <span class="keywordflow">if</span> (tested[i] == 1)
<a name="l02384"></a>02384                         {
<a name="l02385"></a>02385                                 <span class="comment">/* skip the ones we&#39;ve already tried */</span>
<a name="l02386"></a>02386                                 <span class="keywordflow">continue</span>;
<a name="l02387"></a>02387                         }
<a name="l02388"></a>02388                         <span class="keywordflow">if</span> (smallest &gt;= input_list[i]-&gt;signal_list_size)
<a name="l02389"></a>02389                         {
<a name="l02390"></a>02390                                 smallest = input_list[0]-&gt;signal_list_size;
<a name="l02391"></a>02391                                 smallest_idx = i;
<a name="l02392"></a>02392                         }
<a name="l02393"></a>02393                 }       
<a name="l02394"></a>02394 
<a name="l02395"></a>02395                 <span class="keywordflow">if</span> (smallest_idx == -1)
<a name="l02396"></a>02396                 {
<a name="l02397"></a>02397                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;all numbers in padding non numericals\n&quot;</span>);
<a name="l02398"></a>02398                 }
<a name="l02399"></a>02399                 <span class="keywordflow">else</span>
<a name="l02400"></a>02400                 {
<a name="l02401"></a>02401                         <span class="comment">/* mark that we&#39;re evaluating this input */</span>
<a name="l02402"></a>02402                         tested[smallest_idx] = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02403"></a>02403 
<a name="l02404"></a>02404                         <span class="comment">/* check if the smallest is not a number */</span>
<a name="l02405"></a>02405                         <span class="keywordflow">for</span> (i = 0; i &lt; input_list[smallest_idx]-&gt;signal_list_size; i++)
<a name="l02406"></a>02406                         {
<a name="l02407"></a>02407                                 <span class="keywordflow">if</span> (input_list[smallest_idx]-&gt;signal_list[i]-&gt;name == NULL)
<a name="l02408"></a>02408                                 {
<a name="l02409"></a>02409                                         <span class="comment">/* Not a number so this is the smallest */</span>
<a name="l02410"></a>02410                                         found_non_numerical = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02411"></a>02411                                         <span class="keywordflow">break</span>;
<a name="l02412"></a>02412                                 }
<a name="l02413"></a>02413                                 <span class="keywordflow">if</span> (!((strstr(input_list[smallest_idx]-&gt;signal_list[i]-&gt;name, <span class="stringliteral">&quot;ONE_VCC_CNS&quot;</span>) != NULL) || strstr(input_list[smallest_idx]-&gt;signal_list[i]-&gt;name, <span class="stringliteral">&quot;ZERO_GND_ZERO&quot;</span>) != NULL))
<a name="l02414"></a>02414                                 {
<a name="l02415"></a>02415                                         <span class="comment">/* Not a number so this is the smallest */</span>
<a name="l02416"></a>02416                                         found_non_numerical = <a class="code" href="types_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02417"></a>02417                                         <span class="keywordflow">break</span>;
<a name="l02418"></a>02418                                 }
<a name="l02419"></a>02419                         }
<a name="l02420"></a>02420                 }
<a name="l02421"></a>02421         }
<a name="l02422"></a>02422 
<a name="l02423"></a>02423         <span class="keywordflow">return</span> smallest_idx;
<a name="l02424"></a>02424 }
<a name="l02425"></a>02425 
<a name="l02426"></a>02426 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l02427"></a>02427 <span class="comment"> * (function: pad_with_zeros)</span>
<a name="l02428"></a>02428 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l02429"></a><a class="code" href="netlist__create__from__ast_8c.html#ac822ec3df17d36632c012c312939bfb4">02429</a> <span class="keywordtype">void</span> <a class="code" href="netlist__create__from__ast_8c.html#ac822ec3df17d36632c012c312939bfb4">pad_with_zeros</a>(<a class="code" href="types_8h.html#ad9044d32f8a05e9d297d28ffa1db5f83">ast_node_t</a>* node, <a class="code" href="types_8h.html#abaf46d21758c2ab0f18750b1202bf864">signal_list_t</a> *list, <span class="keywordtype">int</span> pad_size, <span class="keywordtype">char</span> *instance_name_prefix)
<a name="l02430"></a>02430 {
<a name="l02431"></a>02431         <span class="keywordtype">int</span> i;
<a name="l02432"></a>02432 
<a name="l02433"></a>02433         <span class="keywordflow">if</span> (pad_size &gt; list-&gt;signal_list_size)
<a name="l02434"></a>02434         {
<a name="l02435"></a>02435                 <span class="keywordflow">for</span> (i = list-&gt;signal_list_size; i &lt; pad_size; i++)
<a name="l02436"></a>02436                 {
<a name="l02437"></a>02437                         <a class="code" href="errors_8c.html#aa8fef4442b310424b732a93a68191e0e">warning_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;padding an input port with 0 for operation (likely compare)\n&quot;</span>);
<a name="l02438"></a>02438                         <a class="code" href="netlist__utils_8c.html#a8b01facbb892d6ed40c025336e3a165c">add_pin_to_signal_list</a>(list, <a class="code" href="netlist__utils_8h.html#a9e98d5a83bf869a56b12248621d7b6dc">get_a_zero_pin</a>(<a class="code" href="globals_8h.html#a22a79894e04b7c7891d95438d90623ff">verilog_netlist</a>));
<a name="l02439"></a>02439                 }
<a name="l02440"></a>02440         }
<a name="l02441"></a>02441         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pad_size &lt; list-&gt;signal_list_size) 
<a name="l02442"></a>02442         {
<a name="l02443"></a>02443                 <a class="code" href="errors_8c.html#aa8fef4442b310424b732a93a68191e0e">warning_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, node-&gt;line_number, node-&gt;file_number, <span class="stringliteral">&quot;May be a warning: appears that there are more driver pins then nets to drive.  This means that for this operation you are losing some of the most significant bits\n&quot;</span>);
<a name="l02444"></a>02444         }
<a name="l02445"></a>02445 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Mar 3 15:37:01 2010 for ODIN_II by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
