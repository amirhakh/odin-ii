<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ODIN_II: H:/RESEARCH/PROGRAMS_AND_DEVELOPMENT/ODIN_II/trunk/ODIN_II/SRC/read_netlist.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<h1>H:/RESEARCH/PROGRAMS_AND_DEVELOPMENT/ODIN_II/trunk/ODIN_II/SRC/read_netlist.c</h1><a href="read__netlist_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">Permission is hereby granted, free of charge, to any person</span>
<a name="l00003"></a>00003 <span class="comment">obtaining a copy of this software and associated documentation</span>
<a name="l00004"></a>00004 <span class="comment">files (the &quot;Software&quot;), to deal in the Software without</span>
<a name="l00005"></a>00005 <span class="comment">restriction, including without limitation the rights to use,</span>
<a name="l00006"></a>00006 <span class="comment">copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<a name="l00007"></a>00007 <span class="comment">copies of the Software, and to permit persons to whom the</span>
<a name="l00008"></a>00008 <span class="comment">Software is furnished to do so, subject to the following</span>
<a name="l00009"></a>00009 <span class="comment">conditions:</span>
<a name="l00010"></a>00010 <span class="comment"></span>
<a name="l00011"></a>00011 <span class="comment">The above copyright notice and this permission notice shall be</span>
<a name="l00012"></a>00012 <span class="comment">included in all copies or substantial portions of the Software.</span>
<a name="l00013"></a>00013 <span class="comment"></span>
<a name="l00014"></a>00014 <span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,</span>
<a name="l00015"></a>00015 <span class="comment">EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES</span>
<a name="l00016"></a>00016 <span class="comment">OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND</span>
<a name="l00017"></a>00017 <span class="comment">NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT</span>
<a name="l00018"></a>00018 <span class="comment">HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,</span>
<a name="l00019"></a>00019 <span class="comment">WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>
<a name="l00020"></a>00020 <span class="comment">FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR</span>
<a name="l00021"></a>00021 <span class="comment">OTHER DEALINGS IN THE SOFTWARE.</span>
<a name="l00022"></a>00022 <span class="comment">*/</span> 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">/* This reads a .net file from t-vpack into the OdinII format.  This code is derived from the read_netlist.c in VPR 5.0 */</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
<a name="l00027"></a>00027 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="globals_8h.html">globals.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="netlist__utils_8h.html">netlist_utils.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &quot;<a class="code" href="errors_8h.html">errors.h</a>&quot;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;read_xml_arch_file.h&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="read__netlist_8h.html">read_netlist.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;ReadLine.h&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="string__cache_8h.html">string_cache.h</a>&quot;</span>
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367">00037</a> <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367">special_blk</a> { <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a50d1448013c6f17125caee18aa418af7">NORMAL</a> = 0, <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367ac4d1b488c8245e68c89dc6c23a9a3a22">INPAD</a>, <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a53ea3283906af851c9037a42affd3ff9">OUTPAD</a> };
<a name="l00038"></a><a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87a679ee5320d66c8322e310daeb2ee99b8">00038</a> <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87">pass</a> { <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87a8cfa4abaed06c3313cb0a64f8996531b">DRIVERS</a> = 0, <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87af94c9effcae4576877f0d41ce4eab253">DRIVEN</a>, <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87a679ee5320d66c8322e310daeb2ee99b8">STOP</a> };
<a name="l00039"></a>00039 
<a name="l00040"></a>00040 <span class="keyword">static</span> FILE *net_file;
<a name="l00041"></a><a class="code" href="read__netlist_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">00041</a> <span class="keywordtype">int</span> <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>;
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="read__netlist_8c.html#ae9600655959b484b3f5d272b931910ee">00043</a> <span class="keywordtype">char</span> *<a class="code" href="read__netlist_8c.html#ae9600655959b484b3f5d272b931910ee">netlist_one_string</a> = <span class="stringliteral">&quot;ONE_VCC_CNS&quot;</span>;
<a name="l00044"></a><a class="code" href="read__netlist_8c.html#af8fdb6cf06ab56396d203ca6ec90dfcd">00044</a> <span class="keywordtype">char</span> *<a class="code" href="read__netlist_8c.html#af8fdb6cf06ab56396d203ca6ec90dfcd">netlist_zero_string</a> = <span class="stringliteral">&quot;ZERO_GND_ZERO&quot;</span>;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> * <a class="code" href="read__netlist_8c.html#aa415c7f9892c5bd32f4bb2d7fdee46f7">add_block</a> (<span class="keywordtype">char</span> *<a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>, <span class="keywordtype">char</span> **pin_tokens, t_type_ptr type, <span class="keywordtype">short</span> <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87">pass</a>, <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist);
<a name="l00047"></a>00047 <span class="keyword">static</span> <span class="keywordtype">void</span> add_io_node_and_driver ( <span class="keywordtype">short</span> io_type, <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist, <span class="keywordtype">char</span> *io_pin_name);
<a name="l00048"></a>00048 <span class="keywordtype">void</span> <a class="code" href="read__netlist_8c.html#a464d4918145bc6dfaa11862e3e874846">add_subblock_to_node</a>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *current_block, <span class="keywordtype">char</span> ***token_list, <span class="keywordtype">int</span> num_subblocks, t_type_ptr type);
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="keywordtype">void</span> <a class="code" href="read__netlist_8c.html#a544063fbc3a0588386768c094e840f99">FreeTokens</a> ( <span class="keywordtype">char</span> ***TokensPtr);
<a name="l00051"></a>00051 <span class="keywordtype">int</span> <a class="code" href="read__netlist_8c.html#a01dcb7c508d153e5e39904c1e0734b16">CountTokens</a> ( <span class="keywordtype">char</span> **Tokens);
<a name="l00052"></a>00052 <span class="keywordtype">char</span> ** <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> ( FILE * InFile, <span class="keywordtype">int</span> *LineNum);
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="keyword">static</span> t_type_ptr get_type_by_name (
<a name="l00055"></a>00055     <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00056"></a>00056     <span class="keywordtype">int</span> ntypes,
<a name="l00057"></a>00057     <span class="keyword">const</span> <span class="keyword">struct</span> s_type_descriptor block_types[],
<a name="l00058"></a>00058     t_type_ptr IO_type,
<a name="l00059"></a>00059     <span class="keyword">const</span> <span class="keywordtype">char</span> *net_filename,
<a name="l00060"></a>00060     <span class="keywordtype">int</span> line,
<a name="l00061"></a>00061     <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367">special_blk</a> *overide);
<a name="l00062"></a>00062 
<a name="l00063"></a>00063 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00064"></a>00064 <span class="comment"> * (function: read_netlist)</span>
<a name="l00065"></a>00065 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00066"></a>00066 <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *
<a name="l00067"></a><a class="code" href="read__netlist_8h.html#a14916c8a23e0393301cabf7406e29307">00067</a> <a class="code" href="read__netlist_8c.html#a14916c8a23e0393301cabf7406e29307">read_netlist</a> (
<a name="l00068"></a>00068     <span class="keyword">const</span> <span class="keywordtype">char</span> *net_filename,
<a name="l00069"></a>00069     <span class="keywordtype">int</span> ntypes,
<a name="l00070"></a>00070     <span class="keyword">const</span> <span class="keyword">struct</span> s_type_descriptor block_types[],
<a name="l00071"></a>00071     t_type_ptr IO_type)
<a name="l00072"></a>00072 {
<a name="l00073"></a>00073         <span class="keywordtype">int</span> i;
<a name="l00074"></a>00074         <span class="keywordtype">int</span> num_blocks, subblock_count;
<a name="l00075"></a>00075         <span class="keywordtype">int</span> prev_line;
<a name="l00076"></a>00076         <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367">special_blk</a> overide;
<a name="l00077"></a>00077         <span class="keywordtype">char</span> **block_tokens;
<a name="l00078"></a>00078         <span class="keywordtype">char</span> **pin_tokens;
<a name="l00079"></a>00079         <span class="keywordtype">char</span> **tokens;
<a name="l00080"></a>00080         t_type_ptr type = NULL;
<a name="l00081"></a>00081         <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist = <a class="code" href="netlist__utils_8c.html#a88eb12f8127d1a2ec1c77da5c1b1415d">allocate_netlist</a>();
<a name="l00082"></a>00082         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *new_pin;
<a name="l00083"></a>00083         <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87">pass</a> <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87">pass</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086         <span class="comment">/* create the constant nets */</span>
<a name="l00087"></a>00087         <span class="comment">/* ZERO */</span>
<a name="l00088"></a>00088         netlist-&gt;zero_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00089"></a>00089         netlist-&gt;gnd_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00090"></a>00090         netlist-&gt;gnd_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a0abe352aa2acd31975f0f7416b282e9d">GND_NODE</a>;
<a name="l00091"></a>00091         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(netlist-&gt;gnd_node, 1);
<a name="l00092"></a>00092         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(netlist-&gt;gnd_node, 1);
<a name="l00093"></a>00093         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00094"></a>00094         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(netlist-&gt;gnd_node, new_pin, 0);
<a name="l00095"></a>00095         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(netlist-&gt;zero_net, new_pin);
<a name="l00096"></a>00096         netlist-&gt;gnd_node-&gt;name = <a class="code" href="read__netlist_8c.html#af8fdb6cf06ab56396d203ca6ec90dfcd">netlist_zero_string</a>;
<a name="l00097"></a>00097         netlist-&gt;zero_net-&gt;name = <a class="code" href="read__netlist_8c.html#af8fdb6cf06ab56396d203ca6ec90dfcd">netlist_zero_string</a>;
<a name="l00098"></a>00098         <span class="comment">/* ONE */</span>
<a name="l00099"></a>00099         netlist-&gt;one_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00100"></a>00100         netlist-&gt;vcc_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00101"></a>00101         netlist-&gt;vcc_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42ae11d61bb47dc94e76efe974f9e2dfa26">VCC_NODE</a>;
<a name="l00102"></a>00102         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(netlist-&gt;vcc_node, 1);
<a name="l00103"></a>00103         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(netlist-&gt;vcc_node, 1);
<a name="l00104"></a>00104         new_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00105"></a>00105         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(netlist-&gt;vcc_node, new_pin, 0);
<a name="l00106"></a>00106         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(netlist-&gt;one_net, new_pin);
<a name="l00107"></a>00107         netlist-&gt;vcc_node-&gt;name = <a class="code" href="read__netlist_8c.html#ae9600655959b484b3f5d272b931910ee">netlist_one_string</a>;
<a name="l00108"></a>00108         netlist-&gt;one_net-&gt;name = <a class="code" href="read__netlist_8c.html#ae9600655959b484b3f5d272b931910ee">netlist_one_string</a>;
<a name="l00109"></a>00109 
<a name="l00110"></a>00110         <span class="comment">/* open the file to parse */</span>
<a name="l00111"></a>00111         net_file = fopen (net_filename, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00112"></a>00112 
<a name="l00113"></a>00113         <span class="keywordflow">for</span> (pass = 0; pass &lt; <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87a679ee5320d66c8322e310daeb2ee99b8">STOP</a>; ++pass)
<a name="l00114"></a>00114         {
<a name="l00115"></a>00115                 rewind (net_file);
<a name="l00116"></a>00116                 <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a> = 0;
<a name="l00117"></a>00117                 num_blocks = 0;
<a name="l00118"></a>00118                 overide = <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a50d1448013c6f17125caee18aa418af7">NORMAL</a>;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                 <span class="comment">/* Read file line by line */</span>
<a name="l00121"></a>00121                 block_tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00122"></a>00122                 prev_line = <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>;
<a name="l00123"></a>00123                 <span class="keywordflow">while</span> (block_tokens)
<a name="l00124"></a>00124                 {
<a name="l00125"></a>00125                         <span class="comment">/* .global directives have special meaning - CLOCKS */</span>
<a name="l00126"></a>00126                         <span class="keywordflow">if</span> (0 == strcmp (block_tokens[0], <span class="stringliteral">&quot;.global&quot;</span>))
<a name="l00127"></a>00127                         {
<a name="l00128"></a>00128                                 <span class="keywordflow">if</span> (pass == <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87af94c9effcae4576877f0d41ce4eab253">DRIVEN</a>)
<a name="l00129"></a>00129                                 {       
<a name="l00130"></a>00130                                         <span class="comment">/* mark this in the clock list for later aquisition */</span>
<a name="l00131"></a>00131                                         <a class="code" href="netlist__utils_8c.html#a599603d43849133944510d8ce822cc21">mark_clock_node</a> (netlist, block_tokens[1]);
<a name="l00132"></a>00132                                 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134                                 <span class="comment">/* Don&#39;t do any more processing on this */</span>
<a name="l00135"></a>00135                                 <a class="code" href="read__netlist_8c.html#a544063fbc3a0588386768c094e840f99">FreeTokens</a> (&amp;block_tokens);
<a name="l00136"></a>00136                                 block_tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00137"></a>00137                                 prev_line = <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>;
<a name="l00138"></a>00138                                 <span class="keywordflow">continue</span>;
<a name="l00139"></a>00139                         }
<a name="l00140"></a>00140 
<a name="l00141"></a>00141                         <span class="comment">/* read the pin tokens */</span>
<a name="l00142"></a>00142                         pin_tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00143"></a>00143 
<a name="l00144"></a>00144                         <span class="keywordflow">if</span> (<a class="code" href="read__netlist_8c.html#a01dcb7c508d153e5e39904c1e0734b16">CountTokens</a> (block_tokens) != 2)
<a name="l00145"></a>00145                         {
<a name="l00146"></a>00146                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, prev_line, -1, <span class="stringliteral">&quot;&#39;%s&#39;:%d - block type linenum should &quot;</span> <span class="stringliteral">&quot;be in form &#39;.type_name block_name&#39;\n&quot;</span>, net_filename, prev_line);
<a name="l00147"></a>00147                         }
<a name="l00148"></a>00148                         <span class="keywordflow">if</span> (NULL == pin_tokens)
<a name="l00149"></a>00149                         {
<a name="l00150"></a>00150                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, prev_line, -1, <span class="stringliteral">&quot;&#39;%s&#39;:%d - blocks must be follow by a &#39;pinlist:&#39; linenum\n&quot;</span>, net_filename, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00151"></a>00151                         }
<a name="l00152"></a>00152                         <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;pinlist:&quot;</span>, pin_tokens[0]))
<a name="l00153"></a>00153                         {
<a name="l00154"></a>00154                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, prev_line, -1, <span class="stringliteral">&quot;&#39;%s&#39;:%d - &#39;pinlist:&#39; linenum must follow &quot;</span> <span class="stringliteral">&quot;block type linenum\n&quot;</span>, net_filename, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00155"></a>00155                         }
<a name="l00156"></a>00156 
<a name="l00157"></a>00157                         type = get_type_by_name (block_tokens[0], ntypes, block_types, IO_type, net_filename, prev_line, &amp;overide);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159                         <span class="comment">/* Check if we are overiding the pinlist format for this block since it is an INPUT or OUTPUT */</span>
<a name="l00160"></a>00160                         <span class="keywordflow">if</span> (overide)
<a name="l00161"></a>00161                         {
<a name="l00162"></a>00162                                 <span class="keywordflow">if</span> (<a class="code" href="read__netlist_8c.html#a01dcb7c508d153e5e39904c1e0734b16">CountTokens</a> (pin_tokens) != 2)
<a name="l00163"></a>00163                                 {               <span class="comment">/* &#39;pinlist:&#39; and name */</span>
<a name="l00164"></a>00164                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, prev_line, -1,<span class="stringliteral">&quot;&#39;%s&#39;:%d - pinlist for .input and .output should &quot;</span> <span class="stringliteral">&quot;only have one item.\n&quot;</span>, net_filename, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00165"></a>00165                                 }
<a name="l00166"></a>00166                                 <span class="keywordflow">if</span> (pass == DRIVER)
<a name="l00167"></a>00167                                 {
<a name="l00168"></a>00168                                         <span class="keywordflow">switch</span> (overide)
<a name="l00169"></a>00169                                         {
<a name="l00170"></a>00170                                                 <span class="keywordflow">case</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367ac4d1b488c8245e68c89dc6c23a9a3a22">INPAD</a>:
<a name="l00171"></a>00171                                                         add_io_node_and_driver (<a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a005ec11762aff9a9f61a1cf0e0c9bd88">INPUT_NODE</a>, netlist, block_tokens[1]);
<a name="l00172"></a>00172                                                         <span class="keywordflow">break</span>;
<a name="l00173"></a>00173                                                 <span class="keywordflow">case</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a53ea3283906af851c9037a42affd3ff9">OUTPAD</a>:
<a name="l00174"></a>00174                                                         add_io_node_and_driver (<a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af8835114e1f40eeb0e75e19b471c1d7f">OUTPUT_NODE</a>, netlist, block_tokens[1]);
<a name="l00175"></a>00175                                                         <span class="keywordflow">break</span>;
<a name="l00176"></a>00176                                                 <span class="keywordflow">default</span>:
<a name="l00177"></a>00177                                                         <span class="keywordflow">break</span>;
<a name="l00178"></a>00178                                         }
<a name="l00179"></a>00179                                 }
<a name="l00180"></a>00180                                         
<a name="l00181"></a>00181                                 <span class="comment">/* need to read the next line */</span>
<a name="l00182"></a>00182                                 tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00183"></a>00183                         }
<a name="l00184"></a>00184                         <span class="keywordflow">else</span> <span class="comment">/* this is a block with subblocks in it */</span>
<a name="l00185"></a>00185                         {
<a name="l00186"></a>00186                                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *current_block; 
<a name="l00187"></a>00187                                 <span class="keywordtype">char</span> ***tokens_list = NULL;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                                 <span class="keywordflow">if</span> (<a class="code" href="read__netlist_8c.html#a01dcb7c508d153e5e39904c1e0734b16">CountTokens</a> (pin_tokens) != (type-&gt;num_pins + 1))
<a name="l00190"></a>00190                                 {
<a name="l00191"></a>00191                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, prev_line, -1, <span class="stringliteral">&quot;&#39;%s&#39;:%d - &#39;pinlist:&#39; linenum has %d pins instead of &quot;</span> <span class="stringliteral">&quot;expect %d pins.\n&quot;</span>, net_filename, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, <a class="code" href="read__netlist_8c.html#a01dcb7c508d153e5e39904c1e0734b16">CountTokens</a> (pin_tokens) - 1, type-&gt;num_pins);
<a name="l00192"></a>00192                                 }
<a name="l00193"></a>00193         
<a name="l00194"></a>00194                                 <span class="comment">/* create the connections and nodes between the clusters */</span>
<a name="l00195"></a>00195                                 current_block = <a class="code" href="read__netlist_8c.html#aa415c7f9892c5bd32f4bb2d7fdee46f7">add_block</a> (block_tokens[1], pin_tokens, type, pass, netlist);
<a name="l00196"></a>00196         
<a name="l00197"></a>00197                                 <span class="comment">/* Use the subblock data to make internal cluster representation */</span>
<a name="l00198"></a>00198                                 tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00199"></a>00199                                 prev_line = <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>;
<a name="l00200"></a>00200                                 subblock_count = 0;
<a name="l00201"></a>00201                                 <span class="keywordflow">while</span> (tokens &amp;&amp; (0 == strcmp (tokens[0], <span class="stringliteral">&quot;subblock:&quot;</span>)))
<a name="l00202"></a>00202                                 {
<a name="l00203"></a>00203                                         <span class="comment">/* Create subblock as internal subgraph of type netlist_t */</span>
<a name="l00204"></a>00204                                         <span class="keywordflow">if</span> (<a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87af94c9effcae4576877f0d41ce4eab253">DRIVEN</a> == pass)
<a name="l00205"></a>00205                                         {
<a name="l00206"></a>00206                                                 tokens_list = (<span class="keywordtype">char</span> ***)realloc(tokens_list, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>**)*(subblock_count+1));
<a name="l00207"></a>00207                                                 tokens_list[subblock_count] = tokens;
<a name="l00208"></a>00208                                         }
<a name="l00209"></a>00209         
<a name="l00210"></a>00210                                         ++subblock_count;               <span class="comment">/* Next subblock */</span>
<a name="l00211"></a>00211         
<a name="l00212"></a>00212                                         tokens = <a class="code" href="read__netlist_8c.html#af2cc94c46277d21e246e362656da66cf">ReadLineTokens</a> (net_file, &amp;<a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>);
<a name="l00213"></a>00213                                         prev_line = <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>;
<a name="l00214"></a>00214                                 }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216                                 <span class="comment">/* now process all the recorded data for the tokens making up the subblocks */</span>
<a name="l00217"></a>00217                                 <span class="keywordflow">if</span> (<a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87af94c9effcae4576877f0d41ce4eab253">DRIVEN</a> == pass)
<a name="l00218"></a>00218                                 {
<a name="l00219"></a>00219                                         <a class="code" href="read__netlist_8c.html#a464d4918145bc6dfaa11862e3e874846">add_subblock_to_node</a>(current_block, tokens_list, subblock_count, type); 
<a name="l00220"></a>00220 
<a name="l00221"></a>00221                                         <span class="comment">/* free up recorded data */</span>
<a name="l00222"></a>00222                                         <span class="keywordflow">for</span> (i = 0; i &lt; subblock_count; i++)
<a name="l00223"></a>00223                                         {
<a name="l00224"></a>00224                                                 <a class="code" href="read__netlist_8c.html#a544063fbc3a0588386768c094e840f99">FreeTokens</a> (&amp;tokens_list[i]);
<a name="l00225"></a>00225                                         }
<a name="l00226"></a>00226                                         <span class="keywordflow">if</span> (tokens_list != NULL)
<a name="l00227"></a>00227                                         {
<a name="l00228"></a>00228                                                 free(tokens_list);
<a name="l00229"></a>00229                                         }
<a name="l00230"></a>00230                                 }
<a name="l00231"></a>00231                         }
<a name="l00232"></a>00232         
<a name="l00233"></a>00233                         num_blocks++;                   <span class="comment">/* End of this block */</span>
<a name="l00234"></a>00234 
<a name="l00235"></a>00235                         <a class="code" href="read__netlist_8c.html#a544063fbc3a0588386768c094e840f99">FreeTokens</a> (&amp;block_tokens);
<a name="l00236"></a>00236                         <a class="code" href="read__netlist_8c.html#a544063fbc3a0588386768c094e840f99">FreeTokens</a> (&amp;pin_tokens);
<a name="l00237"></a>00237 
<a name="l00238"></a>00238                         <span class="comment">/* done here since the last read of subblocks put us with this linenum */</span>
<a name="l00239"></a>00239                         block_tokens = tokens;
<a name="l00240"></a>00240                 }
<a name="l00241"></a>00241         }
<a name="l00242"></a>00242         
<a name="l00243"></a>00243         fclose (net_file);
<a name="l00244"></a>00244 
<a name="l00245"></a>00245         <span class="keywordflow">return</span> netlist;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00249"></a>00249 <span class="comment"> * (function: add_io_node_and_driver )</span>
<a name="l00250"></a>00250 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00251"></a>00251 <span class="keyword">static</span> <span class="keywordtype">void</span>
<a name="l00252"></a>00252 add_io_node_and_driver (
<a name="l00253"></a>00253         <span class="keywordtype">short</span> io_type,
<a name="l00254"></a>00254         <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist,
<a name="l00255"></a>00255         <span class="keywordtype">char</span> *io_pin_name
<a name="l00256"></a>00256 )
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258         <span class="keywordtype">long</span> sc_spot;
<a name="l00259"></a>00259         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_node;
<a name="l00260"></a>00260         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_output_pin;
<a name="l00261"></a>00261         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263         <span class="comment">/* create a new node for this input */</span>
<a name="l00264"></a>00264         new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00265"></a>00265         <span class="comment">/* create node */</span>
<a name="l00266"></a>00266         new_node-&gt;related_ast_node = NULL;
<a name="l00267"></a>00267         new_node-&gt;type = io_type;
<a name="l00268"></a>00268 
<a name="l00269"></a>00269         <span class="comment">/* create the unique name for this gate */</span>
<a name="l00270"></a>00270         new_node-&gt;name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(NULL, NULL, NULL, io_pin_name, -1);
<a name="l00271"></a>00271 
<a name="l00272"></a>00272         <span class="comment">/* add node to netlist */</span>
<a name="l00273"></a>00273         <a class="code" href="netlist__utils_8c.html#ab853e44606b566f2b1ad09b941cd1b93">add_node_to_netlist</a>(netlist, new_node, -1);
<a name="l00274"></a>00274 
<a name="l00275"></a>00275         <span class="keywordflow">if</span> (io_type == <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a005ec11762aff9a9f61a1cf0e0c9bd88">INPUT_NODE</a>)
<a name="l00276"></a>00276         {
<a name="l00277"></a>00277                 <span class="comment">/* add the output pin */</span>
<a name="l00278"></a>00278                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(new_node, 1);
<a name="l00279"></a>00279                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(new_node, 1);
<a name="l00280"></a>00280 
<a name="l00281"></a>00281                 <span class="comment">/* add the pin */</span>
<a name="l00282"></a>00282                 node_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00283"></a>00283                 <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(new_node, node_output_pin, 0);
<a name="l00284"></a>00284 
<a name="l00285"></a>00285                 <span class="comment">/* now add the net and store it in the string hash */</span>
<a name="l00286"></a>00286                 new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00287"></a>00287                 new_net-&gt;name = new_node-&gt;name;
<a name="l00288"></a>00288                 <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, node_output_pin);
<a name="l00289"></a>00289 
<a name="l00290"></a>00290                 <span class="comment">/* add to the driver hash */</span>
<a name="l00291"></a>00291                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(netlist-&gt;nets_sc, new_node-&gt;name);
<a name="l00292"></a>00292                 <span class="keywordflow">if</span> (netlist-&gt;nets_sc-&gt;data[sc_spot] != NULL)
<a name="l00293"></a>00293                 {
<a name="l00294"></a>00294                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, -1, <span class="stringliteral">&quot;Two netlist outputs with the same name (%s)\n&quot;</span>, new_node-&gt;name);
<a name="l00295"></a>00295                 }
<a name="l00296"></a>00296                 netlist-&gt;nets_sc-&gt;data[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (io_type == <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af8835114e1f40eeb0e75e19b471c1d7f">OUTPUT_NODE</a>)
<a name="l00299"></a>00299         {
<a name="l00300"></a>00300                 <span class="comment">/* allocate input pins.  Is 1 less than i where the last i is the output name */</span>
<a name="l00301"></a>00301                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(new_node, 1);
<a name="l00302"></a>00302                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(new_node, 1);
<a name="l00303"></a>00303 
<a name="l00304"></a>00304                 <span class="comment">/* add to the driver hash */</span>
<a name="l00305"></a>00305                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(netlist-&gt;out_pins_sc, io_pin_name);
<a name="l00306"></a>00306                 <span class="keywordflow">if</span> (netlist-&gt;out_pins_sc-&gt;data[sc_spot] != NULL)
<a name="l00307"></a>00307                 {
<a name="l00308"></a>00308                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, -1, <span class="stringliteral">&quot;Two outputs pins with the same name (%s)\n&quot;</span>, io_pin_name);
<a name="l00309"></a>00309                 }
<a name="l00310"></a>00310                 netlist-&gt;out_pins_sc-&gt;data[sc_spot] = (<span class="keywordtype">void</span>*)new_node;
<a name="l00311"></a>00311         }
<a name="l00312"></a>00312 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00315"></a>00315 <span class="comment"> * (function: add_block)</span>
<a name="l00316"></a>00316 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00317"></a>00317 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *
<a name="l00318"></a><a class="code" href="read__netlist_8c.html#aa415c7f9892c5bd32f4bb2d7fdee46f7">00318</a> <a class="code" href="read__netlist_8c.html#aa415c7f9892c5bd32f4bb2d7fdee46f7">add_block</a> (<span class="keywordtype">char</span> *<a class="code" href="node__creation__library_8c.html#aeef047e0b6898c9d748eac175ef890b7">node_name</a>, <span class="keywordtype">char</span> **pin_tokens, t_type_ptr type, <span class="keywordtype">short</span> <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87">pass</a>, <a class="code" href="types_8h.html#a8ff6acf27675c3785f339057e7645542">netlist_t</a> *netlist)
<a name="l00319"></a>00319 {
<a name="l00320"></a>00320         <span class="keywordtype">long</span> sc_spot;
<a name="l00321"></a>00321         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_node;
<a name="l00322"></a>00322         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_output_pin;
<a name="l00323"></a>00323         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l00324"></a>00324         <span class="keywordtype">int</span> num_input_pins = 0;
<a name="l00325"></a>00325         <span class="keywordtype">int</span> num_output_pins = 0;
<a name="l00326"></a>00326         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin = NULL;
<a name="l00327"></a>00327         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *driver_net;
<a name="l00328"></a>00328         <span class="keywordtype">int</span> k;
<a name="l00329"></a>00329 
<a name="l00330"></a>00330         <span class="comment">/* now that we know the node name, find it */</span>
<a name="l00331"></a>00331         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(netlist-&gt;nodes_sc, node_name)) == -1)
<a name="l00332"></a>00332         {
<a name="l00333"></a>00333                 new_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00334"></a>00334                 <span class="comment">/* create node */</span>
<a name="l00335"></a>00335                 new_node-&gt;related_ast_node = NULL;
<a name="l00336"></a>00336                 new_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42aaf7ea64c24021aeb86c852799db1ade7">NETLIST_FUNCTION</a>;
<a name="l00337"></a>00337         
<a name="l00338"></a>00338                 <span class="comment">/* create the unique name for this gate */</span>
<a name="l00339"></a>00339                 new_node-&gt;name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(NULL, NULL, NULL, node_name, -1);
<a name="l00340"></a>00340 
<a name="l00341"></a>00341                 <span class="comment">/* add node to netlist */</span>
<a name="l00342"></a>00342                 <a class="code" href="netlist__utils_8c.html#ab853e44606b566f2b1ad09b941cd1b93">add_node_to_netlist</a>(netlist, new_node, -1);
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344         <span class="keywordflow">else</span>
<a name="l00345"></a>00345         {
<a name="l00346"></a>00346                 <span class="comment">/* already made.  Note that the netlist format is the cluster name is the first output name, but as long as the cluster is an output name in its output list, then it is fine. */</span>
<a name="l00347"></a>00347                 new_node = ((<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)netlist-&gt;nodes_sc-&gt;data[sc_spot]);
<a name="l00348"></a>00348         }
<a name="l00349"></a>00349 
<a name="l00350"></a>00350         <span class="comment">/* Examine pin list to determine nets */</span>
<a name="l00351"></a>00351         <span class="keywordflow">for</span> (k = 1; k &lt; type-&gt;num_pins+1; ++k)
<a name="l00352"></a>00352         {
<a name="l00353"></a>00353                 <span class="keywordflow">if</span>  (DRIVER == type-&gt;class_inf[type-&gt;pin_class[k-1]].type)
<a name="l00354"></a>00354                 {
<a name="l00355"></a>00355                         <span class="keywordflow">if</span> (pass == <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87a8cfa4abaed06c3313cb0a64f8996531b">DRIVERS</a>) 
<a name="l00356"></a>00356                         {
<a name="l00357"></a>00357                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(k &gt;= type-&gt;num_receivers+1);
<a name="l00358"></a>00358                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(k-1-type-&gt;num_receivers == num_output_pins);
<a name="l00359"></a>00359                                 <span class="comment">/* allocate the pins needed even if they&#39;re unused */</span>
<a name="l00360"></a>00360                                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(new_node, 1);
<a name="l00361"></a>00361                                 <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(new_node, 1);
<a name="l00362"></a>00362 
<a name="l00363"></a>00363                                 <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;open&quot;</span>, pin_tokens[k]))
<a name="l00364"></a>00364                                 {
<a name="l00365"></a>00365                                         <span class="comment">/* Add the driver pin */</span>
<a name="l00366"></a>00366                                         node_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00367"></a>00367                                         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(new_node, node_output_pin, num_output_pins);
<a name="l00368"></a>00368                         
<a name="l00369"></a>00369                                         <span class="comment">/* now add the net and store it in the string hash */</span>
<a name="l00370"></a>00370                                         new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00371"></a>00371                                         new_net-&gt;name = strdup(pin_tokens[k]);
<a name="l00372"></a>00372                                         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, node_output_pin);
<a name="l00373"></a>00373                                 
<a name="l00374"></a>00374                                         <span class="comment">/* add to the driver hash */</span>
<a name="l00375"></a>00375                                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(netlist-&gt;out_pins_sc, pin_tokens[k])) != -1)
<a name="l00376"></a>00376                                         {
<a name="l00377"></a>00377                                                 <span class="comment">/* Special case when we hookup a driver to an output pin */</span>
<a name="l00378"></a>00378                                                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *<a class="code" href="output__blif_8c.html#ac9df186e112b548025097f4d0720ca6d">output_node</a> = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)netlist-&gt;out_pins_sc-&gt;data[sc_spot];
<a name="l00379"></a>00379                                                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin;
<a name="l00380"></a>00380                         
<a name="l00381"></a>00381                                                 <span class="comment">/* hookup this output net to that node */</span>
<a name="l00382"></a>00382                                                 node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00383"></a>00383                                                 <span class="comment">/* add to the driver net */</span>
<a name="l00384"></a>00384                                                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(new_net, node_input_pin);
<a name="l00385"></a>00385                                                 <span class="comment">/* add pin to node */</span>
<a name="l00386"></a>00386                                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(output_node, node_input_pin, 0);
<a name="l00387"></a>00387                         
<a name="l00388"></a>00388                                                 <span class="comment">/* add to the driver hash */</span>
<a name="l00389"></a>00389                                                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(netlist-&gt;nets_sc, pin_tokens[k]);
<a name="l00390"></a>00390                                                 <span class="keywordflow">if</span> (netlist-&gt;nets_sc-&gt;data[sc_spot] != NULL)
<a name="l00391"></a>00391                                                 {
<a name="l00392"></a>00392                                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, -1, <span class="stringliteral">&quot;Two netlist outputs with the same name (%s)\n&quot;</span>, pin_tokens[k]);
<a name="l00393"></a>00393                                                 }
<a name="l00394"></a>00394                                                 netlist-&gt;nets_sc-&gt;data[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00395"></a>00395                                         }
<a name="l00396"></a>00396                                         <span class="keywordflow">else</span>
<a name="l00397"></a>00397                                         {
<a name="l00398"></a>00398                                                 <span class="comment">/* add to the driver hash */</span>
<a name="l00399"></a>00399                                                 sc_spot = <a class="code" href="string__cache_8c.html#acbe32d11e8533ba39c58f629f75a77eb">sc_add_string</a>(netlist-&gt;nets_sc, pin_tokens[k]);
<a name="l00400"></a>00400                                                 <span class="keywordflow">if</span> (netlist-&gt;nets_sc-&gt;data[sc_spot] != NULL)
<a name="l00401"></a>00401                                                 {
<a name="l00402"></a>00402                                                         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, -1, <span class="stringliteral">&quot;Two netlist outputs with the same name (%s)\n&quot;</span>, pin_tokens[k]);
<a name="l00403"></a>00403                                                 }
<a name="l00404"></a>00404                                                 netlist-&gt;nets_sc-&gt;data[sc_spot] = (<span class="keywordtype">void</span>*)new_net;
<a name="l00405"></a>00405                                         }
<a name="l00406"></a>00406                                 }
<a name="l00407"></a>00407 
<a name="l00408"></a>00408                                 num_output_pins ++;
<a name="l00409"></a>00409                         }
<a name="l00410"></a>00410                 }
<a name="l00411"></a>00411                 <span class="keywordflow">else</span> 
<a name="l00412"></a>00412                 {
<a name="l00413"></a>00413                         <span class="keywordflow">if</span> (pass == <a class="code" href="read__netlist_8c.html#a078bbb4bf0f7117fb131ec45f15b5b87af94c9effcae4576877f0d41ce4eab253">DRIVEN</a>)
<a name="l00414"></a>00414                         {
<a name="l00415"></a>00415                                 <span class="comment">/* allocate input pins even if it is open. */</span>
<a name="l00416"></a>00416                                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(new_node, 1);
<a name="l00417"></a>00417                                 <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(new_node, 1);
<a name="l00418"></a>00418 
<a name="l00419"></a>00419                                 <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;open&quot;</span>, pin_tokens[k]))
<a name="l00420"></a>00420                                 {
<a name="l00421"></a>00421                                         <span class="comment">/* Hookup driven port (input) to a driver net */</span>
<a name="l00422"></a>00422                                         <span class="keywordflow">if</span> ((sc_spot = <a class="code" href="string__cache_8c.html#ab5a61b62a571b464877b8bb7b9f397ec">sc_lookup_string</a>(netlist-&gt;nets_sc, pin_tokens[k])) == -1)
<a name="l00423"></a>00423                                         {
<a name="l00424"></a>00424                                                 <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#a0886f1b370ff79b75f6eebeb87ed656b">NETLIST_ERROR</a>, <a class="code" href="read__blif_8c.html#a696967e9c7408f4d9d8624ad6bd675f3">linenum</a>, -1, <span class="stringliteral">&quot;Netlist input does not exist (%s)\n&quot;</span>, pin_tokens[k]);
<a name="l00425"></a>00425                                         }
<a name="l00426"></a>00426                                         driver_net = (<a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a>*)netlist-&gt;nets_sc-&gt;data[sc_spot];
<a name="l00427"></a>00427         
<a name="l00428"></a>00428                                         node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00429"></a>00429                                         node_input_pin-&gt;name = strdup(pin_tokens[k]);
<a name="l00430"></a>00430                                         <span class="comment">/* add to the driver net */</span>
<a name="l00431"></a>00431                                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(driver_net, node_input_pin);
<a name="l00432"></a>00432         
<a name="l00433"></a>00433                                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(new_node, node_input_pin, num_input_pins);
<a name="l00434"></a>00434                                 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436                                 num_input_pins ++;
<a name="l00437"></a>00437                         }
<a name="l00438"></a>00438                 }
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441         <span class="keywordflow">return</span> new_node;
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00445"></a>00445 <span class="comment"> * (function: add_subblock_to_node)</span>
<a name="l00446"></a>00446 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00447"></a>00447 <span class="keywordtype">void</span>
<a name="l00448"></a><a class="code" href="read__netlist_8c.html#a464d4918145bc6dfaa11862e3e874846">00448</a> <a class="code" href="read__netlist_8c.html#a464d4918145bc6dfaa11862e3e874846">add_subblock_to_node</a>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *current_block, <span class="keywordtype">char</span> ***tokens_list, <span class="keywordtype">int</span> num_subblocks, t_type_ptr type)
<a name="l00449"></a>00449 {
<a name="l00450"></a>00450         <span class="keywordtype">int</span> i, j, k;
<a name="l00451"></a>00451         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> **subblock_nodes = (<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>**)malloc(<span class="keyword">sizeof</span>(<a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a>*)*num_subblocks);
<a name="l00452"></a>00452         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_output_pin;
<a name="l00453"></a>00453         <a class="code" href="types_8h.html#af4b3bf79b0b627854626d6e5aadc7f16">nnet_t</a> *new_net;
<a name="l00454"></a>00454         <span class="keywordtype">int</span> live_index_count;
<a name="l00455"></a>00455         <span class="keywordtype">int</span> *input_idx = (<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*current_block-&gt;num_input_pins);
<a name="l00456"></a>00456         <span class="keywordtype">int</span> *output_idx = (<span class="keywordtype">int</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>)*current_block-&gt;num_output_pins);
<a name="l00457"></a>00457 
<a name="l00458"></a>00458         <span class="comment">/* allocate the internal netlist */</span>
<a name="l00459"></a>00459         current_block-&gt;internal_netlist = <a class="code" href="netlist__utils_8c.html#a88eb12f8127d1a2ec1c77da5c1b1415d">allocate_netlist</a>();
<a name="l00460"></a>00460         current_block-&gt;internal_netlist-&gt;type = type;
<a name="l00461"></a>00461 
<a name="l00462"></a>00462         <span class="comment">/* create all the inputs and outputs that exist outside the cluster internally */</span>
<a name="l00463"></a>00463         live_index_count = 0;
<a name="l00464"></a>00464         <span class="keywordflow">for</span> (i = 0; i &lt; current_block-&gt;num_input_pins; i++)
<a name="l00465"></a>00465         {
<a name="l00466"></a>00466                 <span class="keywordflow">if</span> (current_block-&gt;input_pins[i] != NULL)
<a name="l00467"></a>00467                 {
<a name="l00468"></a>00468                         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_input_node;
<a name="l00469"></a>00469 
<a name="l00470"></a>00470                         <span class="comment">/* create a new node for this input */</span>
<a name="l00471"></a>00471                         new_input_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00472"></a>00472                         <span class="comment">/* create node */</span>
<a name="l00473"></a>00473                         new_input_node-&gt;related_ast_node = NULL;
<a name="l00474"></a>00474                         new_input_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42a005ec11762aff9a9f61a1cf0e0c9bd88">INPUT_NODE</a>;
<a name="l00475"></a>00475                         <span class="comment">/* create the unique name for this gate */</span>
<a name="l00476"></a>00476                         new_input_node-&gt;name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(NULL, NULL, NULL, current_block-&gt;input_pins[i]-&gt;net-&gt;name, -1);
<a name="l00477"></a>00477 
<a name="l00478"></a>00478                         <span class="comment">/* add node to netlist */</span>
<a name="l00479"></a>00479                         <a class="code" href="netlist__utils_8c.html#ab853e44606b566f2b1ad09b941cd1b93">add_node_to_netlist</a>(current_block-&gt;internal_netlist, new_input_node, -1);
<a name="l00480"></a>00480         
<a name="l00481"></a>00481                         <span class="comment">/* add the output pin */</span>
<a name="l00482"></a>00482                         <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(new_input_node, 1);
<a name="l00483"></a>00483                         <a class="code" href="netlist__utils_8c.html#a64712f9077efee9bc5ace9d9ecdc2d53">add_output_port_information</a>(new_input_node, 1);
<a name="l00484"></a>00484         
<a name="l00485"></a>00485                         <span class="comment">/* add the pin */</span>
<a name="l00486"></a>00486                         node_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00487"></a>00487                         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(new_input_node, node_output_pin, 0);
<a name="l00488"></a>00488         
<a name="l00489"></a>00489                         <span class="comment">/* now add the net and store it in the string hash */</span>
<a name="l00490"></a>00490                         new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00491"></a>00491                         new_net-&gt;name = new_input_node-&gt;name;
<a name="l00492"></a>00492                         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, node_output_pin);
<a name="l00493"></a>00493 
<a name="l00494"></a>00494                         <span class="comment">/* record the index externally */</span>
<a name="l00495"></a>00495                         input_idx[i] = live_index_count;
<a name="l00496"></a>00496                         live_index_count++;
<a name="l00497"></a>00497                 }
<a name="l00498"></a>00498                 <span class="keywordflow">else</span>
<a name="l00499"></a>00499                 {
<a name="l00500"></a>00500                         input_idx[i] = -1;
<a name="l00501"></a>00501                 }
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503         live_index_count = 0;
<a name="l00504"></a>00504         <span class="keywordflow">for</span> (i = 0; i &lt; current_block-&gt;num_output_pins; i++)
<a name="l00505"></a>00505         {
<a name="l00506"></a>00506                 <span class="keywordflow">if</span> (current_block-&gt;output_pins[i] != NULL)
<a name="l00507"></a>00507                 {
<a name="l00508"></a>00508                         <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *new_output_node;
<a name="l00509"></a>00509                         <span class="keywordtype">char</span> *output_name = (<span class="keywordtype">char</span>*)malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">char</span>)*(strlen(current_block-&gt;output_pins[i]-&gt;net-&gt;name)+1+4));
<a name="l00510"></a>00510                         sprintf(output_name, <span class="stringliteral">&quot;out:%s&quot;</span>, current_block-&gt;output_pins[i]-&gt;net-&gt;name);
<a name="l00511"></a>00511 
<a name="l00512"></a>00512                         <span class="comment">/* create a new node for this input */</span>
<a name="l00513"></a>00513                         new_output_node = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00514"></a>00514                         <span class="comment">/* create node */</span>
<a name="l00515"></a>00515                         new_output_node-&gt;related_ast_node = NULL;
<a name="l00516"></a>00516                         new_output_node-&gt;type = <a class="code" href="types_8h.html#a500984a8540070ae8588aeb29ed9ce42af8835114e1f40eeb0e75e19b471c1d7f">OUTPUT_NODE</a>;
<a name="l00517"></a>00517                         <span class="comment">/* create the unique name for this gate */</span>
<a name="l00518"></a>00518                         new_output_node-&gt;name = <a class="code" href="odin__util_8c.html#ab212c2e6ac09d83e399369dfd9810c2e">make_full_ref_name</a>(NULL, NULL, NULL, output_name, -1);
<a name="l00519"></a>00519 
<a name="l00520"></a>00520                         <span class="comment">/* add node to netlist */</span>
<a name="l00521"></a>00521                         <a class="code" href="netlist__utils_8c.html#ab853e44606b566f2b1ad09b941cd1b93">add_node_to_netlist</a>(current_block-&gt;internal_netlist, new_output_node, -1);
<a name="l00522"></a>00522 
<a name="l00523"></a>00523                         <span class="comment">/* allocate input pins.  Is 1 less than i where the last i is the output name */</span>
<a name="l00524"></a>00524                         <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(new_output_node, 1);
<a name="l00525"></a>00525                         <a class="code" href="netlist__utils_8c.html#a750fd255302386b9aa11e7b140249c32">add_input_port_information</a>(new_output_node, 1);
<a name="l00526"></a>00526 
<a name="l00527"></a>00527                         <span class="comment">/* record the index externally */</span>
<a name="l00528"></a>00528                         output_idx[i] = live_index_count;
<a name="l00529"></a>00529                         live_index_count++;
<a name="l00530"></a>00530                 }
<a name="l00531"></a>00531                 <span class="keywordflow">else</span>
<a name="l00532"></a>00532                 {
<a name="l00533"></a>00533                         output_idx[i] = -1;
<a name="l00534"></a>00534                 }
<a name="l00535"></a>00535         }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537         <span class="comment">/* create the subblocks with their respective inputs and outputs */</span>
<a name="l00538"></a>00538         <span class="keywordflow">for</span> (i = 0; i &lt; num_subblocks; i++)
<a name="l00539"></a>00539         {
<a name="l00540"></a>00540                 subblock_nodes[i] = <a class="code" href="netlist__utils_8c.html#aa7db9fb51413bd9b9fcad31357a4ad1f">allocate_nnode</a>();
<a name="l00541"></a>00541                 <span class="comment">/* the name of the node is the second token since the first is &quot;subblock:&quot; */</span>
<a name="l00542"></a>00542                 subblock_nodes[i]-&gt;name = strdup(tokens_list[i][1]);
<a name="l00543"></a>00543 
<a name="l00544"></a>00544                 <a class="code" href="netlist__utils_8c.html#acee051972ef0ff972d159c839466cc67">allocate_more_node_input_pins</a>(subblock_nodes[i], type-&gt;max_subblock_inputs + 1); <span class="comment">/* + 1 for clock */</span>
<a name="l00545"></a>00545                 <a class="code" href="netlist__utils_8c.html#a639ffc398207882b45674d15405507e1">allocate_more_node_output_pins</a>(subblock_nodes[i], type-&gt;max_subblock_outputs);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547                 <span class="comment">/* create the output pins and nets */</span>
<a name="l00548"></a>00548                 <span class="keywordflow">for</span> (j = 0; j &lt; type-&gt;max_subblock_outputs; j++)
<a name="l00549"></a>00549                 {
<a name="l00550"></a>00550                         <span class="comment">/* Add the driver pin */</span>
<a name="l00551"></a>00551                         node_output_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00552"></a>00552                         <a class="code" href="netlist__utils_8c.html#a6dc37d4081c69203a40ec05480f006bc">add_a_output_pin_to_node_spot_idx</a>(subblock_nodes[i], node_output_pin, j);
<a name="l00553"></a>00553                         
<a name="l00554"></a>00554                         <span class="comment">/* now add the net and store it in the string hash */</span>
<a name="l00555"></a>00555                         new_net = <a class="code" href="netlist__utils_8c.html#afc0e7d935faa8586ed0b38c260367e68">allocate_nnet</a>();
<a name="l00556"></a>00556                         <a class="code" href="netlist__utils_8c.html#ad4783896cefc619a2cad91bbbd9af99d">add_a_driver_pin_to_net</a>(new_net, node_output_pin);
<a name="l00557"></a>00557                 }
<a name="l00558"></a>00558 
<a name="l00559"></a>00559                 <span class="comment">/* add the node to the netlist */</span>
<a name="l00560"></a>00560                 <a class="code" href="netlist__utils_8c.html#ab853e44606b566f2b1ad09b941cd1b93">add_node_to_netlist</a>(current_block-&gt;internal_netlist, subblock_nodes[i], -1);
<a name="l00561"></a>00561         }
<a name="l00562"></a>00562 
<a name="l00563"></a>00563         <span class="keywordflow">for</span> (i = 0; i &lt; num_subblocks; i++)
<a name="l00564"></a>00564         {
<a name="l00565"></a>00565                 <span class="keywordtype">int</span> idx;
<a name="l00566"></a>00566 
<a name="l00567"></a>00567                 <span class="keywordflow">for</span> (k = 0; k &lt; type-&gt;max_subblock_inputs; ++k)
<a name="l00568"></a>00568                 {
<a name="l00569"></a>00569                         <span class="comment">/* Check prefix and load pin num */</span>
<a name="l00570"></a>00570                         idx = 2 + k;
<a name="l00571"></a>00571                         <span class="keywordflow">if</span> (0 == strncmp (<span class="stringliteral">&quot;ble_&quot;</span>, tokens_list[i][idx], 4))
<a name="l00572"></a>00572                         {
<a name="l00573"></a>00573                                 <span class="comment">/* IF this is a ble connection then hookup to that ble then hookup this input to the output of the ble number */</span>
<a name="l00574"></a>00574                                 <span class="keywordtype">int</span> ble_idx = atoi(tokens_list[i][idx] + 4);    <span class="comment">/* Skip the &#39;ble_&#39; part */</span>
<a name="l00575"></a>00575                                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00576"></a>00576 
<a name="l00577"></a>00577                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(subblock_nodes[ble_idx]-&gt;num_output_pins == 1);
<a name="l00578"></a>00578 
<a name="l00579"></a>00579                                 <span class="comment">/* add to the driver net */</span>
<a name="l00580"></a>00580                                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(subblock_nodes[ble_idx]-&gt;output_pins[0]-&gt;net, node_input_pin);
<a name="l00581"></a>00581                                 <span class="comment">/* add pin to node */</span>
<a name="l00582"></a>00582                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(subblock_nodes[i], node_input_pin, k);
<a name="l00583"></a>00583                         }
<a name="l00584"></a>00584                         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;open&quot;</span>, tokens_list[i][idx]))
<a name="l00585"></a>00585                         {
<a name="l00586"></a>00586                                 <span class="comment">/* IF this is connected to an input find out which one */</span>
<a name="l00587"></a>00587                                 <span class="keywordtype">int</span> in_idx = input_idx[atoi(tokens_list[i][idx])];
<a name="l00588"></a>00588                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(in_idx &lt; type-&gt;num_receivers);
<a name="l00589"></a>00589                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(in_idx != -1);
<a name="l00590"></a>00590 
<a name="l00591"></a>00591                                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00592"></a>00592 
<a name="l00593"></a>00593                                 <span class="comment">/* add to the driver net */</span>
<a name="l00594"></a>00594                                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(current_block-&gt;internal_netlist-&gt;top_input_nodes[in_idx]-&gt;output_pins[0]-&gt;net, node_input_pin);
<a name="l00595"></a>00595                                 <span class="comment">/* add pin to node */</span>
<a name="l00596"></a>00596                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(subblock_nodes[i], node_input_pin, k);
<a name="l00597"></a>00597                         }
<a name="l00598"></a>00598                 }
<a name="l00599"></a>00599                 <span class="keywordflow">for</span> (k = 0; k &lt; type-&gt;max_subblock_outputs; ++k)
<a name="l00600"></a>00600                 {
<a name="l00601"></a>00601                         idx = 2 + type-&gt;max_subblock_inputs + k;
<a name="l00602"></a>00602                         <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;open&quot;</span>, tokens_list[i][idx]))
<a name="l00603"></a>00603                         {
<a name="l00604"></a>00604                                 <span class="comment">/* IF this output goes to a cluster output pin then hook it up */</span>
<a name="l00605"></a>00605                                 <span class="keywordtype">int</span> pin_idx = atoi(tokens_list[i][idx]) - type-&gt;num_receivers;
<a name="l00606"></a>00606                                 <span class="keywordtype">int</span> out_idx = output_idx[pin_idx];
<a name="l00607"></a>00607                                 <a class="code" href="types_8h.html#afba3494dc9a223f7df4014998e2da0df">nnode_t</a> *<a class="code" href="output__blif_8c.html#ac9df186e112b548025097f4d0720ca6d">output_node</a>;
<a name="l00608"></a>00608                                 <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin;
<a name="l00609"></a>00609                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(out_idx &lt; type-&gt;num_drivers);
<a name="l00610"></a>00610 
<a name="l00611"></a>00611                                 <span class="keywordflow">if</span> (current_block-&gt;output_pins[pin_idx] == NULL)
<a name="l00612"></a>00612                                 {
<a name="l00613"></a>00613                                         <span class="comment">/* IF this subblock does not go external */</span>
<a name="l00614"></a>00614                                         <span class="keywordflow">continue</span>;
<a name="l00615"></a>00615                                 }
<a name="l00616"></a>00616 
<a name="l00617"></a>00617                                 <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(out_idx != -1);
<a name="l00618"></a>00618 
<a name="l00619"></a>00619                                 output_node = current_block-&gt;internal_netlist-&gt;top_output_nodes[out_idx];
<a name="l00620"></a>00620                         
<a name="l00621"></a>00621                                 <span class="comment">/* hookup this output net to that node */</span>
<a name="l00622"></a>00622                                 node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00623"></a>00623                                 <span class="comment">/* add to the driver net */</span>
<a name="l00624"></a>00624                                 <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(subblock_nodes[i]-&gt;output_pins[k]-&gt;net, node_input_pin);
<a name="l00625"></a>00625                                 <span class="comment">/* add pin to node */</span>
<a name="l00626"></a>00626                                 <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(output_node, node_input_pin, k);
<a name="l00627"></a>00627                         }
<a name="l00628"></a>00628                 }
<a name="l00629"></a>00629                 idx = 2 + type-&gt;max_subblock_inputs + type-&gt;max_subblock_outputs;
<a name="l00630"></a>00630                 <span class="keywordflow">if</span> (0 != strcmp (<span class="stringliteral">&quot;open&quot;</span>, tokens_list[i][idx]))
<a name="l00631"></a>00631                 {
<a name="l00632"></a>00632                         <span class="keywordtype">int</span> clock_idx = input_idx[atoi (tokens_list[i][idx]) - (type-&gt;num_receivers + type-&gt;num_drivers)];
<a name="l00633"></a>00633                         <a class="code" href="types_8h.html#a592b738619759726a0b990aa687dbfe6">npin_t</a> *node_input_pin = <a class="code" href="netlist__utils_8c.html#a992c593d240abbdc4d2d3d9d0f758c97">allocate_npin</a>();
<a name="l00634"></a>00634                         <a class="code" href="types_8h.html#affc7a856df18f1992d42e21c3c125c48">oassert</a>(clock_idx != -1);
<a name="l00635"></a>00635 
<a name="l00636"></a>00636                         <span class="comment">/* add to the driver net */</span>
<a name="l00637"></a>00637                         <a class="code" href="netlist__utils_8c.html#a4992aa96cac031b90593f1082e0d3ba7">add_a_fanout_pin_to_net</a>(current_block-&gt;internal_netlist-&gt;top_input_nodes[clock_idx]-&gt;output_pins[0]-&gt;net, node_input_pin);
<a name="l00638"></a>00638                         <span class="comment">/* add pin to node */</span>
<a name="l00639"></a>00639                         <a class="code" href="netlist__utils_8c.html#adc6b268d0cbf8fc499e69855bc42864f">add_a_input_pin_to_node_spot_idx</a>(subblock_nodes[i], node_input_pin, type-&gt;max_subblock_inputs);
<a name="l00640"></a>00640                 }
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">/* free the list */</span>
<a name="l00644"></a>00644         free(output_idx);
<a name="l00645"></a>00645         free(input_idx);
<a name="l00646"></a>00646 }
<a name="l00647"></a>00647 
<a name="l00648"></a>00648 <span class="comment">/*---------------------------------------------------------------------------------------------</span>
<a name="l00649"></a>00649 <span class="comment"> * (function: get_type_by_name)</span>
<a name="l00650"></a>00650 <span class="comment"> * From VPR 5.0</span>
<a name="l00651"></a>00651 <span class="comment"> *-------------------------------------------------------------------------------------------*/</span>
<a name="l00652"></a>00652 <span class="keyword">static</span> t_type_ptr
<a name="l00653"></a>00653 get_type_by_name (
<a name="l00654"></a>00654     <span class="keyword">const</span> <span class="keywordtype">char</span> *name,
<a name="l00655"></a>00655     <span class="keywordtype">int</span> ntypes,
<a name="l00656"></a>00656     <span class="keyword">const</span> <span class="keyword">struct</span> s_type_descriptor block_types[],
<a name="l00657"></a>00657     t_type_ptr IO_type,
<a name="l00658"></a>00658     <span class="keyword">const</span> <span class="keywordtype">char</span> *net_filename,
<a name="l00659"></a>00659     <span class="keywordtype">int</span> line,
<a name="l00660"></a>00660     <span class="keyword">enum</span> <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367">special_blk</a> *overide)
<a name="l00661"></a>00661 {
<a name="l00662"></a>00662 
<a name="l00663"></a>00663         <span class="comment">/* Just does a simple linear search for now */</span>
<a name="l00664"></a>00664         <span class="keywordtype">int</span> i;
<a name="l00665"></a>00665 
<a name="l00666"></a>00666         <span class="comment">/* pin_overide is used to specify that the .input and .output</span>
<a name="l00667"></a>00667 <span class="comment">         * blocks only have one pin specified and should be treated</span>
<a name="l00668"></a>00668 <span class="comment">         * as if used as a .io with a full pin spec */</span>
<a name="l00669"></a>00669         *overide = <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a50d1448013c6f17125caee18aa418af7">NORMAL</a>;
<a name="l00670"></a>00670 
<a name="l00671"></a>00671         <span class="comment">/* .input and .output are special names that map to the basic IO type */</span>
<a name="l00672"></a>00672         <span class="keywordflow">if</span> (0 == strcmp (<span class="stringliteral">&quot;.input&quot;</span>, name))
<a name="l00673"></a>00673         {
<a name="l00674"></a>00674                 *overide = <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367ac4d1b488c8245e68c89dc6c23a9a3a22">INPAD</a>;
<a name="l00675"></a>00675                 <span class="keywordflow">return</span> IO_type;
<a name="l00676"></a>00676         }
<a name="l00677"></a>00677         <span class="keywordflow">if</span> (0 == strcmp (<span class="stringliteral">&quot;.output&quot;</span>, name))
<a name="l00678"></a>00678         {
<a name="l00679"></a>00679                 *overide = <a class="code" href="read__netlist_8c.html#a19c73f126b0cec8c02d74f1941572367a53ea3283906af851c9037a42affd3ff9">OUTPAD</a>;
<a name="l00680"></a>00680                 <span class="keywordflow">return</span> IO_type;
<a name="l00681"></a>00681         }
<a name="l00682"></a>00682 
<a name="l00683"></a>00683         <span class="comment">/* Linear type search. Don&#39;t really expect to have too many</span>
<a name="l00684"></a>00684 <span class="comment">         * types for it to be a problem */</span>
<a name="l00685"></a>00685         <span class="keywordflow">for</span> (i = 0; i &lt; ntypes; ++i)
<a name="l00686"></a>00686         {
<a name="l00687"></a>00687                 <span class="keywordflow">if</span> (0 == strcmp (block_types[i].name, name))
<a name="l00688"></a>00688                 {
<a name="l00689"></a>00689                         <span class="keywordflow">return</span> (block_types + i);
<a name="l00690"></a>00690                 }
<a name="l00691"></a>00691         }
<a name="l00692"></a>00692 
<a name="l00693"></a>00693         <span class="comment">/* No type matched */</span>
<a name="l00694"></a>00694         <a class="code" href="errors_8c.html#a16a115fdf8530451e4a72c01a2d4c81f">error_message</a>(<a class="code" href="types_8h.html#ae66bba1245070cde6cfaaaaaa5888fe0">NETLIST_FILE_ERROR</a>, line, -1, <span class="stringliteral">&quot;&#39;%s&#39;:%d - Invalid block type &#39;%s&#39;\n&quot;</span>, net_filename, line, name);
<a name="l00695"></a>00695         exit (1);
<a name="l00696"></a>00696 }
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Wed Mar 3 15:37:02 2010 for ODIN_II by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
